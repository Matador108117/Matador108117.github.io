name: CI/CD deploy release
on: 
  pull_request:
    branches: [ "master"]
    
jobs:
  ci_cd_deploy_release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - run: echo 'hello world'

      - name: Use Node.js 20.x
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies 
        run: npm ci

      - name: Build setup
        run: npm run build

      - name: List directory before build
        run: ls -la

      - name: List directory after build
        run: ls -la dist
        
      - name: list dir 
        run: ls -la dist/mycv/browser
      
      - name: list container
        run:  |
            docker exec serving_base ls-la usr/local/apache2/htcdocs
      
      - name: download and run httpd docker imagen
        run:  |
            docker run -d -name serving_base httpd
      
      - name: docker ps
        run:  |
            docker ps
      
      - name: cp Angular build to container
        run:  |
              docker cp dist/mycv/browser/. serving_base/usr/local/apache2/htcdocs
     
      - name: docker custom image
        run:  |
              docker commit --change "ENV MODEL_NAME ${{secrets.MODEL_NAME}}"
              serving_base ${{secrets.DOCKER_USER}}/${{secrets.MODEL_NAME}}:${{github.sha}}
            
        
