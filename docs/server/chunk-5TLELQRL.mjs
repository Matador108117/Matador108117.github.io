import './polyfills.server.mjs';
import{$ as ql,A as Tn,B as pr,C as us,D as qS,E as he,F as It,G as ds,H as hs,I as oe,J as ne,K as Se,L as US,M as se,N as bh,O as Re,P as VS,Q as zS,R as GS,X as Ch,_ as fs,a as ls,aa as jS,b as xS,c as Pl,d as OS,da as KS,e as pi,f as cs,g as hr,h as fr,i as me,j as MS,ja as Ih,k as Jo,l as PS,m as LS,n as Ll,o as Fl,p as wh,q as Bl,r as mi,s as _h,t as FS,u as He,v as Sn,w as St,x as Y,y as BS,z as dt}from"./chunk-X5GDFFDU.mjs";import{a as WS,b as Ah,c as $S,d as Xo,e as Rh,f as Ul,g as HS,h as QS,i as Dh,j as xe,k as gi,l as En,m as Vl,n as Zo,o as YS,p as JS,q as mr,r as Pt}from"./chunk-XKLCX4PC.mjs";import{a as nt,b as Th,c as pe,f as D,h as NS,i as Eh,j as w}from"./chunk-EXD34EPT.mjs";var fe=D(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=zt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=zt.Propagate=zt.LogVerbosity=zt.Status=void 0;var vT=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(vT||(zt.Status=vT={})),ST=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(ST||(zt.LogVerbosity=ST={})),TT=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(TT||(zt.Propagate=TT={}));zt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;zt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Wh=D((Kz,cD)=>{cD.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Fe=D(Tt=>{"use strict";var $h,Hh,Qh,Yh;Object.defineProperty(Tt,"__esModule",{value:!0});Tt.isTracerEnabled=Tt.trace=Tt.log=Tt.setLoggerVerbosity=Tt.setLogger=Tt.getLogger=void 0;var vr=fe(),uD=pe("process"),dD=Wh().version,hD={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},vi=hD,gs=vr.LogVerbosity.ERROR,fD=(Hh=($h=process.env.GRPC_NODE_VERBOSITY)!==null&&$h!==void 0?$h:process.env.GRPC_VERBOSITY)!==null&&Hh!==void 0?Hh:"";switch(fD.toUpperCase()){case"DEBUG":gs=vr.LogVerbosity.DEBUG;break;case"INFO":gs=vr.LogVerbosity.INFO;break;case"ERROR":gs=vr.LogVerbosity.ERROR;break;case"NONE":gs=vr.LogVerbosity.NONE;break;default:}var pD=()=>vi;Tt.getLogger=pD;var mD=n=>{vi=n};Tt.setLogger=mD;var gD=n=>{gs=n};Tt.setLoggerVerbosity=gD;var yD=(n,...e)=>{let t;if(n>=gs){switch(n){case vr.LogVerbosity.DEBUG:t=vi.debug;break;case vr.LogVerbosity.INFO:t=vi.info;break;case vr.LogVerbosity.ERROR:t=vi.error;break}t||(t=vi.error),t&&t.bind(vi)(...e)}};Tt.log=yD;var vD=(Yh=(Qh=process.env.GRPC_NODE_TRACE)!==null&&Qh!==void 0?Qh:process.env.GRPC_TRACE)!==null&&Yh!==void 0?Yh:"",Jh=new Set,ET=new Set;for(let n of vD.split(","))n.startsWith("-")?ET.add(n.substring(1)):Jh.add(n);var SD=Jh.has("all");function TD(n,e,t){wT(e)&&(0,Tt.log)(n,new Date().toISOString()+" | v"+dD+" "+uD.pid+" | "+e+" | "+t)}Tt.trace=TD;function wT(n){return!ET.has(n)&&(SD||Jh.has(n))}Tt.isTracerEnabled=wT});var Hl=D(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});ys.getErrorCode=ys.getErrorMessage=void 0;function ED(n){return n instanceof Error?n.message:String(n)}ys.getErrorMessage=ED;function wD(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}ys.getErrorCode=wD});var Rt=D(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});Yl.Metadata=void 0;var _D=Fe(),bD=fe(),CD=Hl(),ID=/^[0-9a-z_.-]+$/,AD=/^[ -~]*$/;function RD(n){return ID.test(n)}function DD(n){return AD.test(n)}function bT(n){return n.endsWith("-bin")}function kD(n){return!n.startsWith("grpc-")}function Ql(n){return n.toLowerCase()}function _T(n,e){if(!RD(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(bT(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!DD(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Xh=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Ql(e),_T(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Ql(e),_T(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Ql(e),this.internalRepr.delete(e)}get(e){return e=Ql(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(ND);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{bT(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(kD(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,CD.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,_D.log)(bD.LogVerbosity.ERROR,o)}}return t}};Yl.Metadata=Xh;var ND=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var rf=D(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});Jl.CallCredentials=void 0;var nf=Rt();function xD(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var vs=class n{static createFromMetadataGenerator(e){return new ef(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;xD(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new nf.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new tf}};Jl.CallCredentials=vs;var Zh=class n extends vs{constructor(e){super(),this.creds=e}generateMetadata(e){return w(this,null,function*(){let t=new nf.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},ef=class n extends vs{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Zh([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},tf=class n extends vs{generateMetadata(e){return Promise.resolve(new nf.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var of=D(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.getDefaultRootsData=Ss.CIPHER_SUITES=void 0;var OD=pe("fs");Ss.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var CT=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,sf=null;function MD(){return CT?(sf===null&&(sf=OD.readFileSync(CT)),sf):null}Ss.getDefaultRootsData=MD});var ec=D(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.ChannelCredentials=void 0;var PD=pe("tls"),LD=rf(),IT=of();function af(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Ts=class{constructor(e){this.callCredentials=e||LD.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(af(e,"Root certificate"),af(t,"Private key"),af(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,PD.createSecureContext)({ca:(s=e??(0,IT.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:IT.CIPHER_SUITES});return new Xl(o,i??{})}static createFromSecureContext(e,t){return new Xl(e,t??{})}static createInsecure(){return new lf}};Zl.ChannelCredentials=Ts;var lf=class n extends Ts{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Xl=class n extends Ts{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new cf(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},cf=class n extends Ts{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Tr=D(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.validateLoadBalancingConfig=ht.getFirstUsableConfig=ht.isLoadBalancerNameRegistered=ht.createLoadBalancer=ht.registerDefaultLoadBalancerType=ht.registerLoadBalancerType=ht.createChildChannelControlHelper=void 0;function FD(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}ht.createChildChannelControlHelper=FD;var Sr={},uf=null;function BD(n,e,t){Sr[n]={LoadBalancer:e,LoadBalancingConfig:t}}ht.registerLoadBalancerType=BD;function qD(n){uf=n}ht.registerDefaultLoadBalancerType=qD;function UD(n,e){let t=n.getLoadBalancerName();return t in Sr?new Sr[t].LoadBalancer(e):null}ht.createLoadBalancer=UD;function VD(n){return n in Sr}ht.isLoadBalancerNameRegistered=VD;function zD(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Sr)return t;return e&&uf?new Sr[uf].LoadBalancingConfig:null}ht.getFirstUsableConfig=zD;function GD(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Sr)return Sr[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}ht.validateLoadBalancingConfig=GD});var df=D(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.extractAndSelectServiceConfig=Er.validateServiceConfig=Er.validateRetryThrottling=void 0;var jD=pe("os"),tc=fe(),KD=Tr(),nc=/^\d+(\.\d{1,9})?s$/,WD="node";function $D(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function HD(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!nc.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!nc.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(tc.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(tc.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function QD(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!nc.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(tc.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(tc.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function YD(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push($D(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&nc.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=HD(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=QD(n.hedgingPolicy));return t}function AT(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Er.validateRetryThrottling=AT;function RT(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,KD.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(YD(r));"retryThrottling"in n&&(e.retryThrottling=AT(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Er.validateServiceConfig=RT;function JD(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:RT(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function XD(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=JD(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===jD.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===WD&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function ZD(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return XD(i,e)}return null}Er.extractAndSelectServiceConfig=ZD});var Gt=D(rc=>{"use strict";Object.defineProperty(rc,"__esModule",{value:!0});rc.ConnectivityState=void 0;var DT=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(DT||(rc.ConnectivityState=DT={}))});var Lt=D(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.uriToString=wr.splitHostPort=wr.parseUri=void 0;var ek=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function tk(n){let e=ek.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}wr.parseUri=tk;var kT=/^\d+$/;function nk(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return kT.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?kT.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}wr.splitHostPort=nk;function rk(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}wr.uriToString=rk});var wn=D(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.mapUriDefaultScheme=jt.getDefaultAuthority=jt.createResolver=jt.registerDefaultScheme=jt.registerResolver=void 0;var ff=Lt(),Es={},hf=null;function ik(n,e){Es[n]=e}jt.registerResolver=ik;function sk(n){hf=n}jt.registerDefaultScheme=sk;function ok(n,e,t){if(n.scheme!==void 0&&n.scheme in Es)return new Es[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,ff.uriToString)(n)}`)}jt.createResolver=ok;function ak(n){if(n.scheme!==void 0&&n.scheme in Es)return Es[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,ff.uriToString)(n)}`)}jt.getDefaultAuthority=ak;function lk(n){return n.scheme===void 0||!(n.scheme in Es)?hf!==null?{scheme:hf,authority:void 0,path:(0,ff.uriToString)(n)}:null:n}jt.mapUriDefaultScheme=lk});var br=D(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.QueuePicker=_r.UnavailablePicker=_r.PickResultType=void 0;var ck=Rt(),uk=fe(),ic=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(ic||(_r.PickResultType=ic={})),pf=class{constructor(e){this.status=Object.assign({code:uk.Status.UNAVAILABLE,details:"No connection established",metadata:new ck.Metadata},e)}pick(e){return{pickResultType:ic.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};_r.UnavailablePicker=pf;var mf=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:ic.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};_r.QueuePicker=mf});var ra=D(sc=>{"use strict";Object.defineProperty(sc,"__esModule",{value:!0});sc.BackoffTimeout=void 0;var dk=1e3,hk=1.6,fk=12e4,pk=.2;function mk(n,e){return Math.random()*(e-n)+n}var gf=class{constructor(e,t){this.callback=e,this.initialDelay=dk,this.multiplier=hk,this.maxDelay=fk,this.jitter=pk,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+mk(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};sc.BackoffTimeout=gf});var ac=D(oc=>{"use strict";Object.defineProperty(oc,"__esModule",{value:!0});oc.ChildLoadBalancerHandler=void 0;var gk=Tr(),yk=Gt(),vk="child_load_balancer_helper",yf=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===yk.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,gk.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return vk}};oc.ChildLoadBalancerHandler=yf});var xT=D(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});lc.ResolvingLoadBalancer=void 0;var Sk=Tr(),Tk=df(),Dt=Gt(),Ek=wn(),ws=br(),wk=ra(),vf=fe(),_k=Rt(),bk=Fe(),Ck=fe(),Ik=Lt(),Ak=ac(),Rk="resolving_load_balancer";function NT(n){bk.trace(Ck.LogVerbosity.DEBUG,Rk,n)}var Dk=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function kk(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function Nk(n,e,t,r){for(let i of t)if(kk(n,e,i,r))return i;return null}function xk(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of Dk){let u=Nk(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:vf.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:vf.Status.OK,dynamicFilterFactories:[]}}}var Sf=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Dt.ConnectivityState.IDLE,this.latestChildPicker=new ws.QueuePicker(this),this.currentState=Dt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,Tk.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Dt.ConnectivityState.IDLE,new ws.QueuePicker(this)),this.childLoadBalancer=new Ak.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(NT("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,Ek.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let v=null;l===null?c===null?(this.previousServiceConfig=null,v=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):v=this.previousServiceConfig:(v=l,this.previousServiceConfig=l);let b=(f=v?.loadBalancingConfig)!==null&&f!==void 0?f:[],I=(0,Sk.getFirstUsableConfig)(b,!0);if(I===null){this.handleResolutionFailure({code:vf.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new _k.Metadata});return}this.childLoadBalancer.updateAddressList(a,I,d);let C=v??this.defaultServiceConfig;this.onSuccessfulResolution(C,u??xk(C))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new wk.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Dt.ConnectivityState.IDLE&&this.updateState(Dt.ConnectivityState.CONNECTING,new ws.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){NT((0,Ik.uriToString)(this.target)+" "+Dt.ConnectivityState[this.currentState]+" -> "+Dt.ConnectivityState[e]),e===Dt.ConnectivityState.IDLE&&(t=new ws.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Dt.ConnectivityState.IDLE&&(this.updateState(Dt.ConnectivityState.TRANSIENT_FAILURE,new ws.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Dt.ConnectivityState.IDLE||this.currentState===Dt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Dt.ConnectivityState.IDLE,this.latestChildPicker=new ws.QueuePicker(this),this.currentState=Dt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};lc.ResolvingLoadBalancer=Sf});var OT=D(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});_s.channelOptionsEqual=_s.recognizedOptions=void 0;_s.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function Ok(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}_s.channelOptionsEqual=Ok});var bn=D(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.stringToSubchannelAddress=_n.subchannelAddressToString=_n.subchannelAddressEqual=_n.isTcpSubchannelAddress=void 0;var Mk=pe("net");function ia(n){return"port"in n}_n.isTcpSubchannelAddress=ia;function Pk(n,e){return!n&&!e?!0:!n||!e?!1:ia(n)?ia(e)&&n.host===e.host&&n.port===e.port:!ia(e)&&n.path===e.path}_n.subchannelAddressEqual=Pk;function Lk(n){return ia(n)?n.host+":"+n.port:n.path}_n.subchannelAddressToString=Lk;var Fk=443;function Bk(n,e){return(0,Mk.isIP)(n)?{host:n,port:e??Fk}:{path:n}}_n.stringToSubchannelAddress=Bk});var cc=D(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});bs.addAdminServicesToServer=bs.registerAdminService=void 0;var MT=[];function qk(n,e){MT.push({getServiceDefinition:n,getHandlers:e})}bs.registerAdminService=qk;function Uk(n){for(let{getServiceDefinition:e,getHandlers:t}of MT)n.addService(e(),t())}bs.addAdminServicesToServer=Uk});var PT=D(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.ClientDuplexStreamImpl=Kt.ClientWritableStreamImpl=Kt.ClientReadableStreamImpl=Kt.ClientUnaryCallImpl=Kt.callErrorFromStatus=void 0;var Vk=pe("events"),bf=pe("stream"),sa=fe();function zk(n,e){let t=`${n.code} ${sa.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Kt.callErrorFromStatus=zk;var Tf=class extends Vk.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(sa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Kt.ClientUnaryCallImpl=Tf;var Ef=class extends bf.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(sa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Kt.ClientReadableStreamImpl=Ef;var wf=class extends bf.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(sa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Kt.ClientWritableStreamImpl=wf;var _f=class extends bf.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(sa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Kt.ClientDuplexStreamImpl=_f});var LT=D(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});Cs.InterceptingListenerImpl=Cs.isInterceptingListener=void 0;function Gk(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}Cs.isInterceptingListener=Gk;var Cf=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Cs.InterceptingListenerImpl=Cf});var xf=D(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.getInterceptingCall=Wt.InterceptingCall=Wt.RequesterBuilder=Wt.ListenerBuilder=Wt.InterceptorConfigurationError=void 0;var jk=Rt(),FT=LT(),BT=fe(),qT=Hl(),aa=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Wt.InterceptorConfigurationError=aa;var Af=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Wt.ListenerBuilder=Af;var Rf=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Wt.RequesterBuilder=Rf;var If={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},oa={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Df=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:oa.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:oa.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:oa.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:oa.cancel}:this.requester=oa}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var f,v,b;this.processingMetadata=!1;let I;if((0,FT.isInterceptingListener)(d))I=d;else{let C={onReceiveMetadata:(f=d.onReceiveMetadata)!==null&&f!==void 0?f:If.onReceiveMetadata,onReceiveMessage:(v=d.onReceiveMessage)!==null&&v!==void 0?v:If.onReceiveMessage,onReceiveStatus:(b=d.onReceiveStatus)!==null&&b!==void 0?b:If.onReceiveStatus};I=new FT.InterceptingListenerImpl(C,c)}this.nextCall.start(u,I),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Wt.InterceptingCall=Df;function Kk(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var uc=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(BT.Status.INTERNAL,`Request message serialization failure: ${(0,qT.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:BT.Status.INTERNAL,details:`Response message parsing error: ${(0,qT.getErrorMessage)(a)}`,metadata:new jk.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},kf=class extends uc{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},Nf=class extends uc{};function Wk(n,e,t){let r=Kk(n,t.path,e);return t.responseStream?new Nf(r,t):new kf(r,t)}function $k(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new aa("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new aa("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>Wk(r,a,e))(s)}Wt.getInterceptingCall=$k});var Pf=D(hc=>{"use strict";Object.defineProperty(hc,"__esModule",{value:!0});hc.Client=void 0;var Cn=PT(),Hk=Lf(),Qk=Gt(),Cr=fe(),Is=Rt(),dc=xf(),rn=Symbol(),As=Symbol(),Rs=Symbol(),$n=Symbol();function Of(n){return typeof n=="function"}function Ds(n){return n.stack.split(`
`).slice(1).join(`
`)}var Mf=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[As]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[Rs]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[As].length>0&&this[Rs].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[$n]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[rn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[rn]=o(e,t,r)}else this[rn]=new Hk.ChannelImplementation(e,t,r)}close(){this[rn].close()}getChannel(){return this[rn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[rn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===Qk.ConnectivityState.READY)t();else try{this[rn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Of(e))return{metadata:new Is.Metadata,options:{},callback:e};if(Of(t))return e instanceof Is.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Is.Metadata,options:e,callback:t};if(!(e instanceof Is.Metadata&&t instanceof Object&&Of(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new Cn.ClientUnaryCallImpl,channel:this[rn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[$n]&&(f=this[$n](f));let v=f.call,b={clientInterceptors:this[As],clientInterceptorProviders:this[Rs],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},I=(0,dc.getInterceptingCall)(b,f.methodDefinition,f.callOptions,f.channel);v.call=I;let C=null,M=!1,R=new Error;return I.start(f.metadata,{onReceiveMetadata:P=>{v.emit("metadata",P)},onReceiveMessage(P){C!==null&&I.cancelWithStatus(Cr.Status.INTERNAL,"Too many responses received"),C=P},onReceiveStatus(P){if(!M){if(M=!0,P.code===Cr.Status.OK)if(C===null){let L=Ds(R);f.callback((0,Cn.callErrorFromStatus)({code:Cr.Status.INTERNAL,details:"No message received",metadata:P.metadata},L))}else f.callback(null,C);else{let L=Ds(R);f.callback((0,Cn.callErrorFromStatus)(P,L))}R=null,v.emit("status",P)}}}),I.sendMessage(i),I.halfClose(),v}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Cn.ClientWritableStreamImpl(t),channel:this[rn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[$n]&&(d=this[$n](d));let f=d.call,v={clientInterceptors:this[As],clientInterceptorProviders:this[Rs],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},b=(0,dc.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=b;let I=null,C=!1,M=new Error;return b.start(d.metadata,{onReceiveMetadata:R=>{f.emit("metadata",R)},onReceiveMessage(R){I!==null&&b.cancelWithStatus(Cr.Status.INTERNAL,"Too many responses received"),I=R},onReceiveStatus(R){if(!C){if(C=!0,R.code===Cr.Status.OK)if(I===null){let P=Ds(M);d.callback((0,Cn.callErrorFromStatus)({code:Cr.Status.INTERNAL,details:"No message received",metadata:R.metadata},P))}else d.callback(null,I);else{let P=Ds(M);d.callback((0,Cn.callErrorFromStatus)(R,P))}M=null,f.emit("status",R)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof Is.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Is.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Cn.ClientReadableStreamImpl(r),channel:this[rn],methodDefinition:u,callOptions:c.options};this[$n]&&(d=this[$n](d));let f=d.call,v={clientInterceptors:this[As],clientInterceptorProviders:this[Rs],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},b=(0,dc.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=b;let I=!1,C=new Error;return b.start(d.metadata,{onReceiveMetadata(M){f.emit("metadata",M)},onReceiveMessage(M){f.push(M)},onReceiveStatus(M){if(!I){if(I=!0,f.push(null),M.code!==Cr.Status.OK){let R=Ds(C);f.emit("error",(0,Cn.callErrorFromStatus)(M,R))}C=null,f.emit("status",M)}}}),b.sendMessage(i),b.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Cn.ClientDuplexStreamImpl(t,r),channel:this[rn],methodDefinition:c,callOptions:l.options};this[$n]&&(u=this[$n](u));let d=u.call,f={clientInterceptors:this[As],clientInterceptorProviders:this[Rs],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},v=(0,dc.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);d.call=v;let b=!1,I=new Error;return v.start(u.metadata,{onReceiveMetadata(C){d.emit("metadata",C)},onReceiveMessage(C){d.push(C)},onReceiveStatus(C){if(!b){if(b=!0,d.push(null),C.code!==Cr.Status.OK){let M=Ds(I);d.emit("error",(0,Cn.callErrorFromStatus)(C,M))}I=null,d.emit("status",C)}}}),d}};hc.Client=Mf});var Bf=D(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});ks.loadPackageDefinition=ks.makeClientConstructor=void 0;var la=Pf(),Yk={unary:la.Client.prototype.makeUnaryRequest,server_stream:la.Client.prototype.makeServerStreamRequest,client_stream:la.Client.prototype.makeClientStreamRequest,bidi:la.Client.prototype.makeBidiStreamRequest};function Ff(n){return["__proto__","prototype","constructor"].includes(n)}function UT(n,e,t){t||(t={});class r extends la.Client{}return Object.keys(n).forEach(i=>{if(Ff(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=Jk(Yk[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Ff(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}ks.makeClientConstructor=UT;function Jk(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function Xk(n){return"format"in n}function Zk(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Ff(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];Xk(r)?o[s]=r:o[s]=UT(r,s,{})}return e}ks.loadPackageDefinition=Zk});var dE=D((y6,uE)=>{"use strict";var e1=1/0,t1="[object Symbol]",n1=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,r1=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,pc="\\ud800-\\udfff",HT="\\u0300-\\u036f\\ufe20-\\ufe23",QT="\\u20d0-\\u20f0",YT="\\u2700-\\u27bf",JT="a-z\\xdf-\\xf6\\xf8-\\xff",i1="\\xac\\xb1\\xd7\\xf7",s1="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",o1="\\u2000-\\u206f",a1=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",XT="A-Z\\xc0-\\xd6\\xd8-\\xde",ZT="\\ufe0e\\ufe0f",eE=i1+s1+o1+a1,Uf="['\u2019]",l1="["+pc+"]",VT="["+eE+"]",fc="["+HT+QT+"]",tE="\\d+",c1="["+YT+"]",nE="["+JT+"]",rE="[^"+pc+eE+tE+YT+JT+XT+"]",qf="\\ud83c[\\udffb-\\udfff]",u1="(?:"+fc+"|"+qf+")",iE="[^"+pc+"]",Vf="(?:\\ud83c[\\udde6-\\uddff]){2}",zf="[\\ud800-\\udbff][\\udc00-\\udfff]",Ns="["+XT+"]",sE="\\u200d",zT="(?:"+nE+"|"+rE+")",d1="(?:"+Ns+"|"+rE+")",GT="(?:"+Uf+"(?:d|ll|m|re|s|t|ve))?",jT="(?:"+Uf+"(?:D|LL|M|RE|S|T|VE))?",oE=u1+"?",aE="["+ZT+"]?",h1="(?:"+sE+"(?:"+[iE,Vf,zf].join("|")+")"+aE+oE+")*",lE=aE+oE+h1,f1="(?:"+[c1,Vf,zf].join("|")+")"+lE,p1="(?:"+[iE+fc+"?",fc,Vf,zf,l1].join("|")+")",m1=RegExp(Uf,"g"),g1=RegExp(fc,"g"),y1=RegExp(qf+"(?="+qf+")|"+p1+lE,"g"),v1=RegExp([Ns+"?"+nE+"+"+GT+"(?="+[VT,Ns,"$"].join("|")+")",d1+"+"+jT+"(?="+[VT,Ns+zT,"$"].join("|")+")",Ns+"?"+zT+"+"+GT,Ns+"+"+jT,tE,f1].join("|"),"g"),S1=RegExp("["+sE+pc+HT+QT+ZT+"]"),T1=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,E1={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},w1=typeof global=="object"&&global&&global.Object===Object&&global,_1=typeof self=="object"&&self&&self.Object===Object&&self,b1=w1||_1||Function("return this")();function C1(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function I1(n){return n.split("")}function A1(n){return n.match(n1)||[]}function R1(n){return function(e){return n?.[e]}}var D1=R1(E1);function cE(n){return S1.test(n)}function k1(n){return T1.test(n)}function N1(n){return cE(n)?x1(n):I1(n)}function x1(n){return n.match(y1)||[]}function O1(n){return n.match(v1)||[]}var M1=Object.prototype,P1=M1.toString,KT=b1.Symbol,WT=KT?KT.prototype:void 0,$T=WT?WT.toString:void 0;function L1(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function F1(n){if(typeof n=="string")return n;if(z1(n))return $T?$T.call(n):"";var e=n+"";return e=="0"&&1/n==-e1?"-0":e}function B1(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:L1(n,e,t)}function q1(n){return function(e){e=mc(e);var t=cE(e)?N1(e):void 0,r=t?t[0]:e.charAt(0),i=t?B1(t,1).join(""):e.slice(1);return r[n]()+i}}function U1(n){return function(e){return C1($1(K1(e).replace(m1,"")),n,"")}}function V1(n){return!!n&&typeof n=="object"}function z1(n){return typeof n=="symbol"||V1(n)&&P1.call(n)==t1}function mc(n){return n==null?"":F1(n)}var G1=U1(function(n,e,t){return e=e.toLowerCase(),n+(t?j1(e):e)});function j1(n){return W1(mc(n).toLowerCase())}function K1(n){return n=mc(n),n&&n.replace(r1,D1).replace(g1,"")}var W1=q1("toUpperCase");function $1(n,e,t){return n=mc(n),e=t?void 0:e,e===void 0?k1(n)?O1(n):A1(n):n.match(e)||[]}uE.exports=G1});var Gf=D((v6,hE)=>{"use strict";hE.exports=H1;function H1(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f++]=arguments[f];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var gE=D(mE=>{"use strict";var gc=mE;gc.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var xs=new Array(64),pE=new Array(123);for(sn=0;sn<64;)pE[xs[sn]=sn<26?sn+65:sn<52?sn+71:sn<62?sn-4:sn-59|43]=sn++;var sn;gc.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=xs[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=xs[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=xs[l|c>>6],s[o++]=xs[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=xs[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var fE="invalid encoding";gc.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=pE[l])===void 0)throw Error(fE);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(fE);return r-i};gc.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var vE=D((T6,yE)=>{"use strict";yE.exports=yc;function yc(){this._listeners={}}yc.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};yc.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};yc.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var CE=D((E6,bE)=>{"use strict";bE.exports=SE(SE);function SE(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,TE),n.writeFloatBE=e.bind(null,EE);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,wE),n.readFloatBE=t.bind(null,_E)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,TE,0,4),n.writeDoubleBE=e.bind(null,EE,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,f=4294967296*(c&1048575)+l;return d===2047?f?NaN:u*(1/0):d===0?u*5e-324*f:u*Math.pow(2,d-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,wE,0,4),n.readDoubleBE=t.bind(null,_E,4,0)}(),n}function TE(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function EE(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function wE(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function _E(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var jf=D((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var AE=D(IE=>{"use strict";var Kf=IE;Kf.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Kf.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Kf.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var DE=D((_6,RE)=>{"use strict";RE.exports=Q1;function Q1(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var NE=D((b6,kE)=>{"use strict";kE.exports=rt;var ca=In();function rt(n,e){this.lo=n>>>0,this.hi=e>>>0}var Si=rt.zero=new rt(0,0);Si.toNumber=function(){return 0};Si.zzEncode=Si.zzDecode=function(){return this};Si.length=function(){return 1};var Y1=rt.zeroHash="\0\0\0\0\0\0\0\0";rt.fromNumber=function(e){if(e===0)return Si;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new rt(r,i)};rt.from=function(e){if(typeof e=="number")return rt.fromNumber(e);if(ca.isString(e))if(ca.Long)e=ca.Long.fromString(e);else return rt.fromNumber(parseInt(e,10));return e.low||e.high?new rt(e.low>>>0,e.high>>>0):Si};rt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};rt.prototype.toLong=function(e){return ca.Long?new ca.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Ir=String.prototype.charCodeAt;rt.fromHash=function(e){return e===Y1?Si:new rt((Ir.call(e,0)|Ir.call(e,1)<<8|Ir.call(e,2)<<16|Ir.call(e,3)<<24)>>>0,(Ir.call(e,4)|Ir.call(e,5)<<8|Ir.call(e,6)<<16|Ir.call(e,7)<<24)>>>0)};rt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};rt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};rt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};rt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var In=D(Wf=>{"use strict";var W=Wf;W.asPromise=Gf();W.base64=gE();W.EventEmitter=vE();W.float=CE();W.inquire=jf();W.utf8=AE();W.pool=DE();W.LongBits=NE();W.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);W.global=W.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Wf;W.emptyArray=Object.freeze?Object.freeze([]):[];W.emptyObject=Object.freeze?Object.freeze({}):{};W.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};W.isString=function(e){return typeof e=="string"||e instanceof String};W.isObject=function(e){return e&&typeof e=="object"};W.isset=W.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};W.Buffer=function(){try{var n=W.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();W._Buffer_from=null;W._Buffer_allocUnsafe=null;W.newBuffer=function(e){return typeof e=="number"?W.Buffer?W._Buffer_allocUnsafe(e):new W.Array(e):W.Buffer?W._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};W.Array=typeof Uint8Array<"u"?Uint8Array:Array;W.Long=W.global.dcodeIO&&W.global.dcodeIO.Long||W.global.Long||W.inquire("long");W.key2Re=/^true|false|0|1$/;W.key32Re=/^-?(?:0|[1-9][0-9]*)$/;W.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;W.longToHash=function(e){return e?W.LongBits.from(e).toHash():W.LongBits.zeroHash};W.longFromHash=function(e,t){var r=W.LongBits.fromHash(e);return W.Long?W.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function xE(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}W.merge=xE;W.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function OE(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&xE(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}W.newError=OE;W.ProtocolError=OE("ProtocolError");W.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};W.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};W.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};W._configure=function(){var n=W.Buffer;if(!n){W._Buffer_from=W._Buffer_allocUnsafe=null;return}W._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},W._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Sc=D((I6,FE)=>{"use strict";FE.exports=ce;var $t=In(),$f,vc=$t.LongBits,ME=$t.base64,PE=$t.utf8;function ua(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Qf(){}function J1(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function ce(){this.len=0,this.head=new ua(Qf,0,0),this.tail=this.head,this.states=null}var LE=function(){return $t.Buffer?function(){return(ce.create=function(){return new $f})()}:function(){return new ce}};ce.create=LE();ce.alloc=function(e){return new $t.Array(e)};$t.Array!==Array&&(ce.alloc=$t.pool(ce.alloc,$t.Array.prototype.subarray));ce.prototype._push=function(e,t,r){return this.tail=this.tail.next=new ua(e,t,r),this.len+=t,this};function Yf(n,e,t){e[t]=n&255}function X1(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Jf(n,e){this.len=n,this.next=void 0,this.val=e}Jf.prototype=Object.create(ua.prototype);Jf.prototype.fn=X1;ce.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Jf((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ce.prototype.int32=function(e){return e<0?this._push(Xf,10,vc.fromNumber(e)):this.uint32(e)};ce.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Xf(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}ce.prototype.uint64=function(e){var t=vc.from(e);return this._push(Xf,t.length(),t)};ce.prototype.int64=ce.prototype.uint64;ce.prototype.sint64=function(e){var t=vc.from(e).zzEncode();return this._push(Xf,t.length(),t)};ce.prototype.bool=function(e){return this._push(Yf,1,e?1:0)};function Hf(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}ce.prototype.fixed32=function(e){return this._push(Hf,4,e>>>0)};ce.prototype.sfixed32=ce.prototype.fixed32;ce.prototype.fixed64=function(e){var t=vc.from(e);return this._push(Hf,4,t.lo)._push(Hf,4,t.hi)};ce.prototype.sfixed64=ce.prototype.fixed64;ce.prototype.float=function(e){return this._push($t.float.writeFloatLE,4,e)};ce.prototype.double=function(e){return this._push($t.float.writeDoubleLE,8,e)};var Z1=$t.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};ce.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Yf,1,0);if($t.isString(e)){var r=ce.alloc(t=ME.length(e));ME.decode(e,r,0),e=r}return this.uint32(t)._push(Z1,t,e)};ce.prototype.string=function(e){var t=PE.length(e);return t?this.uint32(t)._push(PE.write,t,e):this._push(Yf,1,0)};ce.prototype.fork=function(){return this.states=new J1(this),this.head=this.tail=new ua(Qf,0,0),this.len=0,this};ce.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ua(Qf,0,0),this.len=0),this};ce.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};ce.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};ce._configure=function(n){$f=n,ce.create=LE(),$f._configure()}});var UE=D((A6,qE)=>{"use strict";qE.exports=An;var BE=Sc();(An.prototype=Object.create(BE.prototype)).constructor=An;var Ar=In();function An(){BE.call(this)}An._configure=function(){An.alloc=Ar._Buffer_allocUnsafe,An.writeBytesBuffer=Ar.Buffer&&Ar.Buffer.prototype instanceof Uint8Array&&Ar.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};An.prototype.bytes=function(e){Ar.isString(e)&&(e=Ar._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(An.writeBytesBuffer,t,e),this};function eN(n,e,t){n.length<40?Ar.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}An.prototype.string=function(e){var t=Ar.Buffer.byteLength(e);return this.uint32(t),t&&this._push(eN,t,e),this};An._configure()});var Ec=D((R6,KE)=>{"use strict";KE.exports=Ve;var on=In(),ep,GE=on.LongBits,tN=on.utf8;function an(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Ve(n){this.buf=n,this.pos=0,this.len=n.length}var VE=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ve(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ve(e);throw Error("illegal buffer")},jE=function(){return on.Buffer?function(t){return(Ve.create=function(i){return on.Buffer.isBuffer(i)?new ep(i):VE(i)})(t)}:VE};Ve.create=jE();Ve.prototype._slice=on.Array.prototype.subarray||on.Array.prototype.slice;Ve.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,an(this,10);return e}}();Ve.prototype.int32=function(){return this.uint32()|0};Ve.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Zf(){var n=new GE(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw an(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw an(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Ve.prototype.bool=function(){return this.uint32()!==0};function Tc(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Ve.prototype.fixed32=function(){if(this.pos+4>this.len)throw an(this,4);return Tc(this.buf,this.pos+=4)};Ve.prototype.sfixed32=function(){if(this.pos+4>this.len)throw an(this,4);return Tc(this.buf,this.pos+=4)|0};function zE(){if(this.pos+8>this.len)throw an(this,8);return new GE(Tc(this.buf,this.pos+=4),Tc(this.buf,this.pos+=4))}Ve.prototype.float=function(){if(this.pos+4>this.len)throw an(this,4);var e=on.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ve.prototype.double=function(){if(this.pos+8>this.len)throw an(this,4);var e=on.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ve.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw an(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=on.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Ve.prototype.string=function(){var e=this.bytes();return tN.read(e,0,e.length)};Ve.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw an(this,e);this.pos+=e}else do if(this.pos>=this.len)throw an(this);while(this.buf[this.pos++]&128);return this};Ve.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Ve._configure=function(n){ep=n,Ve.create=jE(),ep._configure();var e=on.Long?"toLong":"toNumber";on.merge(Ve.prototype,{int64:function(){return Zf.call(this)[e](!1)},uint64:function(){return Zf.call(this)[e](!0)},sint64:function(){return Zf.call(this).zzDecode()[e](!1)},fixed64:function(){return zE.call(this)[e](!0)},sfixed64:function(){return zE.call(this)[e](!1)}})}});var QE=D((D6,HE)=>{"use strict";HE.exports=Ti;var $E=Ec();(Ti.prototype=Object.create($E.prototype)).constructor=Ti;var WE=In();function Ti(n){$E.call(this,n)}Ti._configure=function(){WE.Buffer&&(Ti.prototype._slice=WE.Buffer.prototype.slice)};Ti.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ti._configure()});var JE=D((k6,YE)=>{"use strict";YE.exports=da;var tp=In();(da.prototype=Object.create(tp.EventEmitter.prototype)).constructor=da;function da(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");tp.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}da.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return tp.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};da.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var np=D(XE=>{"use strict";var nN=XE;nN.Service=JE()});var rp=D((x6,ZE)=>{"use strict";ZE.exports={}});var nw=D(tw=>{"use strict";var kt=tw;kt.build="minimal";kt.Writer=Sc();kt.BufferWriter=UE();kt.Reader=Ec();kt.BufferReader=QE();kt.util=In();kt.rpc=np();kt.roots=rp();kt.configure=ew;function ew(){kt.util._configure(),kt.Writer._configure(kt.BufferWriter),kt.Reader._configure(kt.BufferReader)}ew()});var iw=D((M6,rw)=>{"use strict";rw.exports=ip;function ip(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(ip.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(b,I){var C=d[f++];switch(I){case"d":case"f":return String(Number(C));case"i":return String(Math.floor(C));case"j":return JSON.stringify(C);case"s":return String(C)}return"%"}),f!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}ip.verbose=!1});var ow=D((P6,sw)=>{"use strict";sw.exports=ha;var rN=Gf(),iN=jf(),sp=iN("fs");function ha(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&sp&&sp.readFile?sp.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?ha.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):ha.xhr(n,e,t):rN(ha,this,n,e)}ha.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var cw=D(lw=>{"use strict";var ap=lw,aw=ap.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},op=ap.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=aw(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};ap.resolve=function(e,t,r){return r||(t=op(t)),aw(t)?t:(r||(e=op(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?op(e+"/"+t):t)}});var Ei=D(uw=>{"use strict";var fa=uw,sN=it(),oN=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function pa(n,e){var t=0,r={};for(e|=0;t<n.length;)r[oN[t+e]]=n[t++];return r}fa.basic=pa([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);fa.defaults=pa([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",sN.emptyArray,null]);fa.long=pa([0,0,0,1,1],7);fa.mapKey=pa([0,0,0,5,5,0,0,0,1,1,0,2],2);fa.packed=pa([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Rr=D((B6,fw)=>{"use strict";fw.exports=Ht;var wc=wi();((Ht.prototype=Object.create(wc.prototype)).constructor=Ht).className="Field";var dw=ln(),hw=Ei(),Qe=it(),lp,aN=/^required|optional|repeated$/;Ht.fromJSON=function(e,t){return new Ht(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Ht(n,e,t,r,i,s,o){if(Qe.isObject(r)?(o=i,s=r,r=i=void 0):Qe.isObject(i)&&(o=s,s=i,i=void 0),wc.call(this,n,s),!Qe.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Qe.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!aN.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Qe.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Qe.Long?hw.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Ht.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Ht.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),wc.prototype.setOption.call(this,e,t,r)};Ht.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Qe.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Ht.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=hw.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof lp?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof dw&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof dw))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Qe.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Qe.base64.test(this.typeDefault)?Qe.base64.decode(this.typeDefault,e=Qe.newBuffer(Qe.base64.length(this.typeDefault)),0):Qe.utf8.write(this.typeDefault,e=Qe.newBuffer(Qe.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Qe.emptyObject:this.repeated?this.defaultValue=Qe.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof lp&&(this.parent.ctor.prototype[this.name]=this.defaultValue),wc.prototype.resolve.call(this)};Ht.d=function(e,t,r,i){return typeof t=="function"?t=Qe.decorateType(t).name:t&&typeof t=="object"&&(t=Qe.decorateEnum(t).name),function(o,a){Qe.decorateType(o.constructor).add(new Ht(a,e,t,r,{default:i}))}};Ht._configure=function(e){lp=e}});var Os=D((q6,gw)=>{"use strict";gw.exports=Qt;var bc=wi();((Qt.prototype=Object.create(bc.prototype)).constructor=Qt).className="OneOf";var pw=Rr(),_c=it();function Qt(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),bc.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Qt.fromJSON=function(e,t){return new Qt(e,t.oneof,t.options,t.comment)};Qt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return _c.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function mw(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Qt.prototype.add=function(e){if(!(e instanceof pw))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,mw(this),this};Qt.prototype.remove=function(e){if(!(e instanceof pw))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Qt.prototype.onAdd=function(e){bc.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}mw(this)};Qt.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);bc.prototype.onRemove.call(this,e)};Qt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){_c.decorateType(i.constructor).add(new Qt(s,e)),Object.defineProperty(i,s,{get:_c.oneOfGetter(e),set:_c.oneOfSetter(e)})}}});var Ls=D((U6,Tw)=>{"use strict";Tw.exports=de;var cp=wi();((de.prototype=Object.create(cp.prototype)).constructor=de).className="Namespace";var yw=Rr(),Cc=it(),lN=Os(),Ms,ma,Ps;de.fromJSON=function(e,t){return new de(e,t.options).addJSON(t.nested)};function vw(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}de.arrayToJSON=vw;de.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};de.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function de(n,e){cp.call(this,n,e),this.nested=void 0,this._nestedArray=null}function Sw(n){return n._nestedArray=null,n}Object.defineProperty(de.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Cc.toArray(this.nested))}});de.prototype.toJSON=function(e){return Cc.toObject(["options",this.options,"nested",vw(this.nestedArray,e)])};de.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Ms.fromJSON:s.values!==void 0?Ps.fromJSON:s.methods!==void 0?ma.fromJSON:s.id!==void 0?yw.fromJSON:de.fromJSON)(r[i],s));return this};de.prototype.get=function(e){return this.nested&&this.nested[e]||null};de.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Ps)return this.nested[e].values;throw Error("no such enum: "+e)};de.prototype.add=function(e){if(!(e instanceof yw&&e.extend!==void 0||e instanceof Ms||e instanceof lN||e instanceof Ps||e instanceof ma||e instanceof de))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof de&&e instanceof de&&!(t instanceof Ms||t instanceof ma)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Sw(this)};de.prototype.remove=function(e){if(!(e instanceof cp))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Sw(this)};de.prototype.define=function(e,t){if(Cc.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof de))throw Error("path conflicts with non-namespace objects")}else r.add(r=new de(i))}return t&&r.addJSON(t),r};de.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof de?e[t++].resolveAll():e[t++].resolve();return this.resolve()};de.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Cc.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof de&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof de&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};de.prototype.lookupType=function(e){var t=this.lookup(e,[Ms]);if(!t)throw Error("no such type: "+e);return t};de.prototype.lookupEnum=function(e){var t=this.lookup(e,[Ps]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};de.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Ms,Ps]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};de.prototype.lookupService=function(e){var t=this.lookup(e,[ma]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};de._configure=function(n,e,t){Ms=n,ma=e,Ps=t}});var Ic=D((V6,Ew)=>{"use strict";Ew.exports=Hn;var up=Rr();((Hn.prototype=Object.create(up.prototype)).constructor=Hn).className="MapField";var cN=Ei(),ga=it();function Hn(n,e,t,r,i,s){if(up.call(this,n,e,r,void 0,void 0,i,s),!ga.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Hn.fromJSON=function(e,t){return new Hn(e,t.id,t.keyType,t.type,t.options,t.comment)};Hn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ga.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Hn.prototype.resolve=function(){if(this.resolved)return this;if(cN.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return up.prototype.resolve.call(this)};Hn.d=function(e,t,r){return typeof r=="function"?r=ga.decorateType(r).name:r&&typeof r=="object"&&(r=ga.decorateEnum(r).name),function(s,o){ga.decorateType(s.constructor).add(new Hn(o,e,t,r))}}});var Ac=D((z6,ww)=>{"use strict";ww.exports=_i;var dp=wi();((_i.prototype=Object.create(dp.prototype)).constructor=_i).className="Method";var Fs=it();function _i(n,e,t,r,i,s,o,a,l){if(Fs.isObject(i)?(o=i,i=s=void 0):Fs.isObject(s)&&(o=s,s=void 0),!(e===void 0||Fs.isString(e)))throw TypeError("type must be a string");if(!Fs.isString(t))throw TypeError("requestType must be a string");if(!Fs.isString(r))throw TypeError("responseType must be a string");dp.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}_i.fromJSON=function(e,t){return new _i(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};_i.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Fs.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};_i.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),dp.prototype.resolve.call(this))}});var Rc=D((G6,bw)=>{"use strict";bw.exports=Yt;var Dr=Ls();((Yt.prototype=Object.create(Dr.prototype)).constructor=Yt).className="Service";var hp=Ac(),ya=it(),uN=np();function Yt(n,e){Dr.call(this,n,e),this.methods={},this._methodsArray=null}Yt.fromJSON=function(e,t){var r=new Yt(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(hp.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Yt.prototype.toJSON=function(e){var t=Dr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return ya.toObject(["options",t&&t.options||void 0,"methods",Dr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Yt.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=ya.toArray(this.methods))}});function _w(n){return n._methodsArray=null,n}Yt.prototype.get=function(e){return this.methods[e]||Dr.prototype.get.call(this,e)};Yt.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Dr.prototype.resolve.call(this)};Yt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof hp?(this.methods[e.name]=e,e.parent=this,_w(this)):Dr.prototype.add.call(this,e)};Yt.prototype.remove=function(e){if(e instanceof hp){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,_w(this)}return Dr.prototype.remove.call(this,e)};Yt.prototype.create=function(e,t,r){for(var i=new uN.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=ya.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=ya.codegen(["r","c"],ya.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Dc=D((j6,Cw)=>{"use strict";Cw.exports=Rn;var dN=In();function Rn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Rn.create=function(e){return this.$type.create(e)};Rn.encode=function(e,t){return this.$type.encode(e,t)};Rn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Rn.decode=function(e){return this.$type.decode(e)};Rn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Rn.verify=function(e){return this.$type.verify(e)};Rn.fromObject=function(e){return this.$type.fromObject(e)};Rn.toObject=function(e,t){return this.$type.toObject(e,t)};Rn.prototype.toJSON=function(){return this.$type.toObject(this,dN.toJSONOptions)}});var fp=D((K6,Aw)=>{"use strict";Aw.exports=pN;var hN=ln(),Qn=Ei(),Iw=it();function fN(n){return"missing required '"+n.name+"'"}function pN(n){var e=Iw.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof hN?"int32":r.type,s="m"+Iw.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),Qn.defaults[r.keyType]!==void 0?e("k=%j",Qn.defaults[r.keyType]):e("k=null"),Qn.defaults[i]!==void 0?e("value=%j",Qn.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),Qn.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),Qn.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),Qn.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),Qn.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):Qn.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",fN(o))}return e("return m")}});var gp=D((W6,Rw)=>{"use strict";Rw.exports=yN;var mN=ln(),pp=it();function Jt(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function mp(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof mN){n("switch(%s){",r)("default:")("return%j",Jt(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",Jt(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Jt(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",Jt(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",Jt(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",Jt(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Jt(e,"buffer"));break}return n}function gN(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",Jt(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",Jt(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",Jt(e,"boolean key"));break}return n}function yN(n){var e=pp.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+pp.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",Jt(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),gN(e,s,"k[i]"),mp(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",Jt(s,"array"))("for(var i=0;i<%s.length;++i){",o),mp(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=pp.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}mp(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var Sp=D(kw=>{"use strict";var Dw=kw,va=ln(),Dn=it();function yp(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof va){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}Dw.fromObject=function(e){var t=e.fieldsArray,r=Dn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Dn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),yp(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),yp(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof va||r("if(d%s!=null){",o),yp(r,s,i,o),s.resolvedType instanceof va||r("}"))}return r("return m")};function vp(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof va?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}Dw.toObject=function(e){var t=e.fieldsArray.slice().sort(Dn.compareFieldsById);if(!t.length)return Dn.codegen()("return {}");for(var r=Dn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Dn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Dn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Dn.safeProp(l.name);if(l.resolvedType instanceof va)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],f=e._fieldsArray.indexOf(l),c=Dn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),vp(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),vp(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),vp(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Dn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var Tp=D(Nw=>{"use strict";var vN=Nw,SN=Dc();vN[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof SN){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var xc=D((Q6,Ow)=>{"use strict";Ow.exports=_e;var cn=Ls();((_e.prototype=Object.create(cn.prototype)).constructor=_e).className="Type";var TN=ln(),_p=Os(),kc=Rr(),EN=Ic(),wN=Rc(),Ep=Dc(),wp=Ec(),_N=Sc(),ft=it(),bN=bp(),CN=fp(),IN=gp(),xw=Sp(),AN=Tp();function _e(n,e){cn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(_e.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=ft.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=ft.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=_e.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Ep||((n.prototype=new Ep).constructor=n,ft.merge(n.prototype,e)),n.$type=n.prototype.$type=this,ft.merge(n,Ep,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:ft.oneOfGetter(this._oneofsArray[t].oneof),set:ft.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});_e.generateConstructor=function(e){for(var t=ft.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",ft.safeProp(i.name)):i.repeated&&t("this%s=[]",ft.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Nc(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}_e.fromJSON=function(e,t){var r=new _e(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?EN.fromJSON:kc.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(_p.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?kc.fromJSON:o.fields!==void 0?_e.fromJSON:o.values!==void 0?TN.fromJSON:o.methods!==void 0?wN.fromJSON:cn.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};_e.prototype.toJSON=function(e){var t=cn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return ft.toObject(["options",t&&t.options||void 0,"oneofs",cn.arrayToJSON(this.oneofsArray,e),"fields",cn.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};_e.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return cn.prototype.resolveAll.call(this)};_e.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};_e.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof kc&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Nc(this)}return e instanceof _p?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Nc(this)):cn.prototype.add.call(this,e)};_e.prototype.remove=function(e){if(e instanceof kc&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Nc(this)}if(e instanceof _p){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Nc(this)}return cn.prototype.remove.call(this,e)};_e.prototype.isReservedId=function(e){return cn.isReservedId(this.reserved,e)};_e.prototype.isReservedName=function(e){return cn.isReservedName(this.reserved,e)};_e.prototype.create=function(e){return new this.ctor(e)};_e.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=bN(this)({Writer:_N,types:t,util:ft}),this.decode=CN(this)({Reader:wp,types:t,util:ft}),this.verify=IN(this)({types:t,util:ft}),this.fromObject=xw.fromObject(this)({types:t,util:ft}),this.toObject=xw.toObject(this)({types:t,util:ft});var i=AN[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};_e.prototype.encode=function(e,t){return this.setup().encode(e,t)};_e.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};_e.prototype.decode=function(e,t){return this.setup().decode(e,t)};_e.prototype.decodeDelimited=function(e){return e instanceof wp||(e=wp.create(e)),this.decode(e,e.uint32())};_e.prototype.verify=function(e){return this.setup().verify(e)};_e.prototype.fromObject=function(e){return this.setup().fromObject(e)};_e.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};_e.d=function(e){return function(r){ft.decorateType(r,e)}}});var Pc=D((Y6,Bw)=>{"use strict";Bw.exports=Ft;var Mc=Ls();((Ft.prototype=Object.create(Mc.prototype)).constructor=Ft).className="Root";var Ip=Rr(),Pw=ln(),RN=Os(),kr=it(),Lw,Cp,Sa;function Ft(n){Mc.call(this,"",n),this.deferred=[],this.files=[]}Ft.fromJSON=function(e,t){return t||(t=new Ft),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};Ft.prototype.resolvePath=kr.path.resolve;Ft.prototype.fetch=kr.fetch;function Fw(){}Ft.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return kr.asPromise(n,i,e,t);var s=r===Fw;function o(v,b){if(r){if(s)throw v;var I=r;r=null,I(v,b)}}function a(v){var b=v.lastIndexOf("google/protobuf/");if(b>-1){var I=v.substring(b);if(I in Sa)return I}return null}function l(v,b){try{if(kr.isString(b)&&b.charAt(0)==="{"&&(b=JSON.parse(b)),!kr.isString(b))i.setOptions(b.options).addJSON(b.nested);else{Cp.filename=v;var I=Cp(b,i,t),C,M=0;if(I.imports)for(;M<I.imports.length;++M)(C=a(I.imports[M])||i.resolvePath(v,I.imports[M]))&&c(C);if(I.weakImports)for(M=0;M<I.weakImports.length;++M)(C=a(I.weakImports[M])||i.resolvePath(v,I.weakImports[M]))&&c(C,!0)}}catch(R){o(R)}!s&&!u&&o(null,i)}function c(v,b){if(v=a(v)||v,!(i.files.indexOf(v)>-1)){if(i.files.push(v),v in Sa){s?l(v,Sa[v]):(++u,setTimeout(function(){--u,l(v,Sa[v])}));return}if(s){var I;try{I=kr.fs.readFileSync(v).toString("utf8")}catch(C){b||o(C);return}l(v,I)}else++u,i.fetch(v,function(C,M){if(--u,!!r){if(C){b?u||o(null,i):o(C);return}l(v,M)}})}}var u=0;kr.isString(e)&&(e=[e]);for(var d=0,f;d<e.length;++d)(f=i.resolvePath("",e[d]))&&c(f);if(s)return i;u||o(null,i)};Ft.prototype.loadSync=function(e,t){if(!kr.isNode)throw Error("not supported");return this.load(e,t,Fw)};Ft.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Mc.prototype.resolveAll.call(this)};var Oc=/^[A-Z]/;function Mw(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Ip(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}Ft.prototype._handleAdd=function(e){if(e instanceof Ip)e.extend!==void 0&&!e.extensionField&&(Mw(this,e)||this.deferred.push(e));else if(e instanceof Pw)Oc.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof RN)){if(e instanceof Lw)for(var t=0;t<this.deferred.length;)Mw(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Oc.test(e.name)&&(e.parent[e.name]=e)}};Ft.prototype._handleRemove=function(e){if(e instanceof Ip){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof Pw)Oc.test(e.name)&&delete e.parent[e.name];else if(e instanceof Mc){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Oc.test(e.name)&&delete e.parent[e.name]}};Ft._configure=function(n,e,t){Lw=n,Cp=e,Sa=t}});var it=D((J6,Uw)=>{"use strict";var ze=Uw.exports=In(),qw=rp(),Ap,Rp;ze.codegen=iw();ze.fetch=ow();ze.path=cw();ze.fs=ze.inquire("fs");ze.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};ze.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var DN=/\\/g,kN=/"/g;ze.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};ze.safeProp=function(e){return!/^[$\w_]+$/.test(e)||ze.isReserved(e)?'["'+e.replace(DN,"\\\\").replace(kN,'\\"')+'"]':"."+e};ze.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var NN=/_([a-z])/g;ze.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(NN,function(t,r){return r.toUpperCase()})};ze.compareFieldsById=function(e,t){return e.id-t.id};ze.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(ze.decorateRoot.remove(e.$type),e.$type.name=t,ze.decorateRoot.add(e.$type)),e.$type;Ap||(Ap=xc());var r=new Ap(t||e.name);return ze.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var xN=0;ze.decorateEnum=function(e){if(e.$type)return e.$type;Rp||(Rp=ln());var t=new Rp("Enum"+xN++,e);return ze.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};ze.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(ze,"decorateRoot",{get:function(){return qw.decorated||(qw.decorated=new(Pc()))}})});var wi=D((X6,Vw)=>{"use strict";Vw.exports=Bt;Bt.className="ReflectionObject";var Lc=it(),Fc;function Bt(n,e){if(!Lc.isString(n))throw TypeError("name must be a string");if(e&&!Lc.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Bt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Bt.prototype.toJSON=function(){throw Error()};Bt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Fc&&t._handleAdd(this)};Bt.prototype.onRemove=function(e){var t=e.root;t instanceof Fc&&t._handleRemove(this),this.parent=null,this.resolved=!1};Bt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Fc&&(this.resolved=!0),this)};Bt.prototype.getOption=function(e){if(this.options)return this.options[e]};Bt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Bt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Lc.setProperty(o,r,t)}else s={},s[e]=Lc.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Bt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Bt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Bt._configure=function(n){Fc=n}});var ln=D((Z6,jw)=>{"use strict";jw.exports=kn;var zw=wi();((kn.prototype=Object.create(zw.prototype)).constructor=kn).className="Enum";var Gw=Ls(),Bc=it();function kn(n,e,t,r,i,s){if(zw.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}kn.fromJSON=function(e,t){var r=new kn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};kn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Bc.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};kn.prototype.add=function(e,t,r,i){if(!Bc.isString(e))throw TypeError("name must be a string");if(!Bc.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};kn.prototype.remove=function(e){if(!Bc.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};kn.prototype.isReservedId=function(e){return Gw.isReservedId(this.reserved,e)};kn.prototype.isReservedName=function(e){return Gw.isReservedName(this.reserved,e)}});var bp=D((e9,Ww)=>{"use strict";Ww.exports=MN;var ON=ln(),Dp=Ei(),kp=it();function Kw(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function MN(n){for(var e=kp.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(kp.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof ON?"int32":s.type,l=Dp.basic[a];r="m"+kp.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Dp.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Dp.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?Kw(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?Kw(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var Hw=D((t9,$w)=>{"use strict";var ae=$w.exports=nw();ae.build="light";function PN(n,e,t){return typeof e=="function"?(t=e,e=new ae.Root):e||(e=new ae.Root),e.load(n,t)}ae.load=PN;function LN(n,e){return e||(e=new ae.Root),e.loadSync(n)}ae.loadSync=LN;ae.encoder=bp();ae.decoder=fp();ae.verifier=gp();ae.converter=Sp();ae.ReflectionObject=wi();ae.Namespace=Ls();ae.Root=Pc();ae.Enum=ln();ae.Type=xc();ae.Field=Rr();ae.OneOf=Os();ae.MapField=Ic();ae.Service=Rc();ae.Method=Ac();ae.Message=Dc();ae.wrappers=Tp();ae.types=Ei();ae.util=it();ae.ReflectionObject._configure(ae.Root);ae.Namespace._configure(ae.Type,ae.Service,ae.Enum);ae.Root._configure(ae.Type);ae.Field._configure(ae.Type)});var xp=D((n9,Jw)=>{"use strict";Jw.exports=Yw;var Np=/[\s{}=;:[\],'"()<>]/g,FN=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,BN=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,qN=/^ *[*/]+ */,UN=/^\s*\*?\/*/,VN=/\n/g,zN=/\s/,GN=/\\(.?)/g,jN={0:"\0",r:"\r",n:`
`,t:"	"};function Qw(n){return n.replace(GN,function(e,t){switch(t){case"\\":case"":return t;default:return jN[t]||""}})}Yw.unescape=Qw;function Yw(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(L){return Error("illegal "+L+" (line "+i+")")}function u(){var L=l==="'"?BN:FN;L.lastIndex=t-1;var z=L.exec(n);if(!z)throw c("string");return t=L.lastIndex,C(l),l=null,Qw(z[1])}function d(L){return n.charAt(L)}function f(L,z,Q){var T={type:n.charAt(L++),lineEmpty:!1,leading:Q},g;e?g=2:g=3;var y=L-g,S;do if(--y<0||(S=n.charAt(y))===`
`){T.lineEmpty=!0;break}while(S===" "||S==="	");for(var m=n.substring(L,z).split(VN),E=0;E<m.length;++E)m[E]=m[E].replace(e?UN:qN,"").trim();T.text=m.join(`
`).trim(),o[i]=T,s=i}function v(L){var z=b(L),Q=n.substring(L,z),T=/^\s*\/\//.test(Q);return T}function b(L){for(var z=L;z<r&&d(z)!==`
`;)z++;return z}function I(){if(a.length>0)return a.shift();if(l)return u();var L,z,Q,T,g,y=t===0;do{if(t===r)return null;for(L=!1;zN.test(Q=d(t));)if(Q===`
`&&(y=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(T=t,g=!1,v(t-1)){g=!0;do if(t=b(t),t===r||(t++,!y))break;while(v(t))}else t=Math.min(r,b(t)+1);g&&(f(T,t,y),y=!0),i++,L=!0}else{for(g=d(T=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,g&&(f(T,t-1,y),y=!0),++i,L=!0}else if((Q=d(t))==="*"){T=t+1,g=e||d(T)==="*";do{if(Q===`
`&&++i,++t===r)throw c("comment");z=Q,Q=d(t)}while(z!=="*"||Q!=="/");++t,g&&(f(T,t-2,y),y=!0),L=!0}else return"/"}}while(L);var S=t;Np.lastIndex=0;var m=Np.test(d(S++));if(!m)for(;S<r&&!Np.test(d(S));)++S;var E=n.substring(t,t=S);return(E==='"'||E==="'")&&(l=E),E}function C(L){a.push(L)}function M(){if(!a.length){var L=I();if(L===null)return null;C(L)}return a[0]}function R(L,z){var Q=M(),T=Q===L;if(T)return I(),!0;if(!z)throw c("token '"+Q+"', '"+L+"' expected");return!1}function P(L){var z=null,Q;return L===void 0?(Q=o[i-1],delete o[i-1],Q&&(e||Q.type==="*"||Q.lineEmpty)&&(z=Q.leading?Q.text:null)):(s<L&&M(),Q=o[L],delete o[L],Q&&!Q.lineEmpty&&(e||Q.type==="/")&&(z=Q.leading?null:Q.text)),z}return Object.defineProperty({next:I,peek:M,push:C,skip:R,cmnt:P},"line",{get:function(){return i}})}});var r_=D((r9,n_)=>{"use strict";n_.exports=Yn;Yn.filename=null;Yn.defaults={keepCase:!1};var KN=xp(),Xw=Pc(),Zw=xc(),e_=Rr(),WN=Ic(),t_=Os(),$N=ln(),HN=Rc(),QN=Ac(),Op=Ei(),Mp=it(),YN=/^[1-9][0-9]*$/,JN=/^-?[1-9][0-9]*$/,XN=/^0[x][0-9a-fA-F]+$/,ZN=/^-?0[x][0-9a-fA-F]+$/,ex=/^0[0-7]+$/,tx=/^-?0[0-7]+$/,nx=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Nn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,xn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,rx=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Yn(n,e,t){e instanceof Xw||(t=e,e=new Xw),t||(t=Yn.defaults);var r=t.preferTrailingComment||!1,i=KN(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,f,v,b,I=!1,C=e,M=t.keepCase?function(N){return N}:Mp.camelCase;function R(N,x,B){var H=Yn.filename;return B||(Yn.filename=null),Error("illegal "+(x||"token")+" '"+N+"' ("+(H?H+", ":"")+"line "+i.line+")")}function P(){var N=[],x;do{if((x=s())!=='"'&&x!=="'")throw R(x);N.push(s()),l(x),x=a()}while(x==='"'||x==="'");return N.join("")}function L(N){var x=s();switch(x){case"'":case'"':return o(x),P();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return Q(x,!0)}catch{if(N&&xn.test(x))return x;throw R(x,"value")}}function z(N,x){var B,H;do x&&((B=a())==='"'||B==="'")?N.push(P()):N.push([H=T(s()),l("to",!0)?T(s()):H]);while(l(",",!0));var K={options:void 0};K.setOption=function(ee,Ne){this.options===void 0&&(this.options={}),this.options[ee]=Ne},E(K,function(Ne){if(Ne==="option")we(K,Ne),l(";");else throw R(Ne)},function(){at(K)})}function Q(N,x){var B=1;switch(N.charAt(0)==="-"&&(B=-1,N=N.substring(1)),N){case"inf":case"INF":case"Inf":return B*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(YN.test(N))return B*parseInt(N,10);if(XN.test(N))return B*parseInt(N,16);if(ex.test(N))return B*parseInt(N,8);if(nx.test(N))return B*parseFloat(N);throw R(N,"number",x)}function T(N,x){switch(N){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!x&&N.charAt(0)==="-")throw R(N,"id");if(JN.test(N))return parseInt(N,10);if(ZN.test(N))return parseInt(N,16);if(tx.test(N))return parseInt(N,8);throw R(N,"id")}function g(){if(d!==void 0)throw R("package");if(d=s(),!xn.test(d))throw R(d,"name");C=C.define(d),l(";")}function y(){var N=a(),x;switch(N){case"weak":x=v||(v=[]),s();break;case"public":s();default:x=f||(f=[]);break}N=P(),l(";"),x.push(N)}function S(){if(l("="),b=P(),I=b==="proto3",!I&&b!=="proto2")throw R(b,"syntax");e.setOption("syntax",b),l(";")}function m(N,x){switch(x){case"option":return we(N,x),l(";"),!0;case"message":return h(N,x),!0;case"enum":return ve(N,x),!0;case"service":return $e(N,x),!0;case"extend":return as(N,x),!0}return!1}function E(N,x,B){var H=i.line;if(N&&(typeof N.comment!="string"&&(N.comment=c()),N.filename=Yn.filename),l("{",!0)){for(var K;(K=s())!=="}";)x(K);l(";",!0)}else B&&B(),l(";"),N&&(typeof N.comment!="string"||r)&&(N.comment=c(H)||N.comment)}function h(N,x){if(!Nn.test(x=s()))throw R(x,"type name");var B=new Zw(x);E(B,function(K){if(!m(B,K))switch(K){case"map":ie(B,K);break;case"required":case"repeated":p(B,K);break;case"optional":I?p(B,"proto3_optional"):p(B,"optional");break;case"oneof":Ee(B,K);break;case"extensions":z(B.extensions||(B.extensions=[]));break;case"reserved":z(B.reserved||(B.reserved=[]),!0);break;default:if(!I||!xn.test(K))throw R(K);o(K),p(B,"optional");break}}),N.add(B)}function p(N,x,B){var H=s();if(H==="group"){F(N,x);return}for(;H.endsWith(".")||a().startsWith(".");)H+=s();if(!xn.test(H))throw R(H,"type");var K=s();if(!Nn.test(K))throw R(K,"name");K=M(K),l("=");var ee=new e_(K,T(s()),H,x,B);if(E(ee,function(Mt){if(Mt==="option")we(ee,Mt),l(";");else throw R(Mt)},function(){at(ee)}),x==="proto3_optional"){var Ne=new t_("_"+K);ee.setOption("proto3_optional",!0),Ne.add(ee),N.add(Ne)}else N.add(ee);!I&&ee.repeated&&(Op.packed[H]!==void 0||Op.basic[H]===void 0)&&ee.setOption("packed",!1,!0)}function F(N,x){var B=s();if(!Nn.test(B))throw R(B,"name");var H=Mp.lcFirst(B);B===H&&(B=Mp.ucFirst(B)),l("=");var K=T(s()),ee=new Zw(B);ee.group=!0;var Ne=new e_(H,K,B,x);Ne.filename=Yn.filename,E(ee,function(Mt){switch(Mt){case"option":we(ee,Mt),l(";");break;case"required":case"repeated":p(ee,Mt);break;case"optional":I?p(ee,"proto3_optional"):p(ee,"optional");break;case"message":h(ee,Mt);break;case"enum":ve(ee,Mt);break;default:throw R(Mt)}}),N.add(ee).add(Ne)}function ie(N){l("<");var x=s();if(Op.mapKey[x]===void 0)throw R(x,"type");l(",");var B=s();if(!xn.test(B))throw R(B,"type");l(">");var H=s();if(!Nn.test(H))throw R(H,"name");l("=");var K=new WN(M(H),T(s()),x,B);E(K,function(Ne){if(Ne==="option")we(K,Ne),l(";");else throw R(Ne)},function(){at(K)}),N.add(K)}function Ee(N,x){if(!Nn.test(x=s()))throw R(x,"name");var B=new t_(M(x));E(B,function(K){K==="option"?(we(B,K),l(";")):(o(K),p(B,"optional"))}),N.add(B)}function ve(N,x){if(!Nn.test(x=s()))throw R(x,"name");var B=new $N(x);E(B,function(K){switch(K){case"option":we(B,K),l(";");break;case"reserved":z(B.reserved||(B.reserved=[]),!0);break;default:qe(B,K)}}),N.add(B)}function qe(N,x){if(!Nn.test(x))throw R(x,"name");l("=");var B=T(s(),!0),H={options:void 0};H.setOption=function(K,ee){this.options===void 0&&(this.options={}),this.options[K]=ee},E(H,function(ee){if(ee==="option")we(H,ee),l(";");else throw R(ee)},function(){at(H)}),N.add(x,B,H.comment,H.options)}function we(N,x){var B=l("(",!0);if(!xn.test(x=s()))throw R(x,"name");var H=x,K=H,ee;B&&(l(")"),H="("+H+")",K=H,x=a(),rx.test(x)&&(ee=x.slice(1),H+=x,s())),l("=");var Ne=yt(N,H);Le(N,K,Ne,ee)}function yt(N,x){if(l("{",!0)){for(var B={};!l("}",!0);){if(!Nn.test(ut=s()))throw R(ut,"name");if(ut===null)throw R(ut,"end of input");var H,K=ut;if(l(":",!0),a()==="{")H=yt(N,x+"."+ut);else if(a()==="["){H=[];var ee;if(l("[",!0)){do ee=L(!0),H.push(ee);while(l(",",!0));l("]"),typeof ee<"u"&&We(N,x+"."+ut,ee)}}else H=L(!0),We(N,x+"."+ut,H);var Ne=B[K];Ne&&(H=[].concat(Ne).concat(H)),B[K]=H,l(",",!0),l(";",!0)}return B}var dr=L(!0);return We(N,x,dr),dr}function We(N,x,B){N.setOption&&N.setOption(x,B)}function Le(N,x,B,H){N.setParsedOption&&N.setParsedOption(x,B,H)}function at(N){if(l("[",!0)){do we(N,"option");while(l(",",!0));l("]")}return N}function $e(N,x){if(!Nn.test(x=s()))throw R(x,"service name");var B=new HN(x);E(B,function(K){if(!m(B,K))if(K==="rpc")vt(B,K);else throw R(K)}),N.add(B)}function vt(N,x){var B=c(),H=x;if(!Nn.test(x=s()))throw R(x,"name");var K=x,ee,Ne,dr,Mt;if(l("("),l("stream",!0)&&(Ne=!0),!xn.test(x=s())||(ee=x,l(")"),l("returns"),l("("),l("stream",!0)&&(Mt=!0),!xn.test(x=s())))throw R(x);dr=x,l(")");var Ml=new QN(K,H,ee,dr,Ne,Mt);Ml.comment=B,E(Ml,function(Sh){if(Sh==="option")we(Ml,Sh),l(";");else throw R(Sh)}),N.add(Ml)}function as(N,x){if(!xn.test(x=s()))throw R(x,"reference");var B=x;E(null,function(K){switch(K){case"required":case"repeated":p(N,K,B);break;case"optional":I?p(N,"proto3_optional",B):p(N,"optional",B);break;default:if(!I||!xn.test(K))throw R(K);o(K),p(N,"optional",B);break}})}for(var ut;(ut=s())!==null;)switch(ut){case"package":if(!u)throw R(ut);g();break;case"import":if(!u)throw R(ut);y();break;case"syntax":if(!u)throw R(ut);S();break;case"option":we(C,ut),l(";");break;default:if(m(C,ut)){u=!1;continue}throw R(ut)}return Yn.filename=null,{package:d,imports:f,weakImports:v,syntax:b,root:e}}});var o_=D((i9,s_)=>{"use strict";s_.exports=un;var ix=/\/|\./;function un(n,e){ix.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),un[n]=e}un("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var i_;un("duration",{Duration:i_={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});un("timestamp",{Timestamp:i_});un("empty",{Empty:{fields:{}}});un("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});un("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});un("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});un.get=function(e){return un[e]||null}});var l_=D((s9,a_)=>{"use strict";var Nr=a_.exports=Hw();Nr.build="full";Nr.tokenize=xp();Nr.parse=r_();Nr.common=o_();Nr.Root._configure(Nr.Type,Nr.parse,Nr.common)});var qc=D((o9,c_)=>{"use strict";c_.exports=l_()});var Pp=D((a9,sx)=>{sx.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var p_=D((te,f_)=>{"use strict";var Et=qc();f_.exports=te=Et.descriptor=Et.Root.fromJSON(Pp()).lookup(".google.protobuf");var u_=Et.Namespace,Ta=Et.Root,Jn=Et.Enum,xr=Et.Type,Or=Et.Field,ox=Et.MapField,Uc=Et.OneOf,Ea=Et.Service,Vc=Et.Method;Ta.fromDescriptor=function(e){typeof e.length=="number"&&(e=te.FileDescriptorSet.decode(e));var t=new Ta;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(xr.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(Jn.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(Or.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Ea.fromDescriptor(r.service[o]));var a=Bs(r.options,te.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Ta.prototype.toDescriptor=function(e){var t=te.FileDescriptorSet.create();return d_(this,t.file,e),t};function d_(n,e,t){var r=te.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Ta||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof xr?r.messageType.push(s.toDescriptor(t)):s instanceof Jn?r.enumType.push(s.toDescriptor()):s instanceof Or?r.extension.push(s.toDescriptor(t)):s instanceof Ea?r.service.push(s.toDescriptor()):s instanceof u_&&d_(s,e,t);r.options=qs(n.options,te.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var ax=0;xr.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=te.DescriptorProto.decode(e));var r=new xr(e.name.length?e.name:"Type"+ax++,Bs(e.options,te.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Uc.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=Or.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(Or.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(xr.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Jn.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};xr.prototype.toDescriptor=function(e){var t=te.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof ox){var s=Lp(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Lp(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&h_(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(te.DescriptorProto.create({name:i.typeName,field:[te.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),te.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:te.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof Or?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof xr?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Jn&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(te.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(te.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=qs(this.options,te.MessageOptions),t};var lx=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Or.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=te.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=fx(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new Or(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=Bs(e.options,te.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=lx.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return px(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};Or.prototype.toDescriptor=function(e){var t=te.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Et.util.ucFirst(this.name),t.label=3;else{switch(t.type=Lp(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?h_(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=qs(this.options,te.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=te.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=te.FieldOptions.create())).packed=!0),t};var cx=0;Jn.fromDescriptor=function(e){typeof e.length=="number"&&(e=te.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Jn(e.name&&e.name.length?e.name:"Enum"+cx++,t,Bs(e.options,te.EnumOptions))};Jn.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(te.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return te.EnumDescriptorProto.create({name:this.name,value:e,options:qs(this.options,te.EnumOptions)})};var ux=0;Uc.fromDescriptor=function(e){return typeof e.length=="number"&&(e=te.OneofDescriptorProto.decode(e)),new Uc(e.name&&e.name.length?e.name:"oneof"+ux++)};Uc.prototype.toDescriptor=function(){return te.OneofDescriptorProto.create({name:this.name})};var dx=0;Ea.fromDescriptor=function(e){typeof e.length=="number"&&(e=te.ServiceDescriptorProto.decode(e));var t=new Ea(e.name&&e.name.length?e.name:"Service"+dx++,Bs(e.options,te.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Vc.fromDescriptor(e.method[r]));return t};Ea.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return te.ServiceDescriptorProto.create({name:this.name,method:e,options:qs(this.options,te.ServiceOptions)})};var hx=0;Vc.fromDescriptor=function(e){return typeof e.length=="number"&&(e=te.MethodDescriptorProto.decode(e)),new Vc(e.name&&e.name.length?e.name:"Method"+hx++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Bs(e.options,te.MethodOptions))};Vc.prototype.toDescriptor=function(){return te.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:qs(this.options,te.MethodOptions)})};function fx(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function px(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Lp(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Jn)return 14;if(e instanceof xr)return e.group?10:11;throw Error("illegal type: "+n)}function Bs(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof Jn&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(mx(s),o));return t.length?Et.util.toObject(t):void 0}}function qs(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Et.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Et.util.toObject(t)):void 0}}function h_(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Ta)&&e instanceof u_)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function mx(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var m_=D((l9,gx)=>{gx.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var g_=D((c9,yx)=>{yx.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var y_=D((u9,vx)=>{vx.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var E_=D(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.addCommonProtos=Mr.loadProtosWithOptionsSync=Mr.loadProtosWithOptions=void 0;var v_=pe("fs"),S_=pe("path"),Us=qc();function T_(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(S_.isAbsolute(i))return i;for(let s of e){let o=S_.join(s,i);try{return v_.accessSync(o,v_.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function Sx(n,e){return w(this,null,function*(){let t=new Us.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));T_(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}Mr.loadProtosWithOptions=Sx;function Tx(n,e){let t=new Us.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");T_(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}Mr.loadProtosWithOptionsSync=Tx;function Ex(){let n=m_(),e=Pp(),t=g_(),r=y_();Us.common("api",n.nested.google.nested.protobuf.nested),Us.common("descriptor",e.nested.google.nested.protobuf.nested),Us.common("source_context",t.nested.google.nested.protobuf.nested),Us.common("type",r.nested.google.nested.protobuf.nested)}Mr.addCommonProtos=Ex});var w_=D((wa,Fp)=>{"use strict";(function(n,e){function t(r){return"default"in r?r.default:r}typeof define=="function"&&define.amd?define([],function(){var r={};return e(r),t(r)}):typeof wa=="object"?(e(wa),typeof Fp=="object"&&(Fp.exports=t(wa))):function(){var r={};e(r),n.Long=t(r)}()})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:wa,function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(h,p,F){this.low=h|0,this.high=p|0,this.unsigned=!!F}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(h){return(h&&h.__isLong__)===!0}function i(h){var p=Math.clz32(h&-h);return h?31-p:p}t.isLong=r;var s={},o={};function a(h,p){var F,ie,Ee;return p?(h>>>=0,(Ee=0<=h&&h<256)&&(ie=o[h],ie)?ie:(F=c(h,0,!0),Ee&&(o[h]=F),F)):(h|=0,(Ee=-128<=h&&h<128)&&(ie=s[h],ie)?ie:(F=c(h,h<0?-1:0,!1),Ee&&(s[h]=F),F))}t.fromInt=a;function l(h,p){if(isNaN(h))return p?L:P;if(p){if(h<0)return L;if(h>=C)return y}else{if(h<=-M)return S;if(h+1>=M)return g}return h<0?l(-h,p).neg():c(h%I|0,h/I|0,p)}t.fromNumber=l;function c(h,p,F){return new t(h,p,F)}t.fromBits=c;var u=Math.pow;function d(h,p,F){if(h.length===0)throw Error("empty string");if(typeof p=="number"?(F=p,p=!1):p=!!p,h==="NaN"||h==="Infinity"||h==="+Infinity"||h==="-Infinity")return p?L:P;if(F=F||10,F<2||36<F)throw RangeError("radix");var ie;if((ie=h.indexOf("-"))>0)throw Error("interior hyphen");if(ie===0)return d(h.substring(1),p,F).neg();for(var Ee=l(u(F,8)),ve=P,qe=0;qe<h.length;qe+=8){var we=Math.min(8,h.length-qe),yt=parseInt(h.substring(qe,qe+we),F);if(we<8){var We=l(u(F,we));ve=ve.mul(We).add(l(yt))}else ve=ve.mul(Ee),ve=ve.add(l(yt))}return ve.unsigned=p,ve}t.fromString=d;function f(h,p){return typeof h=="number"?l(h,p):typeof h=="string"?d(h,p):c(h.low,h.high,typeof p=="boolean"?p:h.unsigned)}t.fromValue=f;var v=65536,b=1<<24,I=v*v,C=I*I,M=C/2,R=a(b),P=a(0);t.ZERO=P;var L=a(0,!0);t.UZERO=L;var z=a(1);t.ONE=z;var Q=a(1,!0);t.UONE=Q;var T=a(-1);t.NEG_ONE=T;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var S=c(0,-2147483648,!1);t.MIN_VALUE=S;var m=t.prototype;m.toInt=function(){return this.unsigned?this.low>>>0:this.low},m.toNumber=function(){return this.unsigned?(this.high>>>0)*I+(this.low>>>0):this.high*I+(this.low>>>0)},m.toString=function(p){if(p=p||10,p<2||36<p)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(S)){var F=l(p),ie=this.div(F),Ee=ie.mul(F).sub(this);return ie.toString(p)+Ee.toInt().toString(p)}else return"-"+this.neg().toString(p);for(var ve=l(u(p,6),this.unsigned),qe=this,we="";;){var yt=qe.div(ve),We=qe.sub(yt.mul(ve)).toInt()>>>0,Le=We.toString(p);if(qe=yt,qe.isZero())return Le+we;for(;Le.length<6;)Le="0"+Le;we=""+Le+we}},m.getHighBits=function(){return this.high},m.getHighBitsUnsigned=function(){return this.high>>>0},m.getLowBits=function(){return this.low},m.getLowBitsUnsigned=function(){return this.low>>>0},m.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var p=this.high!=0?this.high:this.low,F=31;F>0&&!(p&1<<F);F--);return this.high!=0?F+33:F+1},m.isSafeInteger=function(){var p=this.high>>21;return p?this.unsigned?!1:p===-1&&!(this.low===0&&this.high===-2097152):!0},m.isZero=function(){return this.high===0&&this.low===0},m.eqz=m.isZero,m.isNegative=function(){return!this.unsigned&&this.high<0},m.isPositive=function(){return this.unsigned||this.high>=0},m.isOdd=function(){return(this.low&1)===1},m.isEven=function(){return(this.low&1)===0},m.equals=function(p){return r(p)||(p=f(p)),this.unsigned!==p.unsigned&&this.high>>>31===1&&p.high>>>31===1?!1:this.high===p.high&&this.low===p.low},m.eq=m.equals,m.notEquals=function(p){return!this.eq(p)},m.neq=m.notEquals,m.ne=m.notEquals,m.lessThan=function(p){return this.comp(p)<0},m.lt=m.lessThan,m.lessThanOrEqual=function(p){return this.comp(p)<=0},m.lte=m.lessThanOrEqual,m.le=m.lessThanOrEqual,m.greaterThan=function(p){return this.comp(p)>0},m.gt=m.greaterThan,m.greaterThanOrEqual=function(p){return this.comp(p)>=0},m.gte=m.greaterThanOrEqual,m.ge=m.greaterThanOrEqual,m.compare=function(p){if(r(p)||(p=f(p)),this.eq(p))return 0;var F=this.isNegative(),ie=p.isNegative();return F&&!ie?-1:!F&&ie?1:this.unsigned?p.high>>>0>this.high>>>0||p.high===this.high&&p.low>>>0>this.low>>>0?-1:1:this.sub(p).isNegative()?-1:1},m.comp=m.compare,m.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(z)},m.neg=m.negate,m.add=function(p){r(p)||(p=f(p));var F=this.high>>>16,ie=this.high&65535,Ee=this.low>>>16,ve=this.low&65535,qe=p.high>>>16,we=p.high&65535,yt=p.low>>>16,We=p.low&65535,Le=0,at=0,$e=0,vt=0;return vt+=ve+We,$e+=vt>>>16,vt&=65535,$e+=Ee+yt,at+=$e>>>16,$e&=65535,at+=ie+we,Le+=at>>>16,at&=65535,Le+=F+qe,Le&=65535,c($e<<16|vt,Le<<16|at,this.unsigned)},m.subtract=function(p){return r(p)||(p=f(p)),this.add(p.neg())},m.sub=m.subtract,m.multiply=function(p){if(this.isZero())return this;if(r(p)||(p=f(p)),e){var F=e.mul(this.low,this.high,p.low,p.high);return c(F,e.get_high(),this.unsigned)}if(p.isZero())return this.unsigned?L:P;if(this.eq(S))return p.isOdd()?S:P;if(p.eq(S))return this.isOdd()?S:P;if(this.isNegative())return p.isNegative()?this.neg().mul(p.neg()):this.neg().mul(p).neg();if(p.isNegative())return this.mul(p.neg()).neg();if(this.lt(R)&&p.lt(R))return l(this.toNumber()*p.toNumber(),this.unsigned);var ie=this.high>>>16,Ee=this.high&65535,ve=this.low>>>16,qe=this.low&65535,we=p.high>>>16,yt=p.high&65535,We=p.low>>>16,Le=p.low&65535,at=0,$e=0,vt=0,as=0;return as+=qe*Le,vt+=as>>>16,as&=65535,vt+=ve*Le,$e+=vt>>>16,vt&=65535,vt+=qe*We,$e+=vt>>>16,vt&=65535,$e+=Ee*Le,at+=$e>>>16,$e&=65535,$e+=ve*We,at+=$e>>>16,$e&=65535,$e+=qe*yt,at+=$e>>>16,$e&=65535,at+=ie*Le+Ee*We+ve*yt+qe*we,at&=65535,c(vt<<16|as,at<<16|$e,this.unsigned)},m.mul=m.multiply,m.divide=function(p){if(r(p)||(p=f(p)),p.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&p.low===-1&&p.high===-1)return this;var F=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,p.low,p.high);return c(F,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?L:P;var ie,Ee,ve;if(this.unsigned){if(p.unsigned||(p=p.toUnsigned()),p.gt(this))return L;if(p.gt(this.shru(1)))return Q;ve=L}else{if(this.eq(S)){if(p.eq(z)||p.eq(T))return S;if(p.eq(S))return z;var qe=this.shr(1);return ie=qe.div(p).shl(1),ie.eq(P)?p.isNegative()?z:T:(Ee=this.sub(p.mul(ie)),ve=ie.add(Ee.div(p)),ve)}else if(p.eq(S))return this.unsigned?L:P;if(this.isNegative())return p.isNegative()?this.neg().div(p.neg()):this.neg().div(p).neg();if(p.isNegative())return this.div(p.neg()).neg();ve=P}for(Ee=this;Ee.gte(p);){ie=Math.max(1,Math.floor(Ee.toNumber()/p.toNumber()));for(var we=Math.ceil(Math.log(ie)/Math.LN2),yt=we<=48?1:u(2,we-48),We=l(ie),Le=We.mul(p);Le.isNegative()||Le.gt(Ee);)ie-=yt,We=l(ie,this.unsigned),Le=We.mul(p);We.isZero()&&(We=z),ve=ve.add(We),Ee=Ee.sub(Le)}return ve},m.div=m.divide,m.modulo=function(p){if(r(p)||(p=f(p)),e){var F=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,p.low,p.high);return c(F,e.get_high(),this.unsigned)}return this.sub(this.div(p).mul(p))},m.mod=m.modulo,m.rem=m.modulo,m.not=function(){return c(~this.low,~this.high,this.unsigned)},m.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},m.clz=m.countLeadingZeros,m.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},m.ctz=m.countTrailingZeros,m.and=function(p){return r(p)||(p=f(p)),c(this.low&p.low,this.high&p.high,this.unsigned)},m.or=function(p){return r(p)||(p=f(p)),c(this.low|p.low,this.high|p.high,this.unsigned)},m.xor=function(p){return r(p)||(p=f(p)),c(this.low^p.low,this.high^p.high,this.unsigned)},m.shiftLeft=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low<<p,this.high<<p|this.low>>>32-p,this.unsigned):c(0,this.low<<p-32,this.unsigned)},m.shl=m.shiftLeft,m.shiftRight=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low>>>p|this.high<<32-p,this.high>>p,this.unsigned):c(this.high>>p-32,this.high>=0?0:-1,this.unsigned)},m.shr=m.shiftRight,m.shiftRightUnsigned=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low>>>p|this.high<<32-p,this.high>>>p,this.unsigned):p===32?c(this.high,0,this.unsigned):c(this.high>>>p-32,0,this.unsigned)},m.shru=m.shiftRightUnsigned,m.shr_u=m.shiftRightUnsigned,m.rotateLeft=function(p){var F;return r(p)&&(p=p.toInt()),(p&=63)===0?this:p===32?c(this.high,this.low,this.unsigned):p<32?(F=32-p,c(this.low<<p|this.high>>>F,this.high<<p|this.low>>>F,this.unsigned)):(p-=32,F=32-p,c(this.high<<p|this.low>>>F,this.low<<p|this.high>>>F,this.unsigned))},m.rotl=m.rotateLeft,m.rotateRight=function(p){var F;return r(p)&&(p=p.toInt()),(p&=63)===0?this:p===32?c(this.high,this.low,this.unsigned):p<32?(F=32-p,c(this.high<<F|this.low>>>p,this.low<<F|this.high>>>p,this.unsigned)):(p-=32,F=32-p,c(this.low<<F|this.high>>>p,this.high<<F|this.low>>>p,this.unsigned))},m.rotr=m.rotateRight,m.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},m.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},m.toBytes=function(p){return p?this.toBytesLE():this.toBytesBE()},m.toBytesLE=function(){var p=this.high,F=this.low;return[F&255,F>>>8&255,F>>>16&255,F>>>24,p&255,p>>>8&255,p>>>16&255,p>>>24]},m.toBytesBE=function(){var p=this.high,F=this.low;return[p>>>24,p>>>16&255,p>>>8&255,p&255,F>>>24,F>>>16&255,F>>>8&255,F&255]},t.fromBytes=function(p,F,ie){return ie?t.fromBytesLE(p,F):t.fromBytesBE(p,F)},t.fromBytesLE=function(p,F){return new t(p[0]|p[1]<<8|p[2]<<16|p[3]<<24,p[4]|p[5]<<8|p[6]<<16|p[7]<<24,F)},t.fromBytesBE=function(p,F){return new t(p[4]<<24|p[5]<<16|p[6]<<8|p[7],p[0]<<24|p[1]<<16|p[2]<<8|p[3],F)},typeof BigInt=="function"&&(t.fromBigInt=function(p,F){var ie=Number(BigInt.asIntN(32,p)),Ee=Number(BigInt.asIntN(32,p>>BigInt(32)));return c(ie,Ee,F)},t.fromValue=function(p,F){return typeof p=="bigint"?fromBigInt(p,F):f(p,F)},m.toBigInt=function(){var p=BigInt(this.low>>>0),F=BigInt(this.unsigned?this.high>>>0:this.high);return F<<BigInt(32)|p});var E=n.default=t})});var Vp=D(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.loadFileDescriptorSetFromObject=et.loadFileDescriptorSetFromBuffer=et.fromJSON=et.loadSync=et.load=et.IdempotencyLevel=et.isAnyExtension=et.Long=void 0;var wx=dE(),On=qc(),qp=p_(),Up=E_(),_x=w_();et.Long=_x;function bx(n){return"@type"in n&&typeof n["@type"]=="string"}et.isAnyExtension=bx;var C_;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(C_=et.IdempotencyLevel||(et.IdempotencyLevel={}));var I_={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function Cx(n,e){return n===""?e:n+"."+e}function Ix(n){return n instanceof On.Service||n instanceof On.Type||n instanceof On.Enum}function Ax(n){return n instanceof On.Namespace||n instanceof On.Root}function A_(n,e){let t=Cx(e,n.name);return Ix(n)?[[t,n]]:Ax(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>A_(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function __(n,e){return function(r){return n.toObject(n.decode(r),e)}}function b_(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function Rx(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:C_.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function Dx(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:b_(i),requestDeserialize:__(i,t),responseSerialize:b_(s),responseDeserialize:__(s,t),originalName:wx(n.name),requestType:Bp(i,r),responseType:Bp(s,r),options:Rx(n.parsedOptions)}}function kx(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=Dx(s,e,t,r);return i}function Bp(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,I_),fileDescriptorProtos:e}}function Nx(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,I_),fileDescriptorProtos:e}}function xx(n,e,t,r){if(n instanceof On.Service)return kx(n,e,t,r);if(n instanceof On.Type)return Bp(n,r);if(n instanceof On.Enum)return Nx(n,r);throw new Error("Type mismatch in reflection object handling")}function zc(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(qp.FileDescriptorProto.encode(s).finish()));for(let[s,o]of A_(n,""))t[s]=xx(o,s,e,i);return t}function R_(n,e){e=e||{};let t=On.Root.fromDescriptor(n);return t.resolveAll(),zc(t,e)}function Ox(n,e){return(0,Up.loadProtosWithOptions)(n,e).then(t=>zc(t,e))}et.load=Ox;function Mx(n,e){let t=(0,Up.loadProtosWithOptionsSync)(n,e);return zc(t,e)}et.loadSync=Mx;function Px(n,e){e=e||{};let t=On.Root.fromJSON(n);return t.resolveAll(),zc(t,e)}et.fromJSON=Px;function Lx(n,e){let t=qp.FileDescriptorSet.decode(n);return R_(t,e)}et.loadFileDescriptorSetFromBuffer=Lx;function Fx(n,e){let t=qp.FileDescriptorSet.fromObject(n);return R_(t,e)}et.loadFileDescriptorSetFromObject=Fx;(0,Up.addCommonProtos)()});var bi=D(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.setup=De.getChannelzServiceDefinition=De.getChannelzHandlers=De.unregisterChannelzRef=De.registerChannelzSocket=De.registerChannelzServer=De.registerChannelzSubchannel=De.registerChannelzChannel=De.ChannelzCallTracker=De.ChannelzChildrenTracker=De.ChannelzTrace=void 0;var D_=pe("net"),_a=Gt(),Ca=fe(),Bx=bn(),qx=cc(),Ux=Bf();function zp(n){return{channel_id:n.id,name:n.name}}function Wp(n){return{subchannel_id:n.id,name:n.name}}function Vx(n){return{server_id:n.id}}function jc(n){return{socket_id:n.id,name:n.name}}var k_=32,Gp=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=k_*2&&(this.events=this.events.slice(k_)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Xn(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Xn(e.timestamp),channel_ref:e.childChannel?zp(e.childChannel):null,subchannel_ref:e.childSubchannel?Wp(e.childSubchannel):null}))}}};De.ChannelzTrace=Gp;var jp=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};De.ChannelzChildrenTracker=jp;var Kp=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};De.ChannelzCallTracker=Kp;var zx=1;function Kc(){return zx++}var ba=[],$p=[],Pr=[],Hp=[];function Gx(n,e,t){let r=Kc(),i={id:r,name:n,kind:"channel"};return t&&(ba[r]={ref:i,getInfo:e}),i}De.registerChannelzChannel=Gx;function jx(n,e,t){let r=Kc(),i={id:r,name:n,kind:"subchannel"};return t&&($p[r]={ref:i,getInfo:e}),i}De.registerChannelzSubchannel=jx;function Kx(n,e){let t=Kc(),r={id:t,kind:"server"};return e&&(Pr[t]={ref:r,getInfo:n}),r}De.registerChannelzServer=Kx;function Wx(n,e,t){let r=Kc(),i={id:r,name:n,kind:"socket"};return t&&(Hp[r]={ref:i,getInfo:e}),i}De.registerChannelzSocket=Wx;function $x(n){switch(n.kind){case"channel":delete ba[n.id];return;case"subchannel":delete $p[n.id];return;case"server":delete Pr[n.id];return;case"socket":delete Hp[n.id];return}}De.unregisterChannelzRef=$x;function Hx(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function N_(n){if(n==="")return[];let e=n.split(":").map(r=>Hx(r));return[].concat(...e)}function Qx(n){if((0,D_.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,D_.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(N_(e)),s=Buffer.from(N_(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function O_(n){switch(n){case _a.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case _a.ConnectivityState.IDLE:return{state:"IDLE"};case _a.ConnectivityState.READY:return{state:"READY"};case _a.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case _a.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Xn(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function M_(n){let e=n.getInfo();return{ref:zp(n.ref),data:{target:e.target,state:O_(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Xn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>zp(t)),subchannel_ref:e.children.subchannels.map(t=>Wp(t))}}function Yx(n,e){let t=Number.parseInt(n.request.channel_id),r=ba[t];if(r===void 0){e({code:Ca.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:M_(r)})}function Jx(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<ba.length;i++){let s=ba[i];if(s!==void 0&&(r.push(M_(s)),r.length>=t))break}e(null,{channel:r,end:i>=Pr.length})}function P_(n){let e=n.getInfo();return{ref:Vx(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Xn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>jc(t))}}function Xx(n,e){let t=Number.parseInt(n.request.server_id),r=Pr[t];if(r===void 0){e({code:Ca.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:P_(r)})}function Zx(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<Pr.length;i++){let s=Pr[i];if(s!==void 0&&(r.push(P_(s)),r.length>=t))break}e(null,{server:r,end:i>=Pr.length})}function eO(n,e){let t=Number.parseInt(n.request.subchannel_id),r=$p[t];if(r===void 0){e({code:Ca.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Wp(r.ref),data:{target:i.target,state:O_(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Xn(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>jc(o))};e(null,{subchannel:s})}function x_(n){var e;return(0,Bx.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=Qx(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function tO(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=Hp[a];if(l===void 0){e({code:Ca.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:jc(l.ref),local:c.localAddress?x_(c.localAddress):null,remote:c.remoteAddress?x_(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Xn(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Xn(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Xn(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Xn(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function nO(n,e){let t=Number.parseInt(n.request.server_id),r=Pr[t];if(r===void 0){e({code:Ca.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(jc(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function L_(){return{GetChannel:Yx,GetTopChannels:Jx,GetServer:Xx,GetServers:Zx,GetSubchannel:eO,GetSocket:tO,GetServerSockets:nO}}De.getChannelzHandlers=L_;var Gc=null;function F_(){if(Gc)return Gc;let n=Vp().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Gc=(0,Ux.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Gc}De.getChannelzServiceDefinition=F_;function rO(){(0,qx.registerAdminService)(F_,L_)}De.setup=rO});var B_=D($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});$c.Subchannel=void 0;var be=Gt(),iO=ra(),Qp=Fe(),Wc=fe(),sO=Lt(),oO=bn(),Vs=bi(),aO="subchannel",lO=~(1<<31),Yp=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=be.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new Vs.ChannelzCallTracker,this.childrenTracker=new Vs.ChannelzChildrenTracker,this.streamTracker=new Vs.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new iO.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,oO.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Vs.ChannelzTrace,this.channelzRef=(0,Vs.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Qp.trace(Wc.LogVerbosity.DEBUG,aO,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Qp.trace(Wc.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([be.ConnectivityState.TRANSIENT_FAILURE],be.ConnectivityState.CONNECTING):this.transitionToState([be.ConnectivityState.TRANSIENT_FAILURE],be.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,lO);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([be.ConnectivityState.CONNECTING],be.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([be.ConnectivityState.READY],be.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Qp.log(Wc.LogVerbosity.ERROR,`Connection to ${(0,sO.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([be.ConnectivityState.CONNECTING],be.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(be.ConnectivityState[this.connectivityState]+" -> "+be.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+be.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case be.ConnectivityState.READY:this.stopBackoff();break;case be.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case be.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case be.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,Vs.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([be.ConnectivityState.CONNECTING,be.ConnectivityState.READY],be.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Wc.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([be.ConnectivityState.IDLE],be.ConnectivityState.CONNECTING)||this.connectivityState===be.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([be.ConnectivityState.TRANSIENT_FAILURE],be.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};$c.Subchannel=Yp});var em=D(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.setup=Br.DEFAULT_PORT=void 0;var q_=wn(),V_=pe("dns"),z_=pe("util"),cO=df(),Jp=fe(),Xp=Rt(),uO=Fe(),dO=fe(),Lr=Lt(),U_=pe("net"),hO=ra(),fO="dns_resolver";function Fr(n){uO.trace(dO.LogVerbosity.DEBUG,fO,n)}Br.DEFAULT_PORT=443;var pO=3e4,mO=z_.promisify(V_.resolveTxt),gO=z_.promisify(V_.lookup);function yO(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Zp=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Fr("Resolver constructed for target "+(0,Lr.uriToString)(e));let a=(0,Lr.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,U_.isIPv4)(a.host)||(0,U_.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Br.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Br.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Jp.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Lr.uriToString)(this.target)}`,metadata:new Xp.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new hO.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:pO,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Fr("Returning IP address for target "+(0,Lr.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Fr("Failed to parse DNS address "+(0,Lr.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Jp.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Lr.uriToString)(this.target)}`,metadata:new Xp.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Fr("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=gO(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=yO(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(Fr("Resolved addresses for target "+(0,Lr.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Fr("Resolution error for target "+(0,Lr.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=mO(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,cO.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Jp.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Xp.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Fr('resolution update delayed by "min time between resolutions" rate limit'):Fr("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function vO(){(0,q_.registerResolver)("dns",Zp),(0,q_.registerDefaultScheme)("dns")}Br.setup=vO});var tm=D(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.getProxiedConnection=js.mapProxyName=void 0;var Ia=Fe(),zs=fe(),SO=wn(),TO=pe("http"),EO=pe("tls"),wO=Fe(),G_=bn(),Gs=Lt(),_O=pe("url"),bO=em(),CO="proxy";function qr(n){wO.trace(zs.LogVerbosity.DEBUG,CO,n)}function IO(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new _O.URL(n)}catch{return(0,Ia.log)(zs.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Ia.log)(zs.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,Ia.log)(zs.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),qr("Proxy server "+o.address+" set by environment variable "+e),o}function AO(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(qr("No proxy server list set by environment variable "+e),n.split(",")):[]}function RO(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=IO();if(!i.address)return r;let s=(0,Gs.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of AO())if(l===o)return qr("Not using proxy for target in no_proxy list: "+(0,Gs.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,Gs.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}js.mapProxyName=RO;function DO(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,Gs.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,Gs.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:bO.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,G_.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,G_.subchannelAddressToString)(n);return qr("Using proxy "+u+" to connect to "+l.path),new Promise((d,f)=>{let v=TO.request(l);v.once("connect",(b,I,C)=>{var M;if(v.removeAllListeners(),I.removeAllListeners(),b.statusCode===200)if(qr("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let R=(0,SO.getDefaultAuthority)(s),P=(0,Gs.splitHostPort)(R),L=(M=P?.host)!==null&&M!==void 0?M:R,z=EO.connect(Object.assign({host:L,servername:L,socket:I},t),()=>{qr("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:z,realTarget:s})});z.on("error",Q=>{qr("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+Q.message),f()})}else qr("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:I,realTarget:s});else(0,Ia.log)(zs.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+b.statusCode),f()}),v.once("error",b=>{v.removeAllListeners(),(0,Ia.log)(zs.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+b.message),f()}),v.end()})}js.getProxiedConnection=DO});var rm=D(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});Hc.StreamDecoder=void 0;var Zn=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Zn||{}),nm=class{constructor(e){this.maxReadMessageLength=e,this.readState=Zn.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case Zn.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Zn.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Zn.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Zn.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Zn.NO_DATA,i.push(s)}}break;case Zn.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=Zn.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Hc.StreamDecoder=nm});var j_=D(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});Qc.Http2SubchannelCall=void 0;var er=pe("http2"),kO=pe("os"),ge=fe(),Ur=Rt(),NO=rm(),xO=Fe(),OO=fe(),MO="subchannel_call";function PO(n){for(let[e,t]of Object.entries(kO.constants.errno))if(t===n)return e;return"Unknown system error "+n}var im=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ge.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:ge.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new NO.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=ge.Status.INTERNAL;break;case 401:this.mappedStatusCode=ge.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ge.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ge.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ge.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ge.Status.UNKNOWN}if(c&er.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=Ur.Metadata.fromHttp2Headers(l)}catch(f){this.endCall({code:ge.Status.UNKNOWN,details:f.message,metadata:new Ur.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(ge.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===ge.Status.OK)return;let c,u="";switch(e.rstCode){case er.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=ge.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case er.constants.NGHTTP2_REFUSED_STREAM:c=ge.Status.UNAVAILABLE,u="Stream refused by server";break;case er.constants.NGHTTP2_CANCEL:c=ge.Status.CANCELLED,u="Call cancelled";break;case er.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=ge.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case er.constants.NGHTTP2_INADEQUATE_SECURITY:c=ge.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case er.constants.NGHTTP2_INTERNAL_ERROR:c=ge.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=ge.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=ge.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Ur.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+PO(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ge.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Ur.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){xO.trace(OO.LogVerbosity.DEBUG,MO,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ge.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ge.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Ur.Metadata.fromHttp2Headers(e)}catch{r=new Ur.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===ge.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in ge.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ge.Status.OK?t=er.constants.NGHTTP2_NO_ERROR:t=er.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Ur.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ge.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=ge.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=ge.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:ge.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Ur.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Qc.Http2SubchannelCall=im});var sm=D(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.getNextCallNumber=void 0;var LO=0;function FO(){return LO++}Yc.getNextCallNumber=FO});var $_=D(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.Http2SubchannelConnector=void 0;var um=pe("http2"),K_=pe("tls"),om=bi(),Aa=fe(),BO=tm(),Ws=Fe(),W_=wn(),Jc=bn(),Ks=Lt(),qO=pe("net"),UO=j_(),VO=sm(),am="transport",zO="transport_flowctrl",GO=Wh().version,{HTTP2_HEADER_AUTHORITY:jO,HTTP2_HEADER_CONTENT_TYPE:KO,HTTP2_HEADER_METHOD:WO,HTTP2_HEADER_PATH:$O,HTTP2_HEADER_TE:HO,HTTP2_HEADER_USER_AGENT:QO}=um.constants,YO=2e4,JO=Buffer.from("too_many_pings","ascii"),lm=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=YO,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new om.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Jc.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,om.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${GO}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===um.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(JO)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Ws.isTracerEnabled(am)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Jc.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Jc.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),f=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Ws.trace(Aa.LogVerbosity.DEBUG,am,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Ws.trace(Aa.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Ws.trace(Aa.LogVerbosity.DEBUG,zO,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Ws.trace(Aa.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[jO]=t,o[QO]=this.userAgent,o[KO]="application/grpc",o[WO]="POST",o[$O]=r,o[HO]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new UO.Http2SubchannelCall(a,l,i,this,(0,VO.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,om.unregisterChannelzRef)(this.channelzRef)}},cm=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Ws.trace(Aa.LogVerbosity.DEBUG,am,(0,Ks.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Ks.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Ks.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Jc.subchannelAddressToString)(e)));let d=(0,W_.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in f){if(v="https://",r["grpc.ssl_target_name_override"]){let C=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(M,R)=>(0,K_.checkServerIdentity)(C,R),f.servername=C}else{let C=(c=(l=(0,Ks.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=C}i.socket&&(f.createConnection=(C,M)=>i.socket)}else f.createConnection=(C,M)=>i.socket?i.socket:qO.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let b=um.connect(v+d,f);this.session=b;let I="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),s(new lm(b,e,r,u)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${I} (${new Date().toISOString()})`)})}),b.once("error",C=>{I=C.message,this.trace("connection failed with error "+I)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,K_.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,W_.getDefaultAuthority)((i=(0,Ks.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Ks.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,BO.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Xc.Http2SubchannelConnector=cm});var H_=D($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});$s.getSubchannelPool=$s.SubchannelPool=void 0;var XO=OT(),ZO=B_(),eM=bn(),tM=Lt(),nM=$_(),rM=1e4,Ra=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},rM),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,tM.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,eM.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,XO.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new ZO.Subchannel(e,t,r,i,new nM.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};$s.SubchannelPool=Ra;var iM=new Ra;function sM(n){return n?iM:new Ra}$s.getSubchannelPool=sM});var hm=D(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});Hs.FilterStackFactory=Hs.FilterStack=void 0;var Zc=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Hs.FilterStack=Zc;var dm=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new Zc(this.factories.map(e=>e.createFilter()))}};Hs.FilterStackFactory=dm});var fm=D(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.CompressionAlgorithms=void 0;var Q_=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(Q_||(eu.CompressionAlgorithms=Q_={}))});var mm=D(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});tu.BaseFilter=void 0;var pm=class{sendMetadata(e){return w(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return w(this,null,function*(){return e})}receiveMessage(e){return w(this,null,function*(){return e})}receiveTrailers(e){return e}};tu.BaseFilter=pm});var X_=D(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.CompressionFilterFactory=Ys.CompressionFilter=void 0;var nu=pe("zlib"),J_=fm(),ru=fe(),oM=mm(),aM=Fe(),lM=n=>typeof n=="number"&&typeof J_.CompressionAlgorithms[n]=="string",Qs=class{writeMessage(e,t){return w(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return w(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Ci=class extends Qs{compressMessage(e){return w(this,null,function*(){return e})}writeMessage(e,t){return w(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},gm=class extends Qs{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{nu.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=nu.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:ru.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},ym=class extends Qs{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{nu.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=nu.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:ru.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},vm=class extends Qs{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function Y_(n,e){switch(n){case"identity":return new Ci;case"deflate":return new gm(e);case"gzip":return new ym(e);default:return new vm(n)}}var iu=class extends oM.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new Ci,this.receiveCompression=new Ci,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:ru.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(lM(s)){let o=J_.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=Y_(this.currentCompressionAlgorithm,-1))}else aM.log(ru.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return w(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=Y_(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Ci,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return w(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Ci?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return w(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Ys.CompressionFilter=iu;var Sm=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new iu(this.options,this.sharedFilterConfig)}};Ys.CompressionFilterFactory=Sm});var su=D(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.deadlineToString=Mn.getRelativeTimeout=Mn.getDeadlineTimeoutString=Mn.minDeadline=void 0;function cM(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Mn.minDeadline=cM;var uM=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function dM(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of uM){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Mn.getDeadlineTimeoutString=dM;var hM=2147483647;function fM(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>hM?1/0:r}Mn.getRelativeTimeout=fM;function pM(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Mn.deadlineToString=pM});var au=D(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.restrictControlPlaneStatusCode=void 0;var Pn=fe(),mM=[Pn.Status.OK,Pn.Status.INVALID_ARGUMENT,Pn.Status.NOT_FOUND,Pn.Status.ALREADY_EXISTS,Pn.Status.FAILED_PRECONDITION,Pn.Status.ABORTED,Pn.Status.OUT_OF_RANGE,Pn.Status.DATA_LOSS];function gM(n,e){return mM.includes(n)?{code:Pn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Pn.Status[n]} ${e}`}:{code:n,details:e}}ou.restrictControlPlaneStatusCode=gM});var eb=D(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});uu.LoadBalancingCall=void 0;var Z_=Gt(),lu=fe(),yM=su(),cu=Rt(),Da=br(),vM=Lt(),SM=Fe(),Tm=au(),TM=pe("http2"),EM="load_balancing_call",Em=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let f=(c=(l=(0,vM.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${d}`}trace(e){SM.trace(lu.LogVerbosity.DEBUG,EM,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Da.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Da.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:lu.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new cu.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==Z_.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+Z_.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,yM.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===TM.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:lu.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new cu.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Tm.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:lu.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new cu.Metadata},"PROCESSED")});break;case Da.PickResultType.DROP:let{code:s,details:o}=(0,Tm.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Da.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Tm.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Da.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new cu.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};uu.LoadBalancingCall=Em});var nb=D(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.ResolvingCall=void 0;var Js=fe(),du=su(),tb=Rt(),wM=Fe(),_M=au(),bM="resolving_call",wm=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Js.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Js.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Js.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,du.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){wM.trace(Js.LogVerbosity.DEBUG,bM,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,du.deadlineToString)(this.deadline));let e=(0,du.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Js.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Js.Status.OK){let{code:r,details:i}=(0,_M.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new tb.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,du.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new tb.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};hu.ResolvingCall=wm});var rb=D(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.RetryingCall=Vr.MessageBufferTracker=Vr.RetryThrottler=void 0;var fu=fe(),CM=Rt(),IM=Fe(),AM="retrying_call",bm=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Vr.RetryThrottler=bm;var Cm=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Vr.MessageBufferTracker=Cm;var _m="grpc-previous-rpc-attempts",Im=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){IM.trace(fu.LogVerbosity.DEBUG,AM,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new CM.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(fu.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===fu.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===fu.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(_m,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(_m,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(_m,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Vr.RetryingCall=Im});var mu=D(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.BaseSubchannelWrapper=void 0;var Am=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};pu.BaseSubchannelWrapper=Am});var ob=D(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});vu.InternalChannel=void 0;var RM=ec(),DM=xT(),kM=H_(),ib=br(),ka=fe(),NM=hm(),xM=X_(),sb=wn(),Rm=Fe(),OM=tm(),gu=Lt(),Ln=Gt(),Na=bi(),MM=eb(),PM=su(),LM=nb(),Dm=sm(),FM=au(),km=rb(),BM=mu(),qM=2147483647,UM=1e3,VM=30*60*1e3,yu=new Map,zM=1<<24,GM=1<<20,Nm=class extends BM.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},xm=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=Ln.ConnectivityState.IDLE,this.currentPicker=new ib.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Na.ChannelzCallTracker,this.childrenTracker=new Na.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof RM.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,gu.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let v=(0,sb.mapUriDefaultScheme)(f);if(v===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},qM),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Na.ChannelzTrace,this.channelzRef=(0,Na.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,sb.getDefaultAuthority)(v);let b=(0,OM.mapProxyName)(v,r);this.target=b.target,this.options=Object.assign({},this.options,b.extraOptions),this.subchannelPool=(0,kM.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new km.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:zM,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:GM),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:VM,UM);let I={createSubchannel:(M,R)=>{let P=this.subchannelPool.getOrCreateSubchannel(this.target,M,Object.assign({},this.options,R),this.credentials);P.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",P.getChannelzRef());let L=new Nm(P,this);return this.wrappedSubchannels.add(L),L},updateState:(M,R)=>{this.currentPicker=R;let P=this.pickQueue.slice();this.pickQueue=[],P.length>0&&this.callRefTimerUnref();for(let L of P)L.doPick();this.updateState(M)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.refChild(M)},removeChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.unrefChild(M)}};this.resolvingLoadBalancer=new DM.ResolvingLoadBalancer(this.target,I,r,(M,R)=>{M.retryThrottling?yu.set(this.getTarget(),new km.RetryThrottler(M.retryThrottling.maxTokens,M.retryThrottling.tokenRatio,yu.get(this.getTarget()))):yu.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=R,this.currentResolutionError=null,process.nextTick(()=>{let P=this.configSelectionQueue;this.configSelectionQueue=[],P.length>0&&this.callRefTimerUnref();for(let L of P)L.getConfig()})},M=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+M.code+' and details "'+M.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,FM.restrictControlPlaneStatusCode)(M.code,M.details)),{metadata:M.metadata}));let R=this.configSelectionQueue;this.configSelectionQueue=[],R.length>0&&this.callRefTimerUnref();for(let P of R)P.reportResolverError(M)}),this.filterStackFactory=new NM.FilterStackFactory([new xM.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let C=new Error;(0,Rm.trace)(ka.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=C.stack)===null||d===void 0?void 0:d.substring(C.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Rm.trace)(t??ka.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,gu.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Rm.trace)(ka.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,gu.uriToString)(this.target)+" "+Ln.ConnectivityState[this.connectivityState]+" -> "+Ln.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Ln.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Ln.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Ln.ConnectivityState.IDLE),this.currentPicker=new ib.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Ln.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===ka.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Dm.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new MM.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Dm.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new km.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,yu.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Dm.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,PM.deadlineToString)(t));let a={deadline:t,flags:s??ka.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new LM.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Ln.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Na.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,gu.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Ln.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Ln.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};vu.InternalChannel=xm});var Lf=D(Su=>{"use strict";Object.defineProperty(Su,"__esModule",{value:!0});Su.ChannelImplementation=void 0;var jM=ec(),KM=ob(),Om=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof jM.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new KM.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Su.ChannelImplementation=Om});var mb=D(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.Http2ServerCallStream=Xt.ServerDuplexStreamImpl=Xt.ServerWritableStreamImpl=Xt.ServerReadableStreamImpl=Xt.ServerUnaryCallImpl=void 0;var hb=pe("events"),Xs=pe("http2"),Lm=pe("stream"),ab=pe("zlib"),Ie=fe(),Fm=Rt(),WM=rm(),fb=Fe(),Oa=Hl(),pb="server_call";function xa(n){fb.trace(Ie.LogVerbosity.DEBUG,pb,n)}var $M="grpc-accept-encoding",HM="grpc-encoding",lb="grpc-message",cb="grpc-status",ub="grpc-timeout",QM=/(\d{1,8})\s*([HMSmun])/,YM={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},JM={[$M]:"identity,deflate,gzip",[HM]:"identity"},db={[Xs.constants.HTTP2_HEADER_STATUS]:Xs.constants.HTTP_STATUS_OK,[Xs.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},XM={waitForTrailers:!0},Mm=class extends hb.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Xt.ServerUnaryCallImpl=Mm;var Tu=class extends Lm.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Xt.ServerReadableStreamImpl=Tu;var Ma=class extends Lm.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Fm.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Oa.getErrorMessage)(i),code:Ie.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Ie.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};Xt.ServerWritableStreamImpl=Ma;var Zs=class extends Lm.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Fm.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};Xt.ServerDuplexStreamImpl=Zs;Zs.prototype._read=Tu.prototype._read;Zs.prototype._write=Ma.prototype._write;Zs.prototype._final=Ma.prototype._final;var Pm=class extends hb.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Ie.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Ie.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;xa("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Ie.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=ab.createInflate():i=ab.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Ie.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Ie.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},db),JM),t);this.stream.respond(r,XM)}receiveMetadata(e){let t=Fm.Metadata.fromHttp2Headers(e);fb.isTracerEnabled(pb)&&xa("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(ub);if(r.length>0){let i=r[0].toString().match(QM);if(i===null){let a=new Error("Invalid deadline");return a.code=Ie.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*YM[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(ZM,s,this),t.remove(ub)}return t.remove(Xs.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Xs.constants.HTTP2_HEADER_TE),t.remove(Xs.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Ie.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Ie.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Ie.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let f=Buffer.concat(a,s),b=f.readUInt8(0)===1?e:"identity",I=o.getDecompressedMessage(f,b);if(Buffer.isBuffer(I)){t(o.deserializeMessageWithInternalError(I));return}I.then(C=>t(o.deserializeMessageWithInternalError(C)),C=>r(C.code?C:{code:Ie.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return w(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Oa.getErrorMessage)(t),code:Ie.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return w(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Ie.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Oa.getErrorMessage)(s),code:Ie.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Ie.Status.OK),!this.checkCancelled())if(xa("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Ie.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[cb]:e.code,[lb]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[cb]:e.code,[lb]:encodeURI(e.details)},db),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Ie.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Ie.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new WM.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>w(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>w(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Ie.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",v;try{v=yield this.getDecompressedMessage(u,f)}catch(b){this.sendError(b);return}if(!v)return;yield this.pushOrBufferMessage(e,v)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>w(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return w(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return w(this,null,function*(){if(t===null){xa("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}xa("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Oa.getErrorCode)(r);(i===null||i<Ie.Status.OK||i>Ie.Status.UNAUTHENTICATED)&&(i=Ie.Status.INTERNAL),e.emit("error",{details:(0,Oa.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};Xt.Http2ServerCallStream=Pm;function ZM(n){let e=new Error("Deadline exceeded");e.code=Ie.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Um=D(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.ServerCredentials=void 0;var gb=of(),Pa=class{static createInsecure(){return new Bm}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new qm({ca:e||(0,gb.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:gb.CIPHER_SUITES})}};Eu.ServerCredentials=Pa;var Bm=class extends Pa{_isSecure(){return!1}_getSettings(){return null}},qm=class extends Pa{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var Sb=D(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.Server=void 0;var zr=pe("http2"),tr=fe(),Ii=mb(),eP=Um(),yb=wn(),wu=Fe(),dn=bn(),tP=Lt(),Nt=bi(),_u=~(1<<31),nP=~(1<<31),rP=2e4,{HTTP2_HEADER_PATH:vb}=zr.constants,iP="server";function sP(){}function Vm(n){return{code:tr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function oP(n,e){let t=Vm(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var zm=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Nt.ChannelzTrace,this.callTracker=new Nt.ChannelzCallTracker,this.listenerChildrenTracker=new Nt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Nt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Nt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:_u,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:_u,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:nP,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:rP,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,dn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,dn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,f=d.getCipher(),v=d.getCertificate(),b=d.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:v&&"raw"in v?v.raw:null,remoteCertificate:b&&"raw"in b?b.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){wu.trace(tr.LogVerbosity.DEBUG,iP,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=oP(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof eP.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,tP.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,yb.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(v,b)=>{process.nextTick(()=>r(v,b))},l=()=>{let v;if(t._isSecure()){let b=Object.assign(o,t._getSettings());b.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,v=zr.createSecureServer(b),v.on("secureConnection",I=>{I.on("error",C=>{this.trace("An incoming TLS connection closed with error: "+C.message)})})}else v=zr.createServer(o);return v.setTimeout(0,sP),this._setupHandlers(v),v},c=(v,b,I)=>v.length===0?Promise.resolve({port:b,count:I}):Promise.all(v.map(C=>{this.trace("Attempting to bind "+(0,dn.subchannelAddressToString)(C));let M;(0,dn.isTcpSubchannelAddress)(C)?M={host:C.host,port:b}:M=C;let R=l();return new Promise((P,L)=>{let z=Q=>{this.trace("Failed to bind "+(0,dn.subchannelAddressToString)(C)+" with error "+Q.message),P(Q)};R.once("error",z),R.listen(M,()=>{if(this.shutdown){R.close(),P(new Error("bindAsync failed because server is shutdown"));return}let Q=R.address(),T;typeof Q=="string"?T={path:Q}:T={host:Q.address,port:Q.port};let g=(0,Nt.registerChannelzSocket)((0,dn.subchannelAddressToString)(T),()=>({localAddress:T,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:R,channelzRef:g}),this.trace("Successfully bound "+(0,dn.subchannelAddressToString)(T)),P("port"in T?T.port:b),R.removeListener("error",z)})})})).then(C=>{let M=0;for(let R of C)if(typeof R=="number"&&(M+=1,R!==b))throw new Error("Invalid state: multiple port numbers added from single address");return{port:b,count:M+I}}),u=v=>{if(v.length===0)return Promise.resolve({port:0,count:0});let b=v[0],I=l();return new Promise((C,M)=>{let R=P=>{this.trace("Failed to bind "+(0,dn.subchannelAddressToString)(b)+" with error "+P.message),C(u(v.slice(1)))};I.once("error",R),I.listen(b,()=>{if(this.shutdown){I.close(),C({port:0,count:0});return}let P=I.address(),L={host:P.address,port:P.port},z=(0,Nt.registerChannelzSocket)((0,dn.subchannelAddressToString)(L),()=>({localAddress:L,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(z),this.http2ServerList.push({server:I,channelzRef:z}),this.trace("Successfully bound "+(0,dn.subchannelAddressToString)(L)),C(c(v.slice(1),P.port,1)),I.removeListener("error",R)})})},d={onSuccessfulResolution:(v,b,I)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),v.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let C;(0,dn.isTcpSubchannelAddress)(v[0])?v[0].port===0?C=u(v):C=c(v,v[0].port,0):C=c(v,1,0),C.then(M=>{if(M.count===0){let R=`No address added out of total ${v.length} resolved`;wu.log(tr.LogVerbosity.ERROR,R),a(new Error(R),0)}else M.count<v.length&&wu.log(tr.LogVerbosity.INFO,`WARNING Only ${M.count} addresses added out of total ${v.length} resolved`),a(null,M.port)},M=>{let R=`No address added out of total ${v.length} resolved`;wu.log(tr.LogVerbosity.ERROR,R),a(new Error(R),0)})},onError:v=>{a(new Error(v.details),0)}};(0,yb.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Nt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(zr.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Nt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Nt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Nt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[zr.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[zr.constants.HTTP2_HEADER_STATUS]:zr.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Ii.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=tr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[vb],s=this._retrieveHandler(i);if(!s){this._respondWithError(Vm(i),e,r);return}let o=new Ii.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===tr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:tr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[vb],i=this._retrieveHandler(r);if(!i){this._respondWithError(Vm(r),e,null);return}let s=new Ii.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:tr.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")aP(e,t,s,o);else if(a==="clientStream")lP(e,t,s,o);else if(a==="serverStream")cP(e,t,s,o);else if(a==="bidi")uP(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,Nt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:d,streamTracker:new Nt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let v=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+v),this.sessionChildrenTracker.refChild(d));let b=null,I=null,C=!1;if(this.maxConnectionAgeMs!==_u){let R=this.maxConnectionAgeMs/10,P=Math.random()*R*2-R;b=(l=(a=setTimeout(()=>{var L,z;C=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+v);try{s.goaway(zr.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==_u&&(I=(z=(L=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||z===void 0?void 0:z.call(L))},this.maxConnectionAgeMs+P)).unref)===null||l===void 0?void 0:l.call(a)}let M=(u=(c=setInterval(()=>{var R,P;let L=(P=(R=setTimeout(()=>{C=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+v),s.close()},this.keepaliveTimeoutMs)).unref)===null||P===void 0?void 0:P.call(R);try{s.ping((z,Q,T)=>{clearTimeout(L)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(C||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+v),this.sessionChildrenTracker.unrefChild(d),(0,Nt.unregisterChannelzRef)(d)),b&&clearTimeout(b),I&&clearTimeout(I),M&&clearTimeout(M),this.sessions.delete(s)})})}};bu.Server=zm;function aP(n,e,t,r){return w(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ii.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function lP(n,e,t,r){let i=new Ii.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function cP(n,e,t,r){return w(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ii.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function uP(n,e,t,r){let i=new Ii.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var Tb=D(Cu=>{"use strict";Object.defineProperty(Cu,"__esModule",{value:!0});Cu.StatusBuilder=void 0;var Gm=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Cu.StatusBuilder=Gm});var jm=D(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.isDuration=Gr.durationToMs=Gr.msToDuration=void 0;function dP(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}Gr.msToDuration=dP;function hP(n){return n.seconds*1e3+n.nanos/1e6|0}Gr.durationToMs=hP;function fP(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}Gr.isDuration=fP});var Xm=D(jr=>{"use strict";var Km;Object.defineProperty(jr,"__esModule",{value:!0});jr.setup=jr.OutlierDetectionLoadBalancer=jr.OutlierDetectionLoadBalancingConfig=void 0;var Au=Gt(),wb=fe(),Ai=jm(),_b=Zm(),bb=Tr(),pP=ac(),mP=br(),Eb=bn(),gP=mu(),yP=Fe(),vP="outlier_detection";function st(n){yP.trace(wb.LogVerbosity.DEBUG,vP,n)}var Jm="outlier_detection",SP=((Km=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Km!==void 0?Km:"true")==="true",TP={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},EP={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function eo(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Wm(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,Ai.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Iu(n,e,t){let r=t?`${t}.${e}`:e;if(eo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var La=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},TP),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},EP),o):null}getLoadBalancerName(){return Jm}toJsonObject(){return{interval:(0,Ai.msToDuration)(this.intervalMs),base_ejection_time:(0,Ai.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Ai.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Wm(e,"interval"),Wm(e,"base_ejection_time"),Wm(e,"max_ejection_time"),Iu(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");eo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Iu(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),eo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),eo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Iu(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Iu(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),eo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),eo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Ai.durationToMs)(e.interval):null,e.base_ejection_time?(0,Ai.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Ai.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(bb.validateLoadBalancingConfig))}};jr.OutlierDetectionLoadBalancingConfig=La;var Hm=class extends gP.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Au.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Au.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Au.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function $m(){return{success:0,failure:0}}var Qm=class{constructor(){this.activeBucket=$m(),this.inactiveBucket=$m()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=$m()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Ym=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===mP.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===wb.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Ru=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new pP.ChildLoadBalancerHandler((0,_b.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,Eb.subchannelAddressToString)(t)),o=new Hm(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Au.ConnectivityState.READY?e.updateState(t,new Ym(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;st("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,f]of this.addressMap){let v=f.counter.getLastSuccesses(),b=f.counter.getLastFailures();st("Stats for "+d+": successes="+v+" failures="+b+" targetRequestVolume="+r),v+b>=r&&(i+=1,s.push(v/(v+b)))}if(st("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,f)=>d+f)/s.length,a=0;for(let d of s){let f=d-o;a+=f*f}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);st("stdev="+c+" ejectionThreshold="+u);for(let[d,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let v=f.counter.getLastSuccesses(),b=f.counter.getLastFailures();if(v+b<r)continue;let I=v/(v+b);if(st("Checking candidate "+d+" successRate="+I),I<u){let C=Math.random()*100;st("Candidate "+d+" randomNumber="+C+" enforcement_percentage="+t.enforcement_percentage),C<t.enforcement_percentage&&(st("Ejecting candidate "+d),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;st("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(st("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;st("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(st("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(st("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(st("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof La))return;let i=new Set;for(let o of e)i.add((0,Eb.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(st("Adding map entry for "+o),this.addressMap.set(o,{counter:new Qm,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(st("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,bb.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){st("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else st("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{st("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Jm}};jr.OutlierDetectionLoadBalancer=Ru;function wP(){SP&&(0,_b.registerLoadBalancerType)(Jm,Ru,La)}jr.setup=wP});var Zm=D(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.OutlierDetectionLoadBalancingConfig=J.BaseSubchannelWrapper=J.registerAdminService=J.FilterStackFactory=J.BaseFilter=J.PickResultType=J.QueuePicker=J.UnavailablePicker=J.ChildLoadBalancerHandler=J.subchannelAddressToString=J.validateLoadBalancingConfig=J.getFirstUsableConfig=J.registerLoadBalancerType=J.createChildChannelControlHelper=J.BackoffTimeout=J.durationToMs=J.uriToString=J.createResolver=J.registerResolver=J.log=J.trace=void 0;var Cb=Fe();Object.defineProperty(J,"trace",{enumerable:!0,get:function(){return Cb.trace}});Object.defineProperty(J,"log",{enumerable:!0,get:function(){return Cb.log}});var Ib=wn();Object.defineProperty(J,"registerResolver",{enumerable:!0,get:function(){return Ib.registerResolver}});Object.defineProperty(J,"createResolver",{enumerable:!0,get:function(){return Ib.createResolver}});var _P=Lt();Object.defineProperty(J,"uriToString",{enumerable:!0,get:function(){return _P.uriToString}});var bP=jm();Object.defineProperty(J,"durationToMs",{enumerable:!0,get:function(){return bP.durationToMs}});var CP=ra();Object.defineProperty(J,"BackoffTimeout",{enumerable:!0,get:function(){return CP.BackoffTimeout}});var Du=Tr();Object.defineProperty(J,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Du.createChildChannelControlHelper}});Object.defineProperty(J,"registerLoadBalancerType",{enumerable:!0,get:function(){return Du.registerLoadBalancerType}});Object.defineProperty(J,"getFirstUsableConfig",{enumerable:!0,get:function(){return Du.getFirstUsableConfig}});Object.defineProperty(J,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Du.validateLoadBalancingConfig}});var IP=bn();Object.defineProperty(J,"subchannelAddressToString",{enumerable:!0,get:function(){return IP.subchannelAddressToString}});var AP=ac();Object.defineProperty(J,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return AP.ChildLoadBalancerHandler}});var eg=br();Object.defineProperty(J,"UnavailablePicker",{enumerable:!0,get:function(){return eg.UnavailablePicker}});Object.defineProperty(J,"QueuePicker",{enumerable:!0,get:function(){return eg.QueuePicker}});Object.defineProperty(J,"PickResultType",{enumerable:!0,get:function(){return eg.PickResultType}});var RP=mm();Object.defineProperty(J,"BaseFilter",{enumerable:!0,get:function(){return RP.BaseFilter}});var DP=hm();Object.defineProperty(J,"FilterStackFactory",{enumerable:!0,get:function(){return DP.FilterStackFactory}});var kP=cc();Object.defineProperty(J,"registerAdminService",{enumerable:!0,get:function(){return kP.registerAdminService}});var NP=mu();Object.defineProperty(J,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return NP.BaseSubchannelWrapper}});var xP=Xm();Object.defineProperty(J,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return xP.OutlierDetectionLoadBalancingConfig}})});var Ab=D(ku=>{"use strict";Object.defineProperty(ku,"__esModule",{value:!0});ku.setup=void 0;var OP=wn(),tg=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function MP(){(0,OP.registerResolver)("unix",tg)}ku.setup=MP});var xb=D(Ou=>{"use strict";Object.defineProperty(Ou,"__esModule",{value:!0});Ou.setup=void 0;var Rb=pe("net"),Nu=fe(),ng=Rt(),Db=wn(),kb=Lt(),PP=Fe(),LP="ip_resolver";function Nb(n){PP.trace(Nu.LogVerbosity.DEBUG,LP,n)}var rg="ipv4",ig="ipv6",FP=443,xu=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,Nb("Resolver constructed for target "+(0,kb.uriToString)(e));let s=[];if(!(e.scheme===rg||e.scheme===ig)){this.error={code:Nu.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new ng.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,kb.splitHostPort)(a);if(l===null){this.error={code:Nu.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new ng.Metadata};return}if(e.scheme===rg&&!(0,Rb.isIPv4)(l.host)||e.scheme===ig&&!(0,Rb.isIPv6)(l.host)){this.error={code:Nu.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new ng.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:FP})}this.addresses=s,Nb("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function BP(){(0,Db.registerResolver)(rg,xu),(0,Db.registerResolver)(ig,xu)}Ou.setup=BP});var Pb=D(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.setup=Fn.PickFirstLoadBalancer=Fn.shuffled=Fn.PickFirstLoadBalancingConfig=void 0;var Ob=Tr(),pt=Gt(),Mu=br(),qP=Fe(),UP=fe(),VP="pick_first";function sg(n){qP.trace(UP.LogVerbosity.DEBUG,VP,n)}var Fa="pick_first",zP=250,Ba=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Fa}toJsonObject(){return{[Fa]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};Fn.PickFirstLoadBalancingConfig=Ba;var og=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Mu.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function Mb(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}Fn.shuffled=Mb;var Pu=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=pt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(pt.ConnectivityState.READY,new og(this.currentPick)):this.children.length===0?this.updateState(pt.ConnectivityState.IDLE,new Mu.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(pt.ConnectivityState.TRANSIENT_FAILURE,new Mu.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(pt.ConnectivityState.CONNECTING,new Mu.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==pt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===pt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===pt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===pt.ConnectivityState.IDLE||i===pt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===pt.ConnectivityState.IDLE&&(sg("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},zP)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(sg("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){sg(pt.ConnectivityState[this.currentState]+" -> "+pt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===pt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===pt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Ba&&(t.getShuffleAddressList()&&(e=Mb(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===pt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Fa}};Fn.PickFirstLoadBalancer=Pu;function GP(){(0,Ob.registerLoadBalancerType)(Fa,Pu,Ba),(0,Ob.registerDefaultLoadBalancerType)(Fa)}Fn.setup=GP});var Fb=D(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.setup=to.RoundRobinLoadBalancer=void 0;var jP=Tr(),mt=Gt(),Lu=br(),KP=bn(),WP=Fe(),$P=fe(),HP="round_robin";function Lb(n){WP.trace($P.LogVerbosity.DEBUG,HP,n)}var Fu="round_robin",ag=class n{getLoadBalancerName(){return Fu}constructor(){}toJsonObject(){return{[Fu]:{}}}static createFromJson(e){return new n}},lg=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Lu.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Bu=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=mt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===mt.ConnectivityState.TRANSIENT_FAILURE||i===mt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(mt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===mt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(mt.ConnectivityState.READY,new lg(e,t))}else this.countSubchannelsWithState(mt.ConnectivityState.CONNECTING)>0?this.updateState(mt.ConnectivityState.CONNECTING,new Lu.QueuePicker(this)):this.countSubchannelsWithState(mt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(mt.ConnectivityState.TRANSIENT_FAILURE,new Lu.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(mt.ConnectivityState.IDLE,new Lu.QueuePicker(this))}updateState(e,t){Lb(mt.ConnectivityState[this.currentState]+" -> "+mt.ConnectivityState[e]),e===mt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),Lb("Connect to address list "+e.map(r=>(0,KP.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===mt.ConnectivityState.IDLE||i===mt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Fu}};to.RoundRobinLoadBalancer=Bu;function QP(){(0,jP.registerLoadBalancerType)(Fu,Bu,ag)}to.setup=QP});var Vb=D(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.experimental=G.addAdminServicesToServer=G.getChannelzHandlers=G.getChannelzServiceDefinition=G.InterceptorConfigurationError=G.InterceptingCall=G.RequesterBuilder=G.ListenerBuilder=G.StatusBuilder=G.getClientChannel=G.ServerCredentials=G.Server=G.setLogVerbosity=G.setLogger=G.load=G.loadObject=G.CallCredentials=G.ChannelCredentials=G.waitForClientReady=G.closeClient=G.Channel=G.makeGenericClientConstructor=G.makeClientConstructor=G.loadPackageDefinition=G.Client=G.compressionAlgorithms=G.propagate=G.connectivityState=G.status=G.logVerbosity=G.Metadata=G.credentials=void 0;var qu=rf();Object.defineProperty(G,"CallCredentials",{enumerable:!0,get:function(){return qu.CallCredentials}});var YP=Lf();Object.defineProperty(G,"Channel",{enumerable:!0,get:function(){return YP.ChannelImplementation}});var JP=fm();Object.defineProperty(G,"compressionAlgorithms",{enumerable:!0,get:function(){return JP.CompressionAlgorithms}});var XP=Gt();Object.defineProperty(G,"connectivityState",{enumerable:!0,get:function(){return XP.ConnectivityState}});var Uu=ec();Object.defineProperty(G,"ChannelCredentials",{enumerable:!0,get:function(){return Uu.ChannelCredentials}});var Bb=Pf();Object.defineProperty(G,"Client",{enumerable:!0,get:function(){return Bb.Client}});var cg=fe();Object.defineProperty(G,"logVerbosity",{enumerable:!0,get:function(){return cg.LogVerbosity}});Object.defineProperty(G,"status",{enumerable:!0,get:function(){return cg.Status}});Object.defineProperty(G,"propagate",{enumerable:!0,get:function(){return cg.Propagate}});var qb=Fe(),ug=Bf();Object.defineProperty(G,"loadPackageDefinition",{enumerable:!0,get:function(){return ug.loadPackageDefinition}});Object.defineProperty(G,"makeClientConstructor",{enumerable:!0,get:function(){return ug.makeClientConstructor}});Object.defineProperty(G,"makeGenericClientConstructor",{enumerable:!0,get:function(){return ug.makeClientConstructor}});var ZP=Rt();Object.defineProperty(G,"Metadata",{enumerable:!0,get:function(){return ZP.Metadata}});var eL=Sb();Object.defineProperty(G,"Server",{enumerable:!0,get:function(){return eL.Server}});var tL=Um();Object.defineProperty(G,"ServerCredentials",{enumerable:!0,get:function(){return tL.ServerCredentials}});var nL=Tb();Object.defineProperty(G,"StatusBuilder",{enumerable:!0,get:function(){return nL.StatusBuilder}});G.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:Uu.ChannelCredentials.createInsecure,createSsl:Uu.ChannelCredentials.createSsl,createFromSecureContext:Uu.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:qu.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:qu.CallCredentials.createFromGoogleCredential,createEmpty:qu.CallCredentials.createEmpty};var rL=n=>n.close();G.closeClient=rL;var iL=(n,e,t)=>n.waitForReady(e,t);G.waitForClientReady=iL;var sL=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};G.loadObject=sL;var oL=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};G.load=oL;var aL=n=>{qb.setLogger(n)};G.setLogger=aL;var lL=n=>{qb.setLoggerVerbosity(n)};G.setLogVerbosity=lL;var cL=n=>Bb.Client.prototype.getChannel.call(n);G.getClientChannel=cL;var Vu=xf();Object.defineProperty(G,"ListenerBuilder",{enumerable:!0,get:function(){return Vu.ListenerBuilder}});Object.defineProperty(G,"RequesterBuilder",{enumerable:!0,get:function(){return Vu.RequesterBuilder}});Object.defineProperty(G,"InterceptingCall",{enumerable:!0,get:function(){return Vu.InterceptingCall}});Object.defineProperty(G,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Vu.InterceptorConfigurationError}});var Ub=bi();Object.defineProperty(G,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return Ub.getChannelzServiceDefinition}});Object.defineProperty(G,"getChannelzHandlers",{enumerable:!0,get:function(){return Ub.getChannelzHandlers}});var uL=cc();Object.defineProperty(G,"addAdminServicesToServer",{enumerable:!0,get:function(){return uL.addAdminServicesToServer}});var dL=Zm();G.experimental=dL;var hL=em(),fL=Ab(),pL=xb(),mL=Pb(),gL=Fb(),yL=Xm(),vL=bi();hL.setup(),fL.setup(),pL.setup(),mL.setup(),gL.setup(),yL.setup(),vL.setup()});var TR=[],XS=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Tn({type:n})}static{this.\u0275inj=Sn({imports:[Ih.forRoot(TR),Ih]})}}return n})();var zl=class{constructor(){this.name="name",this.goalLife="goal",this.photoUrl="https://images.unsplash.com/photo-1557040135-9dc2a6b60411?q=80&w=1935&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",this.email="email@domain.com",this.phoneNumber="999-999-9999",this.location="city, country",this.socialNetwork="@facebook"}};var ER="firebase",wR="10.14.1";mr(ER,wR,"app");var ea=new zS("ANGULARFIRE2_VERSION");var _R=(n,e)=>{let t=e?[e]:JS(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},yi=class{constructor(){return _R(bR)}},bR="app-check";function kh(){}var Gl=class{zone;delegate;constructor(e,t=OS){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Nh=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",kh,{},kh,kh)),t.pipe(FS({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},jl=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Gl(Zone.current)),this.insideAngular=t.run(()=>new Gl(Zone.current,Pl)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(Y(pr))};static \u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function CR(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function At(n){return IR(CR())(n)}function IR(n){return function(t){return t=t.lift(new Nh(n.ngZone)),t.pipe(cs(n.outsideAngular),pi(n.insideAngular))}}var DR=new Map,kR={activated:!1,tokenObservers:[]},NR={initialized:!1,enabled:!1};function nn(n){return DR.get(n)||Object.assign({},kR)}function iT(){return NR}var xR="https://content-firebaseappcheck.googleapis.com/v1";var OR="exchangeDebugToken",eT={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},oz=24*60*60*1e3;var Oh=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return w(this,null,function*(){this.stop();try{this.pending=new Ah,this.pending.promise.catch(t=>{}),yield MR(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ah,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function MR(n){return new Promise(e=>{setTimeout(e,n)})}var PR={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},gr=new QS("appCheck","AppCheck",PR);function sT(n){if(!nn(n).activated)throw gr.create("use-before-activation",{appName:n.name})}function oT(r,i){return w(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let v=yield o.getHeartbeatsHeader();v&&(s["X-Firebase-Client"]=v)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(v){throw gr.create("fetch-network-error",{originalErrorMessage:v?.message})}if(l.status!==200)throw gr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(v){throw gr.create("fetch-parse-error",{originalErrorMessage:v?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw gr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,f=Date.now();return{token:c.token,expireTimeMillis:f+d,issuedAtTimeMillis:f}})}function aT(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${xR}/projects/${t}/apps/${r}:${OR}?key=${i}`,body:{debug_token:e}}}var LR="firebase-app-check-database",FR=1,Mh="firebase-app-check-store";var Kl=null;function BR(){return Kl||(Kl=new Promise((n,e)=>{try{let t=indexedDB.open(LR,FR);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(gr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Mh,{keyPath:"compositeKey"})}}}catch(t){e(gr.create("storage-open",{originalErrorMessage:t?.message}))}}),Kl)}function qR(n,e){return UR(VR(n),e)}function UR(n,e){return w(this,null,function*(){let r=(yield BR()).transaction(Mh,"readwrite"),s=r.objectStore(Mh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(gr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function VR(n){return`${n.options.appId}-${n.name}`}var Ph=new Vl("@firebase/app-check");function xh(n,e){return Ul()?qR(n,e).catch(t=>{Ph.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function lT(){return iT().enabled}function cT(){return w(this,null,function*(){let n=iT();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var zR={error:"UNKNOWN_ERROR"};function GR(n){return WS.encodeString(JSON.stringify(n),!1)}function Lh(n,e=!1){return w(this,null,function*(){let t=n.app;sT(t);let r=nn(t),i=r.token,s;if(i&&!ta(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(ta(l)?i=l:yield xh(t,void 0))}if(!e&&i&&ta(i))return{token:i.token};let o=!1;if(lT()){r.exchangeTokenPromise||(r.exchangeTokenPromise=oT(aT(t,yield cT()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield xh(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield nn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Ph.warn(l.message):Ph.error(l),s=l}let a;return i?s?ta(i)?a={token:i.token,internalError:s}:a=nT(s):(a={token:i.token},r.token=i,yield xh(t,i)):a=nT(s),o&&$R(t,a),a})}function jR(n){return w(this,null,function*(){let e=n.app;sT(e);let{provider:t}=nn(e);if(lT()){let r=yield cT(),{token:i}=yield oT(aT(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function KR(n,e,t,r){let{app:i}=n,s=nn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&ta(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),tT(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>tT(n))}function uT(n,e){let t=nn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function tT(n){let{app:e}=n,t=nn(e),r=t.tokenRefresher;r||(r=WR(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function WR(n){let{app:e}=n;return new Oh(()=>w(this,null,function*(){let t=nn(e),r;if(t.token?r=yield Lh(n,!0):r=yield Lh(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=nn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},eT.RETRIAL_MIN_WAIT,eT.RETRIAL_MAX_WAIT)}function $R(n,e){let t=nn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function ta(n){return n.expireTimeMillis-Date.now()>0}function nT(n){return{token:GR(zR),error:n}}var Fh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=nn(this.app);for(let t of e)uT(this.app,t.next);return Promise.resolve()}};function HR(n,e){return new Fh(n,e)}function QR(n){return{getToken:e=>Lh(n,e),getLimitedUseToken:()=>jR(n),addTokenListener:e=>KR(n,"INTERNAL",e),removeTokenListener:e=>uT(n.app,e)}}var YR="@firebase/app-check",JR="0.8.8";var XR="app-check",rT="app-check-internal";function ZR(){Zo(new gi(XR,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return HR(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(rT).initialize()})),Zo(new gi(rT,n=>{let e=n.getProvider("app-check").getImmediate();return QR(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),mr(YR,JR)}ZR();var eD=["localhost","0.0.0.0","127.0.0.1"],vz=typeof window<"u"&&eD.includes(window.location.hostname);var tD="firebase",nD="10.14.1";Pt.registerVersion(tD,nD,"app-compat");var rD=["ngOnDestroy"],fT=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(rD.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var Wl=class{constructor(e){return e}},ps=new St("angularfire2.app.options"),ms=new St("angularfire2.app.name");function na(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Pt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Pt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;iD("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Wl(o)}var iD=(n,...e)=>{Ch()&&typeof console<"u"&&console[n](...e)},sD={provide:Wl,useFactory:na,deps:[ps,pr,[new BS,ms]]},pT=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:ps,useValue:t},{provide:ms,useValue:r}]}}constructor(t){Pt.registerVersion("angularfire",ea.full,"core"),Pt.registerVersion("angularfire",ea.full,"app-compat"),Pt.registerVersion("angular",GS.full,t.toString())}static \u0275fac=function(r){return new(r||n)(Y(us))};static \u0275mod=Tn({type:n});static \u0275inj=Sn({providers:[sD]})}return n})();function $l(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return oD(i,o)||(hT("error",`${e} was already initialized on the ${t} Firebase App with different settings.${aD?" You may need to reload as Firebase is not HMR aware.":""}`),hT("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function oD(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var aD=typeof module<"u"&&!!module.hot,hT=(n,...e)=>{Ch()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Bh=new St("angularfire2.auth.use-emulator"),qh=new St("angularfire2.auth.settings"),Uh=new St("angularfire2.auth.tenant-id"),Vh=new St("angularfire2.auth.langugage-code"),zh=new St("angularfire2.auth.use-device-language"),Gh=new St("angularfire.auth.persistence"),jh=(n,e,t,r,i,s,o,a)=>$l(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),mT=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,f,v){let b=new xS,I=fr(void 0).pipe(pi(o.outsideAngular),mi(()=>s.runOutsideAngular(()=>import("./chunk-QKSRMW26.mjs"))),me(()=>na(t,s,r)),me(C=>jh(C,s,a,c,u,d,l,f)),wh({bufferSize:1,refCount:!1}));if(ql(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=fr(null);else{I.pipe(LS()).subscribe();let C=I.pipe(mi(P=>P.getRedirectResult().then(L=>L,()=>null)),At,wh({bufferSize:1,refCount:!1})),M=I.pipe(mi(P=>new ls(L=>({unsubscribe:s.runOutsideAngular(()=>P.onAuthStateChanged(z=>L.next(z),z=>L.error(z),()=>L.complete()))})))),R=I.pipe(mi(P=>new ls(L=>({unsubscribe:s.runOutsideAngular(()=>P.onIdTokenChanged(z=>L.next(z),z=>L.error(z),()=>L.complete()))}))));this.authState=C.pipe(_h(M),cs(o.outsideAngular),pi(o.insideAngular)),this.user=C.pipe(_h(R),cs(o.outsideAngular),pi(o.insideAngular)),this.idToken=this.user.pipe(mi(P=>P?hr(P.getIdToken()):fr(null))),this.idTokenResult=this.user.pipe(mi(P=>P?hr(P.getIdTokenResult()):fr(null))),this.credential=MS(C,b,this.authState.pipe(Jo(P=>!P))).pipe(me(P=>P?.user?P:null),cs(o.outsideAngular),pi(o.insideAngular))}return fT(this,I,s,{spy:{apply:(C,M,R)=>{(C.startsWith("signIn")||C.startsWith("createUser"))&&R.then(P=>b.next(P))}}})}static \u0275fac=function(r){return new(r||n)(Y(ps),Y(ms,8),Y(us),Y(pr),Y(jl),Y(Bh,8),Y(qh,8),Y(Uh,8),Y(Vh,8),Y(zh,8),Y(Gh,8),Y(yi,8))};static \u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as SL,TextEncoder as TL,TextDecoder as EL}from"util";import{randomBytes as wL}from"crypto";var gT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yT={};var yr,Kh;(function(){var n;function e(T,g){function y(){}y.prototype=g.prototype,T.D=g.prototype,T.prototype=new y,T.prototype.constructor=T,T.C=function(S,m,E){for(var h=Array(arguments.length-2),p=2;p<arguments.length;p++)h[p-2]=arguments[p];return g.prototype[m].apply(S,h)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,g,y){y||(y=0);var S=Array(16);if(typeof g=="string")for(var m=0;16>m;++m)S[m]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(m=0;16>m;++m)S[m]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=T.g[0],y=T.g[1],m=T.g[2];var E=T.g[3],h=g+(E^y&(m^E))+S[0]+3614090360&4294967295;g=y+(h<<7&4294967295|h>>>25),h=E+(m^g&(y^m))+S[1]+3905402710&4294967295,E=g+(h<<12&4294967295|h>>>20),h=m+(y^E&(g^y))+S[2]+606105819&4294967295,m=E+(h<<17&4294967295|h>>>15),h=y+(g^m&(E^g))+S[3]+3250441966&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(E^y&(m^E))+S[4]+4118548399&4294967295,g=y+(h<<7&4294967295|h>>>25),h=E+(m^g&(y^m))+S[5]+1200080426&4294967295,E=g+(h<<12&4294967295|h>>>20),h=m+(y^E&(g^y))+S[6]+2821735955&4294967295,m=E+(h<<17&4294967295|h>>>15),h=y+(g^m&(E^g))+S[7]+4249261313&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(E^y&(m^E))+S[8]+1770035416&4294967295,g=y+(h<<7&4294967295|h>>>25),h=E+(m^g&(y^m))+S[9]+2336552879&4294967295,E=g+(h<<12&4294967295|h>>>20),h=m+(y^E&(g^y))+S[10]+4294925233&4294967295,m=E+(h<<17&4294967295|h>>>15),h=y+(g^m&(E^g))+S[11]+2304563134&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(E^y&(m^E))+S[12]+1804603682&4294967295,g=y+(h<<7&4294967295|h>>>25),h=E+(m^g&(y^m))+S[13]+4254626195&4294967295,E=g+(h<<12&4294967295|h>>>20),h=m+(y^E&(g^y))+S[14]+2792965006&4294967295,m=E+(h<<17&4294967295|h>>>15),h=y+(g^m&(E^g))+S[15]+1236535329&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(m^E&(y^m))+S[1]+4129170786&4294967295,g=y+(h<<5&4294967295|h>>>27),h=E+(y^m&(g^y))+S[6]+3225465664&4294967295,E=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(E^g))+S[11]+643717713&4294967295,m=E+(h<<14&4294967295|h>>>18),h=y+(E^g&(m^E))+S[0]+3921069994&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(m^E&(y^m))+S[5]+3593408605&4294967295,g=y+(h<<5&4294967295|h>>>27),h=E+(y^m&(g^y))+S[10]+38016083&4294967295,E=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(E^g))+S[15]+3634488961&4294967295,m=E+(h<<14&4294967295|h>>>18),h=y+(E^g&(m^E))+S[4]+3889429448&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(m^E&(y^m))+S[9]+568446438&4294967295,g=y+(h<<5&4294967295|h>>>27),h=E+(y^m&(g^y))+S[14]+3275163606&4294967295,E=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(E^g))+S[3]+4107603335&4294967295,m=E+(h<<14&4294967295|h>>>18),h=y+(E^g&(m^E))+S[8]+1163531501&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(m^E&(y^m))+S[13]+2850285829&4294967295,g=y+(h<<5&4294967295|h>>>27),h=E+(y^m&(g^y))+S[2]+4243563512&4294967295,E=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(E^g))+S[7]+1735328473&4294967295,m=E+(h<<14&4294967295|h>>>18),h=y+(E^g&(m^E))+S[12]+2368359562&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(y^m^E)+S[5]+4294588738&4294967295,g=y+(h<<4&4294967295|h>>>28),h=E+(g^y^m)+S[8]+2272392833&4294967295,E=g+(h<<11&4294967295|h>>>21),h=m+(E^g^y)+S[11]+1839030562&4294967295,m=E+(h<<16&4294967295|h>>>16),h=y+(m^E^g)+S[14]+4259657740&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(y^m^E)+S[1]+2763975236&4294967295,g=y+(h<<4&4294967295|h>>>28),h=E+(g^y^m)+S[4]+1272893353&4294967295,E=g+(h<<11&4294967295|h>>>21),h=m+(E^g^y)+S[7]+4139469664&4294967295,m=E+(h<<16&4294967295|h>>>16),h=y+(m^E^g)+S[10]+3200236656&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(y^m^E)+S[13]+681279174&4294967295,g=y+(h<<4&4294967295|h>>>28),h=E+(g^y^m)+S[0]+3936430074&4294967295,E=g+(h<<11&4294967295|h>>>21),h=m+(E^g^y)+S[3]+3572445317&4294967295,m=E+(h<<16&4294967295|h>>>16),h=y+(m^E^g)+S[6]+76029189&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(y^m^E)+S[9]+3654602809&4294967295,g=y+(h<<4&4294967295|h>>>28),h=E+(g^y^m)+S[12]+3873151461&4294967295,E=g+(h<<11&4294967295|h>>>21),h=m+(E^g^y)+S[15]+530742520&4294967295,m=E+(h<<16&4294967295|h>>>16),h=y+(m^E^g)+S[2]+3299628645&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(m^(y|~E))+S[0]+4096336452&4294967295,g=y+(h<<6&4294967295|h>>>26),h=E+(y^(g|~m))+S[7]+1126891415&4294967295,E=g+(h<<10&4294967295|h>>>22),h=m+(g^(E|~y))+S[14]+2878612391&4294967295,m=E+(h<<15&4294967295|h>>>17),h=y+(E^(m|~g))+S[5]+4237533241&4294967295,y=m+(h<<21&4294967295|h>>>11),h=g+(m^(y|~E))+S[12]+1700485571&4294967295,g=y+(h<<6&4294967295|h>>>26),h=E+(y^(g|~m))+S[3]+2399980690&4294967295,E=g+(h<<10&4294967295|h>>>22),h=m+(g^(E|~y))+S[10]+4293915773&4294967295,m=E+(h<<15&4294967295|h>>>17),h=y+(E^(m|~g))+S[1]+2240044497&4294967295,y=m+(h<<21&4294967295|h>>>11),h=g+(m^(y|~E))+S[8]+1873313359&4294967295,g=y+(h<<6&4294967295|h>>>26),h=E+(y^(g|~m))+S[15]+4264355552&4294967295,E=g+(h<<10&4294967295|h>>>22),h=m+(g^(E|~y))+S[6]+2734768916&4294967295,m=E+(h<<15&4294967295|h>>>17),h=y+(E^(m|~g))+S[13]+1309151649&4294967295,y=m+(h<<21&4294967295|h>>>11),h=g+(m^(y|~E))+S[4]+4149444226&4294967295,g=y+(h<<6&4294967295|h>>>26),h=E+(y^(g|~m))+S[11]+3174756917&4294967295,E=g+(h<<10&4294967295|h>>>22),h=m+(g^(E|~y))+S[2]+718787259&4294967295,m=E+(h<<15&4294967295|h>>>17),h=y+(E^(m|~g))+S[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(m+(h<<21&4294967295|h>>>11))&4294967295,T.g[2]=T.g[2]+m&4294967295,T.g[3]=T.g[3]+E&4294967295}r.prototype.u=function(T,g){g===void 0&&(g=T.length);for(var y=g-this.blockSize,S=this.B,m=this.h,E=0;E<g;){if(m==0)for(;E<=y;)i(this,T,E),E+=this.blockSize;if(typeof T=="string"){for(;E<g;)if(S[m++]=T.charCodeAt(E++),m==this.blockSize){i(this,S),m=0;break}}else for(;E<g;)if(S[m++]=T[E++],m==this.blockSize){i(this,S),m=0;break}}this.h=m,this.o+=g},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;var y=8*this.o;for(g=T.length-8;g<T.length;++g)T[g]=y&255,y/=256;for(this.u(T),T=Array(16),g=y=0;4>g;++g)for(var S=0;32>S;S+=8)T[y++]=this.g[g]>>>S&255;return T};function s(T,g){var y=a;return Object.prototype.hasOwnProperty.call(y,T)?y[T]:y[T]=g(T)}function o(T,g){this.h=g;for(var y=[],S=!0,m=T.length-1;0<=m;m--){var E=T[m]|0;S&&E==g||(y[m]=E,S=!1)}this.g=y}var a={};function l(T){return-128<=T&&128>T?s(T,function(g){return new o([g|0],0>g?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return d;if(0>T)return C(c(-T));for(var g=[],y=1,S=0;T>=y;S++)g[S]=T/y|0,y*=4294967296;return new o(g,0)}function u(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return C(u(T.substring(1),g));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),S=d,m=0;m<T.length;m+=8){var E=Math.min(8,T.length-m),h=parseInt(T.substring(m,m+E),g);8>E?(E=c(Math.pow(g,E)),S=S.j(E).add(c(h))):(S=S.j(y),S=S.add(c(h)))}return S}var d=l(0),f=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(I(this))return-C(this).m();for(var T=0,g=1,y=0;y<this.g.length;y++){var S=this.i(y);T+=(0<=S?S:4294967296+S)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(b(this))return"0";if(I(this))return"-"+C(this).toString(T);for(var g=c(Math.pow(T,6)),y=this,S="";;){var m=L(y,g).g;y=M(y,m.j(g));var E=((0<y.g.length?y.g[0]:y.h)>>>0).toString(T);if(y=m,b(y))return E+S;for(;6>E.length;)E="0"+E;S=E+S}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function b(T){if(T.h!=0)return!1;for(var g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function I(T){return T.h==-1}n.l=function(T){return T=M(this,T),I(T)?-1:b(T)?0:1};function C(T){for(var g=T.g.length,y=[],S=0;S<g;S++)y[S]=~T.g[S];return new o(y,~T.h).add(f)}n.abs=function(){return I(this)?C(this):this},n.add=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0,m=0;m<=g;m++){var E=S+(this.i(m)&65535)+(T.i(m)&65535),h=(E>>>16)+(this.i(m)>>>16)+(T.i(m)>>>16);S=h>>>16,E&=65535,h&=65535,y[m]=h<<16|E}return new o(y,y[y.length-1]&-2147483648?-1:0)};function M(T,g){return T.add(C(g))}n.j=function(T){if(b(this)||b(T))return d;if(I(this))return I(T)?C(this).j(C(T)):C(C(this).j(T));if(I(T))return C(this.j(C(T)));if(0>this.l(v)&&0>T.l(v))return c(this.m()*T.m());for(var g=this.g.length+T.g.length,y=[],S=0;S<2*g;S++)y[S]=0;for(S=0;S<this.g.length;S++)for(var m=0;m<T.g.length;m++){var E=this.i(S)>>>16,h=this.i(S)&65535,p=T.i(m)>>>16,F=T.i(m)&65535;y[2*S+2*m]+=h*F,R(y,2*S+2*m),y[2*S+2*m+1]+=E*F,R(y,2*S+2*m+1),y[2*S+2*m+1]+=h*p,R(y,2*S+2*m+1),y[2*S+2*m+2]+=E*p,R(y,2*S+2*m+2)}for(S=0;S<g;S++)y[S]=y[2*S+1]<<16|y[2*S];for(S=g;S<2*g;S++)y[S]=0;return new o(y,0)};function R(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function P(T,g){this.g=T,this.h=g}function L(T,g){if(b(g))throw Error("division by zero");if(b(T))return new P(d,d);if(I(T))return g=L(C(T),g),new P(C(g.g),C(g.h));if(I(g))return g=L(T,C(g)),new P(C(g.g),g.h);if(30<T.g.length){if(I(T)||I(g))throw Error("slowDivide_ only works with positive integers.");for(var y=f,S=g;0>=S.l(T);)y=z(y),S=z(S);var m=Q(y,1),E=Q(S,1);for(S=Q(S,2),y=Q(y,2);!b(S);){var h=E.add(S);0>=h.l(T)&&(m=m.add(y),E=h),S=Q(S,1),y=Q(y,1)}return g=M(T,m.j(g)),new P(m,g)}for(m=d;0<=T.l(g);){for(y=Math.max(1,Math.floor(T.m()/g.m())),S=Math.ceil(Math.log(y)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),E=c(y),h=E.j(g);I(h)||0<h.l(T);)y-=S,E=c(y),h=E.j(g);b(E)&&(E=f),m=m.add(E),T=M(T,h)}return new P(m,T)}n.A=function(T){return L(this,T).h},n.and=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)&T.i(S);return new o(y,this.h&T.h)},n.or=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)|T.i(S);return new o(y,this.h|T.h)},n.xor=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)^T.i(S);return new o(y,this.h^T.h)};function z(T){for(var g=T.g.length+1,y=[],S=0;S<g;S++)y[S]=T.i(S)<<1|T.i(S-1)>>>31;return new o(y,T.h)}function Q(T,g){var y=g>>5;g%=32;for(var S=T.g.length-y,m=[],E=0;E<S;E++)m[E]=0<g?T.i(E+y)>>>g|T.i(E+y+1)<<32-g:T.i(E+y);return new o(m,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Kh=yT.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,yr=yT.Integer=o}).apply(typeof gT<"u"?gT:typeof self<"u"?self:typeof window<"u"?window:{});var Fi=NS(Vb(),1),Z0=NS(Vp(),1);var zb="@firebase/firestore",Gb="4.7.3";var Ze=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ze.UNAUTHENTICATED=new Ze(null);Ze.GOOGLE_CREDENTIALS=new Ze("google-credentials-uid");Ze.FIRST_PARTY=new Ze("first-party-uid");Ze.MOCK_USER=new Ze("mock-user");var _L="10.14.0";var Fo=_L;function bL(n){Fo=n}function CL(n){return SL(n,{depth:100})}var Xr=new Vl("@firebase/firestore");function co(){return Xr.logLevel}function eC(n){Xr.setLogLevel(n)}function O(n,...e){if(Xr.logLevel<=En.DEBUG){let t=e.map(wv);Xr.debug(`Firestore (${Fo}): ${n}`,...t)}}function Oe(n,...e){if(Xr.logLevel<=En.ERROR){let t=e.map(wv);Xr.error(`Firestore (${Fo}): ${n}`,...t)}}function fn(n,...e){if(Xr.logLevel<=En.WARN){let t=e.map(wv);Xr.warn(`Firestore (${Fo}): ${n}`,...t)}}function wv(n){if(typeof n=="string")return n;try{return CL(n)}catch{return n}}function V(n="Unexpected state"){let e=`FIRESTORE (${Fo}) INTERNAL ASSERTION FAILED: `+n;throw Oe(e),new Error(e)}function j(n,e){n||V()}function tC(n,e){n||V()}function U(n,e){return n}var A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends HS{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ju=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},wg=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ze.UNAUTHENTICATED))}shutdown(){}},_g=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},bg=class{constructor(e){this.authProvider=e,this.currentUser=Ze.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){j(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new Je;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new Je,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>w(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Je)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(j(typeof r.accessToken=="string"),new Ju(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return j(e===null||typeof e=="string"),new Ze(e)}},Cg=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=Ze.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Ig=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Cg(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Ze.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ag=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Rg=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){j(this.tokenListener===void 0);let r=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(j(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Ag(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function IL(n){if(!n)return new wg;switch(n.type){case"firstParty":return new Ig(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new k(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function AL(n){return wL(n)}var Xu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=AL(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function X(n,e){return n<e?-1:n>e?1:0}function Bi(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function nC(n){return n+"\0"}var jb=-62135596800,Kb=1e6,Me=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<jb)throw new k(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*Kb);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/Kb}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-jb,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var $=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Me(0,0))}static max(){return new n(new Me(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Wb="__name__",Zu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&V(),r===void 0?r=e.length-t:r>e.length-t&&V(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},le=class n extends Zu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new k(A.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},RL=/^[_a-zA-Z][_a-zA-Z0-9]*$/,je=class n extends Zu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return RL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Wb}static keyField(){return new n([Wb])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new k(A.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new k(A.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new k(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new k(A.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var q=class n{constructor(e){this.path=e}static fromPath(e){return new n(le.fromString(e))}static fromName(e){return new n(le.fromString(e).popFirst(5))}static empty(){return new n(le.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&le.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return le.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new le(e.slice()))}};var So=-1,DL=0,Dg=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function _v(n){return n.fields.find(e=>e.kind===2)}function qi(n){return n.fields.filter(e=>e.kind!==2)}function kL(n){let e=qi(n);return e.length===0?0:e[e.length-1].kind}function NL(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var go=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ja=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(DL,en.min())}};function rC(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=$.fromTimestamp(r===1e9?new Me(t+1,0):new Me(t,r));return new en(i,q.empty(),e)}function iC(n){return new en(n.readTime,n.key,So)}var en=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n($.min(),q.empty(),So)}static max(){return new n($.max(),q.empty(),So)}};function bv(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=q.comparator(n.documentKey,e.documentKey),t!==0)?t:X(n.largestBatchId,e.largestBatchId)}var sC="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ed=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ci(n){return w(this,null,function*(){if(n.code===A.FAILED_PRECONDITION&&n.message===sC)O("LocalStore","Unexpectedly lost primary lease");else throw n})}var _=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&V(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var qt="SimpleDb",xL=3,td=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new Je,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Li(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=Cv(r.target.error);this.completionDeferred.reject(new Li(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Li(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(O(qt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new Ng(t)}},Zr=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(Xo())===12.2&&Oe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return O(qt,"Removing database:",e),Di(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Ul())return!1;if(n.isMockPersistence())return!0;let e=Xo(),t=n.getIOSVersion(e),r=0<t&&t<10,i=oC(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return w(this,null,function*(){return this.db||(O(qt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Li(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new k(A.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new k(A.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Li(e,o))},i.onupgradeneeded=s=>{O(qt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{O(qt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return w(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=td.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),_.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<xL;if(O(qt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function oC(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var kg=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Di(this.dbCursor.delete())}},Li=class extends k{constructor(e,t){super(A.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ui(n){return n.name==="IndexedDbTransactionError"}var Ng=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(O(qt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(O(qt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Di(r)}add(e){O(qt,"ADD",this.store.name,e,e);let t=this.store.add(e);return Di(t)}get(e){let t=this.store.get(e);return Di(t).next(r=>(r===void 0&&(r=null),O(qt,"GET",this.store.name,e,r),r))}delete(e){O(qt,"DELETE",this.store.name,e);let t=this.store.delete(e);return Di(t)}count(){O(qt,"COUNT",this.store.name);let e=this.store.count();return Di(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new _((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new _((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){O(qt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new _((r,i)=>{t.onerror=s=>{let o=Cv(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new _((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new kg(a),c=t(a.primaryKey,a.value,l);if(c instanceof _){let u=c.catch(d=>(l.done(),_.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>_.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Di(n){return new _((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Cv(r.target.error);t(i)}})}var $b=!1;function Cv(n){let e=Zr.getIOSVersion(Xo());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return $b||($b=!0,setTimeout(()=>{throw r},0)),r}}return n}var Ka="IndexBackfiller",OL=15*1e3,ML=60*1e3,PL=50,xg=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(OL)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){O(Ka,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>w(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();O(Ka,`Documents written: ${t}`)}catch(t){ui(t)?O(Ka,"Ignoring IndexedDB error during index backfill: ",t):yield ci(t)}yield this.schedule(ML)}))}},Og=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return w(this,arguments,function*(e=PL){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return _.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return O(Ka,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(O(Ka,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=iC(s);bv(o,r)>0&&(r=o)}),new en(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Ut=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),yo="",Mg="",aC="",lC="";function _t(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Hb(e)),e=LL(n.get(t),e);return Hb(e)}function LL(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=yo+aC;break;case yo:t+=yo+lC;break;default:t+=s}}return t}function Hb(n){return n+yo+Mg}function qn(n){let e=n.length;if(j(e>=2),e===2)return j(n.charAt(0)===yo&&n.charAt(1)===Mg),le.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(yo,s);switch((o<0||o>t)&&V(),n.charAt(o+1)){case Mg:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case aC:i+=n.substring(s,o),i+="\0";break;case lC:i+=n.substring(s,o+1);break;default:V()}s=o+2}return new le(r)}var ki="remoteDocuments";var El="owner",no="owner",wl="mutationQueues",FL="userId",hn="mutations",cC="batchId",Mi="userMutationsIndex",uC=["userId","batchId"];function BL(n){return[n]}function Wu(n,e){return[n,_t(e)]}function dC(n,e,t){return[n,_t(e),t]}var qL={},Bo="documentMutations",jd="remoteDocumentsV14",UL=["prefixPath","collectionGroup","readTime","documentId"],$u="documentKeyIndex",VL=["prefixPath","collectionGroup","documentId"],hC="collectionGroupIndex",zL=["collectionGroup","readTime","prefixPath","documentId"],_l="remoteDocumentGlobal",Pg="remoteDocumentGlobalKey",qo="targets",GL="targetId",fC="queryTargetsIndex",jL=["canonicalId","targetId"],Uo="targetDocuments",KL=["targetId","path"],Iv="documentTargetsIndex",WL=["path","targetId"],nd="targetGlobalKey",Xi="targetGlobal",Xa="collectionParents",$L=["collectionId","parent"],To="clientMetadata",HL="clientId",Kd="bundles",QL="bundleId",Wd="namedQueries",YL="name",Av="indexConfiguration",JL="indexId",Lg="collectionGroupIndex",XL="collectionGroup",$d="indexState",ZL=["indexId","uid"],pC="sequenceNumberIndex",e2=["uid","sequenceNumber"],Hd="indexEntries",t2=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],mC="documentKeyIndex",n2=["indexId","uid","orderedDocumentKey"],Qd="documentOverlays",r2=["userId","collectionPath","documentId"],Fg="collectionPathOverlayIndex",i2=["userId","collectionPath","largestBatchId"],gC="collectionGroupOverlayIndex",s2=["userId","collectionGroup","largestBatchId"],Rv="globals",o2="name",a2=[wl,hn,Bo,ki,qo,El,Xi,Uo],l2=a2,c2=[...l2,To],u2=[...c2,_l],d2=[...u2,Xa],yC=[...d2,Kd,Wd],h2=[...yC,Qd],vC=[wl,hn,Bo,jd,qo,El,Xi,Uo,To,_l,Xa,Kd,Wd,Qd],SC=vC,Dv=[...SC,Av,$d,Hd],f2=Dv,p2=[...Dv,Rv];function m2(n){if(n===17)return p2;if(n===16)return f2;if(n===15)return Dv;if(n===14)return SC;if(n===13)return vC;if(n===12)return h2;if(n===11)return yC;V()}var Za=class extends ed{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function tt(n,e){let t=U(n);return Zr.getStore(t.simpleDbTransaction,e)}function Qb(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function TC(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Ae=class n{constructor(e,t){this.comparator=e,this.root=t||Wa.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wa.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wa.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new po(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new po(this.root,e,this.comparator,!1)}getReverseIterator(){return new po(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new po(this.root,e,this.comparator,!0)}},po=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Wa=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw V();let t=this.left.check();if(t!==this.right.check())throw V();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Bg=class{constructor(){this.size=0}get key(){throw V()}get value(){throw V()}get color(){throw V()}get left(){throw V()}get right(){throw V()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Wa(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Wa.EMPTY=new Bg;var Te=class n{constructor(e){this.comparator=e,this.data=new Ae(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rd(this.data.getIterator())}getIteratorFrom(e){return new rd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},rd=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function g2(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=ro(s),l=ro(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=ro(o)):u?(i(a),a=ro(s)):(a=ro(s),l=ro(o))}}function ro(n){return n.hasNext()?n.getNext():void 0}var Vt=class n{constructor(e){this.fields=e,e.sort(je.comparator)}static empty(){return new n([])}unionWith(e){let t=new Te(je.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Bi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function y2(n){return Buffer.from(n,"base64").toString("binary")}function v2(n){return Buffer.from(n,"binary").toString("base64")}function EC(){return!0}var Ke=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=y2(e);return new n(t)}static fromUint8Array(e){let t=S2(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return v2(this.binaryString)}toUint8Array(){return T2(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ke.EMPTY_BYTE_STRING=new Ke("");function S2(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function T2(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var E2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rr(n){if(j(!!n),typeof n=="string"){let e=0,t=E2.exec(n);if(j(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=ke(n.seconds),t=ke(n.nanos);return{seconds:e,nanos:t}}}function ke(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ei(n){return typeof n=="string"?Ke.fromBase64String(n):Ke.fromUint8Array(n)}var wC="server_timestamp",_C="__type__",bC="__previous_value__",CC="__local_write_time__";function Yd(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[_C])===null||t===void 0?void 0:t.stringValue)===wC}function w2(n,e){let t={fields:{[_C]:{stringValue:wC},[CC]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Yd(e)&&(e=kv(e)),e&&(t.fields[bC]=e),{mapValue:t}}function kv(n){let e=n.mapValue.fields[bC];return Yd(e)?kv(e):e}function el(n){let e=rr(n.mapValue.fields[CC].timestampValue);return new Me(e.seconds,e.nanos)}var qg=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},Yb="(default)",ti=class n{constructor(e,t){this.projectId=e,this.database=t||Yb}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Yb}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function _2(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new k(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ti(n.options.projectId,e)}var Jr=-1;function bl(n){return n==null}function tl(n){return n===0&&1/n===-1/0}function IC(n){return typeof n=="number"&&Number.isInteger(n)&&!tl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Nv="__type__",AC="__max__",Qr={mapValue:{fields:{__type__:{stringValue:AC}}}},xv="__vector__",Eo="value",Hu={nullValue:"NULL_VALUE"};function Ui(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Yd(n)?4:DC(n)?9007199254740991:Jd(n)?10:11:V()}function pn(n,e){if(n===e)return!0;let t=Ui(n),r=Ui(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return el(n).isEqual(el(e));case 3:return b2(n,e);case 5:return n.stringValue===e.stringValue;case 6:return I2(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return C2(n,e);case 2:return A2(n,e);case 9:return Bi(n.arrayValue.values||[],e.arrayValue.values||[],pn);case 10:case 11:return R2(n,e);case 9007199254740991:return!0;default:return V()}}function b2(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=rr(n.timestampValue),r=rr(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function C2(n,e){return ke(n.geoPointValue.latitude)===ke(e.geoPointValue.latitude)&&ke(n.geoPointValue.longitude)===ke(e.geoPointValue.longitude)}function I2(n,e){return ei(n.bytesValue).isEqual(ei(e.bytesValue))}function A2(n,e){if("integerValue"in n&&"integerValue"in e)return ke(n.integerValue)===ke(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=ke(n.doubleValue),r=ke(e.doubleValue);return t===r?tl(t)===tl(r):isNaN(t)&&isNaN(r)}return!1}function R2(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(Qb(t)!==Qb(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!pn(t[i],r[i])))return!1;return!0}function nl(n,e){return(n.values||[]).find(t=>pn(t,e))!==void 0}function ni(n,e){if(n===e)return 0;let t=Ui(n),r=Ui(e);if(t!==r)return X(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return D2(n,e);case 3:return Jb(n.timestampValue,e.timestampValue);case 4:return Jb(el(n),el(e));case 5:return X(n.stringValue,e.stringValue);case 6:return x2(n.bytesValue,e.bytesValue);case 7:return k2(n.referenceValue,e.referenceValue);case 8:return N2(n.geoPointValue,e.geoPointValue);case 9:return RC(n.arrayValue,e.arrayValue);case 10:return O2(n.mapValue,e.mapValue);case 11:return M2(n.mapValue,e.mapValue);default:throw V()}}function D2(n,e){let t=ke(n.integerValue||n.doubleValue),r=ke(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function Jb(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);let t=rr(n),r=rr(e),i=X(t.seconds,r.seconds);return i!==0?i:X(t.nanos,r.nanos)}function k2(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=X(t[i],r[i]);if(s!==0)return s}return X(t.length,r.length)}function N2(n,e){let t=X(ke(n.latitude),ke(e.latitude));return t!==0?t:X(ke(n.longitude),ke(e.longitude))}function x2(n,e){let t=ei(n),r=ei(e);return t.compareTo(r)}function RC(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=ni(t[i],r[i]);if(s)return s}return X(t.length,r.length)}function O2(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Eo])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Eo])===null||r===void 0?void 0:r.arrayValue,u=X(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:RC(l,c)}function M2(n,e){if(n===Qr.mapValue&&e===Qr.mapValue)return 0;if(n===Qr.mapValue)return 1;if(e===Qr.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=X(r[o],s[o]);if(a!==0)return a;let l=ni(t[r[o]],i[s[o]]);if(l!==0)return l}return X(r.length,s.length)}function wo(n){return Ov(n)}function Ov(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?L2(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?P2(n.bytesValue):"referenceValue"in n?B2(n.referenceValue):"geoPointValue"in n?F2(n.geoPointValue):"arrayValue"in n?U2(n.arrayValue):"mapValue"in n?q2(n.mapValue):V()}function P2(n){return ei(n).toBase64()}function L2(n){let e=rr(n);return`time(${e.seconds},${e.nanos})`}function F2(n){return`geo(${n.latitude},${n.longitude})`}function B2(n){return q.fromName(n).toString()}function q2(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Ov(n.fields[i])}`;return t+"}"}function U2(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Ov(r);return e+"]"}function Vi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ug(n){return!!n&&"integerValue"in n}function V2(n){return!!n&&"doubleValue"in n}function z2(n){return Ug(n)||V2(n)}function rl(n){return!!n&&"arrayValue"in n}function Xb(n){return!!n&&"nullValue"in n}function Zb(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qu(n){return!!n&&"mapValue"in n}function Jd(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Nv])===null||t===void 0?void 0:t.stringValue)===xv}function $a(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Zi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=$a(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=$a(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function DC(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===AC}var kC={mapValue:{fields:{[Nv]:{stringValue:xv},[Eo]:{arrayValue:{}}}}};function G2(n){return"nullValue"in n?Hu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Vi(ti.empty(),q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Jd(n)?kC:{mapValue:{}}:V()}function j2(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Vi(ti.empty(),q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?kC:"mapValue"in n?Jd(n)?{mapValue:{}}:Qr:V()}function e0(n,e){let t=ni(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function t0(n,e){let t=ni(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var gt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Qu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=$a(t)}setAll(e){let t=je.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=$a(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Qu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Qu(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Zi(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n($a(this.value))}};function NC(n){let e=[];return Zi(n.fields,(t,r)=>{let i=new je([t]);if(Qu(r)){let o=NC(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Vt(e)}var Xe=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,$.min(),$.min(),$.min(),gt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,$.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,$.min(),$.min(),gt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,$.min(),$.min(),gt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual($.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function K2(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?ni(r,i):V()}var Gn=class{constructor(e,t){this.position=e,this.inclusive=t}};function xC(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=q.comparator(q.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=ni(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function W2(n,e,t){let r=xC(n,e,t);return n.inclusive?r>=0:r>0}function $2(n,e,t){let r=xC(n,e,t);return n.inclusive?r<=0:r<0}function n0(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!pn(r,i))return!1}return!0}var zi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function H2(n){return n.field.canonicalString()+n.dir}function Q2(n){return`${n.field.canonicalString()} (${n.dir})`}function Y2(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var id=class{},re=class n extends id{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Gg(e,t,r):t==="array-contains"?new Wg(e,r):t==="in"?new sd(e,r):t==="not-in"?new $g(e,r):t==="array-contains-any"?new Hg(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new jg(e,r):new Kg(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ni(t,this.value)):t!==null&&Ui(this.value)===Ui(t)&&this.matchesComparison(ni(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return V()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ye=class n extends id{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return _o(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function _o(n){return n.op==="and"}function Vg(n){return n.op==="or"}function Mv(n){return OC(n)&&_o(n)}function OC(n){for(let e of n.filters)if(e instanceof ye)return!1;return!0}function zg(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+wo(n.value);if(Mv(n))return n.filters.map(e=>zg(e)).join(",");{let e=n.filters.map(t=>zg(t)).join(",");return`${n.op}(${e})`}}function MC(n,e){if(n instanceof re)return J2(n,e);if(n instanceof ye)return X2(n,e);V()}function J2(n,e){return e instanceof re&&n.op===e.op&&n.field.isEqual(e.field)&&pn(n.value,e.value)}function X2(n,e){return e instanceof ye&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&MC(i,e.filters[s]),!0):!1}function PC(n,e){let t=n.filters.concat(e);return ye.create(t,n.op)}function LC(n){return n instanceof re?eF(n):n instanceof ye?Z2(n):"Filter"}function Z2(n){return n.op.toString()+" {"+n.getFilters().map(LC).join(" ,")+"}"}function eF(n){return`${n.field.canonicalString()} ${n.op} ${wo(n.value)}`}var Gg=class extends re{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},jg=class extends re{constructor(e,t){super(e,"in",t),this.keys=FC("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Kg=class extends re{constructor(e,t){super(e,"not-in",t),this.keys=FC("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function FC(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>q.fromName(r.referenceValue))}var Wg=class extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rl(t)&&nl(t.arrayValue,this.value)}},sd=class extends re{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&nl(this.value.arrayValue,t)}},$g=class extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(nl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!nl(this.value.arrayValue,t)}},Hg=class extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!rl(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>nl(this.value.arrayValue,r))}};var Qg=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function Yg(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Qg(n,e,t,r,i,s,o)}function Gi(n){let e=U(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>zg(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>H2(r)).join(","),bl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>wo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>wo(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function tF(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>LC(t)).join(", ")}]`),bl(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>Q2(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>wo(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>wo(t)).join(",")),`Target(${e})`}function Cl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Y2(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!MC(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!n0(n.startAt,e.startAt)?!1:n0(n.endAt,e.endAt)}function od(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Xd(n,e){return n.filters.filter(t=>t instanceof re&&t.field.isEqual(e))}function nF(n,e){let t=_v(e);if(t===void 0)return null;for(let r of Xd(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function rF(n,e){let t=new Map;for(let r of qi(e))for(let i of Xd(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function iF(n,e){let t=[],r=!0;for(let i of qi(e)){let s=i.kind===0?BC(n,i.fieldPath,n.startAt):qC(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new Gn(t,r)}function sF(n,e){let t=[],r=!0;for(let i of qi(e)){let s=i.kind===0?qC(n,i.fieldPath,n.endAt):BC(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new Gn(t,r)}function BC(n,e,t){let r=Hu,i=!0;for(let s of Xd(n,e)){let o=Hu,a=!0;switch(s.op){case"<":case"<=":o=G2(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Hu;break}e0({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];e0({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function qC(n,e,t){let r=Qr,i=!0;for(let s of Xd(n,e)){let o=Qr,a=!0;switch(s.op){case">=":case">":o=j2(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Qr;break}t0({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];t0({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function oF(n){let e=new Te(je.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function aF(n){return n.limit!==null}var mn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function UC(n,e,t,r,i,s,o,a){return new mn(n,e,t,r,i,s,o,a)}function Vo(n){return new mn(n)}function lF(n,e){return new mn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function r0(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cF(n){let e=new Te(je.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function uF(n){return new mn(le.emptyPath(),n)}function dF(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Pv(n){return n.collectionGroup!==null}function bo(n){let e=U(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";cF(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new zi(s,r))}),t.has(je.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new zi(je.keyField(),r))}return e.memoizedNormalizedOrderBy}function bt(n){let e=U(n);return e.memoizedTarget||(e.memoizedTarget=hF(e,bo(n))),e.memoizedTarget}function hF(n,e){if(n.limitType==="F")return Yg(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new zi(i.field,s)});let t=n.endAt?new Gn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Gn(n.startAt.position,n.startAt.inclusive):null;return Yg(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Lv(n,e){let t=n.filters.concat([e]);return new mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function fF(n,e){let t=n.explicitOrderBy.concat([e]);return new mn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ad(n,e,t){return new mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function pF(n,e){return new mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function mF(n,e){return new mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Il(n,e){return Cl(bt(n),bt(e))&&n.limitType===e.limitType}function VC(n){return`${Gi(bt(n))}|lt:${n.limitType}`}function uo(n){return`Query(target=${tF(bt(n))}; limitType=${n.limitType})`}function Al(n,e){return e.isFoundDocument()&&gF(n,e)&&yF(n,e)&&vF(n,e)&&SF(n,e)}function gF(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):q.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function yF(n,e){for(let t of bo(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function vF(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function SF(n,e){return!(n.startAt&&!$2(n.startAt,bo(n),e)||n.endAt&&!W2(n.endAt,bo(n),e))}function zC(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function GC(n){return(e,t)=>{let r=!1;for(let i of bo(n)){let s=TF(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function TF(n,e,t){let r=n.field.isKeyField()?q.comparator(e.key,t.key):K2(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return V()}}var jn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zi(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return TC(this.inner)}size(){return this.innerSize}};var EF=new Ae(q.comparator);function xt(){return EF}var jC=new Ae(q.comparator);function Ga(...n){let e=jC;for(let t of n)e=e.insert(t.key,t);return e}function wF(){return il()}function KC(n){let e=jC;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Un(){return il()}function WC(){return il()}function il(){return new jn(n=>n.toString(),(n,e)=>n.isEqual(e))}var _F=new Ae(q.comparator);function bF(){return _F}var CF=new Te(q.comparator);function Z(...n){let e=CF;for(let t of n)e=e.add(t);return e}var IF=new Te(X);function Fv(){return IF}function Bv(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tl(e)?"-0":e}}function $C(n){return{integerValue:""+n}}function HC(n,e){return IC(e)?$C(e):Bv(n,e)}var Co=class{constructor(){this._=void 0}};function AF(n,e,t){return n instanceof ri?w2(t,e):n instanceof ir?YC(n,e):n instanceof sr?JC(n,e):kF(n,e)}function RF(n,e,t){return n instanceof ir?YC(n,e):n instanceof sr?JC(n,e):t}function QC(n,e){return n instanceof ii?z2(e)?e:{integerValue:0}:null}function DF(n,e){return n instanceof ir&&e instanceof ir||n instanceof sr&&e instanceof sr?Bi(n.elements,e.elements,pn):n instanceof ii&&e instanceof ii?pn(n.operand,e.operand):n instanceof ri&&e instanceof ri}var ri=class extends Co{},ir=class extends Co{constructor(e){super(),this.elements=e}};function YC(n,e){let t=XC(e);for(let r of n.elements)t.some(i=>pn(i,r))||t.push(r);return{arrayValue:{values:t}}}var sr=class extends Co{constructor(e){super(),this.elements=e}};function JC(n,e){let t=XC(e);for(let r of n.elements)t=t.filter(i=>!pn(i,r));return{arrayValue:{values:t}}}var ii=class extends Co{constructor(e,t){super(),this.serializer=e,this.operand=t}};function kF(n,e){let t=QC(n,e),r=i0(t)+i0(n.operand);return Ug(t)&&Ug(n.operand)?$C(r):Bv(n.serializer,r)}function i0(n){return ke(n.integerValue||n.doubleValue)}function XC(n){return rl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var ji=class{constructor(e,t){this.field=e,this.transform=t}};function NF(n,e){return n.field.isEqual(e.field)&&DF(n.transform,e.transform)}function xF(n,e){return n===void 0&&e===void 0?!0:n&&e?Bi(n,e,(t,r)=>NF(t,r)):!1}var Jg=class{constructor(e,t){this.version=e,this.transformResults=t}},Be=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Zd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Io=class{};function ZC(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new oi(n.key,Be.none()):new si(n.key,n.data,Be.none());{let t=n.data,r=gt.empty(),i=new Te(je.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new gn(n.key,r,new Vt(i.toArray()),Be.none())}}function OF(n,e,t){n instanceof si?PF(n,e,t):n instanceof gn?FF(n,e,t):qF(n,e,t)}function Ha(n,e,t,r){return n instanceof si?LF(n,e,t,r):n instanceof gn?BF(n,e,t,r):UF(n,e,t)}function MF(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=QC(r.transform,i||null);s!=null&&(t===null&&(t=gt.empty()),t.set(r.field,s))}return t||null}function s0(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!xF(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var si=class extends Io{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function PF(n,e,t){let r=n.value.clone(),i=tI(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function LF(n,e,t,r){if(!Zd(n.precondition,e))return t;let i=n.value.clone(),s=nI(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var gn=class extends Io{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function FF(n,e,t){if(!Zd(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=tI(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(eI(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function BF(n,e,t,r){if(!Zd(n.precondition,e))return t;let i=nI(n.fieldTransforms,r,e),s=e.data;return s.setAll(eI(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function eI(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function tI(n,e,t){let r=new Map;j(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,RF(o,a,t[i]))}return r}function nI(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,AF(s,o,e))}return r}var oi=class extends Io{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function qF(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function UF(n,e,t){return Zd(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var sl=class extends Io{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ol=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];OF(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ha(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Ha(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=WC();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=ZC(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument($.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Z())}isEqual(e){return this.batchId===e.batchId&&Bi(this.mutations,e.mutations,(t,r)=>s0(t,r))&&Bi(this.baseMutations,e.baseMutations,(t,r)=>s0(t,r))}},Xg=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){j(e.mutations.length===r.length);let i=bF(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var al=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Zg=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ot=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(ot||{});function rI(n){switch(n){case A.OK:return V();case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return V()}}function VF(n){return rI(n)&&n!==A.ABORTED}function Yu(n){if(n===void 0)return Oe("GRPC error has no .code"),A.UNKNOWN;switch(n){case ot.OK:return A.OK;case ot.CANCELLED:return A.CANCELLED;case ot.UNKNOWN:return A.UNKNOWN;case ot.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case ot.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case ot.INTERNAL:return A.INTERNAL;case ot.UNAVAILABLE:return A.UNAVAILABLE;case ot.UNAUTHENTICATED:return A.UNAUTHENTICATED;case ot.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case ot.NOT_FOUND:return A.NOT_FOUND;case ot.ALREADY_EXISTS:return A.ALREADY_EXISTS;case ot.PERMISSION_DENIED:return A.PERMISSION_DENIED;case ot.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case ot.ABORTED:return A.ABORTED;case ot.OUT_OF_RANGE:return A.OUT_OF_RANGE;case ot.UNIMPLEMENTED:return A.UNIMPLEMENTED;case ot.DATA_LOSS:return A.DATA_LOSS;default:return V()}}var ey=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var dg=null;function iI(){return new TL}function zF(){return new EL("utf-8")}var GF=new yr([4294967295,4294967295],0);function o0(n){let e=iI().encode(n),t=new Kh;return t.update(e),new Uint8Array(t.digest())}function a0(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new yr([t,r],0),a=new yr([i,s],0);return[o,a]}var ty=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Pi(`Invalid padding: ${t}`);if(r<0)throw new Pi(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Pi(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Pi(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=yr.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(yr.fromNumber(r)));return i.compare(GF)===1&&(i=new yr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=o0(e),[r,i]=a0(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=o0(e),[r,i]=a0(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Pi=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ll=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,cl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n($.min(),i,new Ae(X),xt(),Z())}},cl=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Z(),Z(),Z())}};var vo=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},ld=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},cd=class{constructor(e,t,r=Ke.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},ud=class{constructor(){this.pendingResponses=0,this.documentChanges=c0(),this._resumeToken=Ke.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Z(),t=Z(),r=Z();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:V()}}),new cl(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=c0()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,j(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},jF="WatchChangeAggregator",ny=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=xt(),this.pendingDocumentTargetMapping=l0(),this.pendingTargetResets=new Ae(X)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:V()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(od(s))if(r===0){let o=new q(s.path);this.removeDocumentFromTarget(t,o,Xe.newNoDocument(o,$.min()))}else j(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}dg?.notifyOnExistenceFilterMismatch(KF(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=ei(r).toUint8Array()}catch(l){if(l instanceof ey)return fn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new ty(o,i,s)}catch(l){return l instanceof Pi?fn("BloomFilter error: ",l):fn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&od(a.target)){let l=new q(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Xe.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=Z();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new ll(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=xt(),this.pendingDocumentTargetMapping=l0(),this.pendingTargetResets=new Ae(X),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new ud,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Te(X),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||O(jF,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new ud),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function l0(){return new Ae(q.comparator)}function c0(){return new Ae(q.comparator)}function KF(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(d.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=f?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:v=>{var b;return(b=r?.mightContain(v))!==null&&b!==void 0?b:!1}}),d}var WF=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),$F=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),HF=(()=>{let n={};return n.and="AND",n.or="OR",n})();var ry=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function QF(n){let e=n.code===void 0?A.UNKNOWN:Yu(n.code);return new k(e,n.message||"")}function iy(n,e){return n.useProto3Json||bl(e)?e:{value:e}}function YF(n){let e;return typeof n=="object"?e=n.value:e=n,bl(e)?null:e}function Ao(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function JF(n){let e=rr(n);return new Me(e.seconds,e.nanos)}function sI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function XF(n,e){return n.useProto3Json?(j(e===void 0||typeof e=="string"),Ke.fromBase64String(e||"")):(j(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Ke.fromUint8Array(e||new Uint8Array))}function ZF(n,e){return Ao(n,e.toTimestamp())}function Ge(n){return j(!!n),$.fromTimestamp(JF(n))}function qv(n,e){return sy(n,e).canonicalString()}function sy(n,e){let t=eB(n).child("documents");return e===void 0?t:t.child(e)}function oI(n){let e=le.fromString(n);return j(gI(e)),e}function ul(n,e){return qv(n.databaseId,e.path)}function Vn(n,e){let t=oI(e);if(t.get(1)!==n.databaseId.projectId)throw new k(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new k(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(cI(t))}function aI(n,e){return qv(n.databaseId,e)}function lI(n){let e=oI(n);return e.length===4?le.emptyPath():cI(e)}function oy(n){return new le(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function eB(n){return new le(["projects",n.projectId,"databases",n.database])}function cI(n){return j(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function u0(n,e,t){return{name:ul(n,e),fields:t.value.mapValue.fields}}function tB(n,e){return{name:ul(n,e.key),fields:e.data.value.mapValue.fields,updateTime:Ao(n,e.version.toTimestamp()),createTime:Ao(n,e.createTime.toTimestamp())}}function uI(n,e,t){let r=Vn(n,e.name),i=Ge(e.updateTime),s=e.createTime?Ge(e.createTime):$.min(),o=new gt({mapValue:{fields:e.fields}}),a=Xe.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function nB(n,e){j(!!e.found),e.found.name,e.found.updateTime;let t=Vn(n,e.found.name),r=Ge(e.found.updateTime),i=e.found.createTime?Ge(e.found.createTime):$.min(),s=new gt({mapValue:{fields:e.found.fields}});return Xe.newFoundDocument(t,r,i,s)}function rB(n,e){j(!!e.missing),j(!!e.readTime);let t=Vn(n,e.missing),r=Ge(e.readTime);return Xe.newNoDocument(t,r)}function iB(n,e){return"found"in e?nB(n,e):"missing"in e?rB(n,e):V()}function sB(n,e){let t;if("targetChange"in e){e.targetChange;let r=oB(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=XF(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&QF(o);t=new cd(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Vn(n,r.document.name),s=Ge(r.document.updateTime),o=r.document.createTime?Ge(r.document.createTime):$.min(),a=new gt({mapValue:{fields:r.document.fields}}),l=Xe.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new vo(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Vn(n,r.document),s=r.readTime?Ge(r.readTime):$.min(),o=Xe.newNoDocument(i,s),a=r.removedTargetIds||[];t=new vo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Vn(n,r.document),s=r.removedTargetIds||[];t=new vo([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Zg(i,s),a=r.targetId;t=new ld(a,o)}else return V();return t}function oB(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:V()}function aB(n){if(!("targetChange"in n))return $.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?$.min():Ge(e.readTime)}function dl(n,e){let t;if(e instanceof si)t={update:u0(n,e.key,e.value)};else if(e instanceof oi)t={delete:ul(n,e.key)};else if(e instanceof gn)t={update:u0(n,e.key,e.data),updateMask:UB(e.fieldMask)};else if(e instanceof sl)t={verify:ul(n,e.key)};else return V();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>hB(n,r))),e.precondition.isNone||(t.currentDocument=lB(n,e.precondition)),t}function ay(n,e){let t=e.currentDocument?cB(e.currentDocument):Be.none(),r=e.updateTransforms?e.updateTransforms.map(i=>fB(n,i)):[];if(e.update){e.update.name;let i=Vn(n,e.update.name),s=new gt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=VB(e.updateMask);return new gn(i,s,o,t,r)}else return new si(i,s,t,r)}else if(e.delete){let i=Vn(n,e.delete);return new oi(i,t)}else if(e.verify){let i=Vn(n,e.verify);return new sl(i,t)}else return V()}function lB(n,e){return e.updateTime!==void 0?{updateTime:ZF(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:V()}function cB(n){return n.updateTime!==void 0?Be.updateTime(Ge(n.updateTime)):n.exists!==void 0?Be.exists(n.exists):Be.none()}function uB(n,e){let t=n.updateTime?Ge(n.updateTime):Ge(e);return t.isEqual($.min())&&(t=Ge(e)),new Jg(t,n.transformResults||[])}function dB(n,e){return n&&n.length>0?(j(e!==void 0),n.map(t=>uB(t,e))):[]}function hB(n,e){let t=e.transform;if(t instanceof ri)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof ir)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof sr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof ii)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw V()}function fB(n,e){let t=null;if("setToServerValue"in e)j(e.setToServerValue==="REQUEST_TIME"),t=new ri;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new ir(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new sr(i)}else"increment"in e?t=new ii(n,e.increment):V();let r=je.fromServerFormat(e.fieldPath);return new ji(r,t)}function dI(n,e){return{documents:[aI(n,e.path)]}}function pB(n){let e=n.documents.length;j(e===1);let t=n.documents[0];return bt(Vo(lI(t)))}function hI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=aI(n,i);let s=SB(e.filters);s&&(t.structuredQuery.where=s);let o=EB(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=iy(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=_B(e.startAt)),e.endAt&&(t.structuredQuery.endAt=bB(e.endAt)),{queryTarget:t,parent:i}}function fI(n){let e=lI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){j(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=TB(t.where));let o=[];t.orderBy&&(o=wB(t.orderBy));let a=null;t.limit&&(a=YF(t.limit));let l=null;t.startAt&&(l=CB(t.startAt));let c=null;return t.endAt&&(c=IB(t.endAt)),UC(e,i,o,s,a,"F",l,c)}function mB(n){return bt(fI(n))}function gB(n,e){let t=yB(e.purpose);return t==null?null:{"goog-listen-tags":t}}function yB(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return V()}}function vB(n,e){let t,r=e.target;if(od(r)?t={documents:dI(n,r)}:t={query:hI(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=sI(n,e.resumeToken);let i=iy(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo($.min())>0){t.readTime=Ao(n,e.snapshotVersion.toTimestamp());let i=iy(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function SB(n){if(n.length!==0)return mI(ye.create(n,"and"))}function TB(n){let e=pI(n);return e instanceof ye&&Mv(e)?e.getFilters():[e]}function pI(n){return n.unaryFilter!==void 0?FB(n):n.fieldFilter!==void 0?BB(n):n.compositeFilter!==void 0?qB(n):V()}function EB(n){if(n.length!==0)return n.map(e=>OB(e))}function wB(n){return n.map(e=>MB(e))}function _B(n){return{before:n.inclusive,values:n.position}}function bB(n){return{before:!n.inclusive,values:n.position}}function CB(n){let e=!!n.before,t=n.values||[];return new Gn(t,e)}function IB(n){let e=!n.before,t=n.values||[];return new Gn(t,e)}function AB(n){return WF[n]}function RB(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function DB(n){return $F[n]}function kB(n){return HF[n]}function NB(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return V();default:return V()}}function xB(n){switch(n){case"AND":return"and";case"OR":return"or";default:return V()}}function ho(n){return{fieldPath:n.canonicalString()}}function mo(n){return je.fromServerFormat(n.fieldPath)}function OB(n){return{field:ho(n.field),direction:AB(n.dir)}}function MB(n){return new zi(mo(n.field),RB(n.direction))}function mI(n){return n instanceof re?LB(n):n instanceof ye?PB(n):V()}function PB(n){let e=n.getFilters().map(t=>mI(t));return e.length===1?e[0]:{compositeFilter:{op:kB(n.op),filters:e}}}function LB(n){if(n.op==="=="){if(Zb(n.value))return{unaryFilter:{field:ho(n.field),op:"IS_NAN"}};if(Xb(n.value))return{unaryFilter:{field:ho(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Zb(n.value))return{unaryFilter:{field:ho(n.field),op:"IS_NOT_NAN"}};if(Xb(n.value))return{unaryFilter:{field:ho(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ho(n.field),op:DB(n.op),value:n.value}}}function FB(n){switch(n.unaryFilter.op){case"IS_NAN":let e=mo(n.unaryFilter.field);return re.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=mo(n.unaryFilter.field);return re.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=mo(n.unaryFilter.field);return re.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=mo(n.unaryFilter.field);return re.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return V();default:return V()}}function BB(n){return re.create(mo(n.fieldFilter.field),NB(n.fieldFilter.op),n.fieldFilter.value)}function qB(n){return ye.create(n.compositeFilter.filters.map(e=>pI(e)),xB(n.compositeFilter.op))}function UB(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function VB(n){let e=n.fieldPaths||[];return new Vt(e.map(t=>je.fromServerFormat(t)))}function gI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ro=class n{constructor(e,t,r,i,s=$.min(),o=$.min(),a=Ke.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var dd=class{constructor(e){this.remoteSerializer=e}};function zB(n,e){let t;if(e.document)t=uI(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=q.fromSegments(e.noDocument.path),i=Wi(e.noDocument.readTime);t=Xe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=q.fromSegments(e.unknownDocument.path),i=Wi(e.unknownDocument.version);t=Xe.newUnknownDocument(r,i)}else return V();return e.readTime&&t.setReadTime(GB(e.readTime)),t}function d0(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:eh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=tB(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ki(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Ki(e.version)};else return V();return r}function eh(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function GB(n){let e=new Me(n[0],n[1]);return $.fromTimestamp(e)}function Ki(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Wi(n){let e=new Me(n.seconds,n.nanoseconds);return $.fromTimestamp(e)}function jB(n,e,t){let r=t.baseMutations.map(s=>dl(n.remoteSerializer,s)),i=t.mutations.map(s=>dl(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Ni(n,e){let t=(e.baseMutations||[]).map(s=>ay(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>ay(n.remoteSerializer,s)),i=Me.fromMillis(e.localWriteTimeMs);return new ol(e.batchId,i,t,r)}function ja(n){let e=Wi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Wi(n.lastLimboFreeSnapshotVersion):$.min(),r;return KB(n.query)?r=pB(n.query):r=mB(n.query),new Ro(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ke.fromBase64String(n.resumeToken))}function yI(n,e){let t=Ki(e.snapshotVersion),r=Ki(e.lastLimboFreeSnapshotVersion),i;od(e.target)?i=dI(n.remoteSerializer,e.target):i=hI(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Gi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function KB(n){return n.documents!==void 0}function WB(n){return{id:n.bundleId,createTime:Wi(n.createTime),version:n.version}}function $B(n){return{bundleId:n.id,createTime:Ki(Ge(n.createTime)),version:n.version}}function HB(n){return{name:n.name,query:Uv(n.bundledQuery),readTime:Wi(n.readTime)}}function QB(n){return{name:n.name,readTime:Ki(Ge(n.readTime)),bundledQuery:n.bundledQuery}}function Uv(n){let e=fI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ad(e,e.limit,"L"):e}function YB(n){return{name:n.name,query:Uv(n.bundledQuery),readTime:Ge(n.readTime)}}function JB(n){return{id:n.id,version:n.version,createTime:Ge(n.createTime)}}function hg(n,e){return new al(e.largestBatchId,ay(n.remoteSerializer,e.overlayMutation))}function XB(n,e,t){let[r,i,s]=vI(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:dl(n.remoteSerializer,t.mutation)}}function vI(n,e){let t=e.path.lastSegment(),r=_t(e.path.popLast());return[n,r,t]}function ZB(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function eq(n,e){let t=e?new Ja(e.sequenceNumber,new en(Wi(e.readTime),new q(qn(e.documentKey)),e.largestBatchId)):Ja.empty(),r=n.fields.map(([i,s])=>new go(je.fromServerFormat(i),s));return new Dg(n.indexId,n.collectionGroup,r,t)}function h0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ki(r.readTime),documentKey:_t(r.documentKey.path),largestBatchId:r.largestBatchId}}var ly=class{getBundleMetadata(e,t){return f0(e).get(t).next(r=>{if(r)return WB(r)})}saveBundleMetadata(e,t){return f0(e).put($B(t))}getNamedQuery(e,t){return p0(e).get(t).next(r=>{if(r)return HB(r)})}saveNamedQuery(e,t){return p0(e).put(QB(t))}};function f0(n){return tt(n,Kd)}function p0(n){return tt(n,Wd)}var hd=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return qa(e).get(vI(this.userId,t)).next(r=>r?hg(this.serializer,r):null)}getOverlays(e,t){let r=Un();return _.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new al(t,o);i.push(this.saveOverlay(e,a))}),_.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(_t(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(qa(e).deleteAll(Fg,a))}),_.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Un(),s=_t(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return qa(e).loadAll(Fg,o).next(a=>{for(let l of a){let c=hg(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Un(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return qa(e).iterate({index:gC,range:a},(l,c,u)=>{let d=hg(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return qa(e).put(XB(this.serializer,this.userId,t))}};function qa(n){return tt(n,Qd)}var cy=class{globalsStore(e){return tt(e,Rv)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?Ke.fromUint8Array(i):Ke.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var tq=5,nq=10,rq=13,fg=15,iq=20,sq=25,oq=30,aq=37,lq=45,cq=50,uq=53,dq=55,hq=60,fq=2,nr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,tq);else if("booleanValue"in e)this.writeValueTypeLabel(t,nq),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,fg),t.writeNumber(ke(e.integerValue));else if("doubleValue"in e){let r=ke(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,rq):(this.writeValueTypeLabel(t,fg),tl(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,iq),typeof r=="string"&&(r=rr(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,oq),t.writeBytes(ei(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,lq),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?DC(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):Jd(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):V()}writeIndexString(e,t){this.writeValueTypeLabel(t,sq),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,dq);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,uq);let o=Eo,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,fg),t.writeNumber(ke(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,cq);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,aq),q.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,hq),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(fq)}};nr.INSTANCE=new nr;var m0="\uD800",g0="\uDBFF",io=0,y0=255,v0=1,so=255,S0=255,T0=0,pq=64,mq=8,gq=1024;function yq(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function vq(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function Sq(n){let e=0;for(let t=0;t<8;++t){let r=vq(n[t]&255);if(e+=r,r!==8)break}return e}function E0(n){let e=pq-Sq(n);return Math.ceil(e/mq)}var uy=class{constructor(){this.buffer=new Uint8Array(gq),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<m0||g0<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<m0||g0<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=E0(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=E0(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(so),this.writeEscapedByteAscending(S0)}writeInfinityDescending(){this.writeEscapedByteDescending(so),this.writeEscapedByteDescending(S0)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=yq(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===io?(this.writeEscapedByteAscending(io),this.writeEscapedByteAscending(y0)):t===so?(this.writeEscapedByteAscending(so),this.writeEscapedByteAscending(T0)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===io?(this.writeEscapedByteDescending(io),this.writeEscapedByteDescending(y0)):t===so?(this.writeEscapedByteDescending(so),this.writeEscapedByteDescending(T0)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(io),this.writeEscapedByteAscending(v0)}writeSeparatorDescending(){this.writeEscapedByteDescending(io),this.writeEscapedByteDescending(v0)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},dy=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},hy=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},xi=class{constructor(){this.orderedCode=new uy,this.ascending=new dy(this.orderedCode),this.descending=new hy(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var Oi=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Kr(n,e){let t=n.indexId-e.indexId;return t!==0||(t=w0(n.arrayValue,e.arrayValue),t!==0)||(t=w0(n.directionalValue,e.directionalValue),t!==0)?t:q.comparator(n.documentKey,e.documentKey)}function w0(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var fd=class{constructor(e){this.inequalityFilters=new Te((t,r)=>je.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(j(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=_v(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=qi(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new Te(je.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new go(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new go(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new go(r.field,r.dir==="asc"?0:1)));return new Dg(Dg.UNKNOWN_ID,this.collectionId,t,Ja.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function SI(n){var e,t;if(j(n instanceof re||n instanceof ye),n instanceof re)if(n instanceof sd){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>re.create(n.field,"==",s)))||[];return ye.create(i,"or")}else return n;let r=n.filters.map(i=>SI(i));return ye.create(r,n.op)}function Tq(n){if(n.getFilters().length===0)return[];let e=fy(SI(n));return j(TI(e)),Vv(e)||zv(e)?[e]:e.getFilters()}function Vv(n){return n instanceof re}function zv(n){return n instanceof ye&&Mv(n)}function TI(n){return Vv(n)||zv(n)||Eq(n)}function Eq(n){if(n instanceof ye&&Vg(n)){for(let e of n.getFilters())if(!Vv(e)&&!zv(e))return!1;return!0}return!1}function fy(n){if(j(n instanceof re||n instanceof ye),n instanceof re)return n;if(n.filters.length===1)return fy(n.filters[0]);let e=n.filters.map(r=>fy(r)),t=ye.create(e,n.op);return t=pd(t),TI(t)?t:(j(t instanceof ye),j(_o(t)),j(t.filters.length>1),t.filters.reduce((r,i)=>Gv(r,i)))}function Gv(n,e){j(n instanceof re||n instanceof ye),j(e instanceof re||e instanceof ye);let t;return n instanceof re?e instanceof re?t=wq(n,e):t=_0(n,e):e instanceof re?t=_0(e,n):t=_q(n,e),pd(t)}function wq(n,e){return ye.create([n,e],"and")}function _q(n,e){if(j(n.filters.length>0&&e.filters.length>0),_o(n)&&_o(e))return PC(n,e.getFilters());let t=Vg(n)?n:e,r=Vg(n)?e:n,i=t.filters.map(s=>Gv(s,r));return ye.create(i,"or")}function _0(n,e){if(_o(e))return PC(e,n.getFilters());{let t=e.filters.map(r=>Gv(n,r));return ye.create(t,"or")}}function pd(n){if(j(n instanceof re||n instanceof ye),n instanceof re)return n;let e=n.getFilters();if(e.length===1)return pd(e[0]);if(OC(n))return n;let t=e.map(i=>pd(i)),r=[];return t.forEach(i=>{i instanceof re?r.push(i):i instanceof ye&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ye.create(r,n.op)}var py=class{constructor(){this.collectionParentIndex=new hl}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),_.resolve()}getCollectionParents(e,t){return _.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return _.resolve()}deleteFieldIndex(e,t){return _.resolve()}deleteAllFieldIndexes(e){return _.resolve()}createTargetIndexes(e,t){return _.resolve()}getDocumentsMatchingTarget(e,t){return _.resolve(null)}getIndexType(e,t){return _.resolve(0)}getFieldIndexes(e,t){return _.resolve([])}getNextCollectionGroupToUpdate(e){return _.resolve(null)}getMinOffset(e,t){return _.resolve(en.min())}getMinOffsetFromCollectionGroup(e,t){return _.resolve(en.min())}updateCollectionGroup(e,t,r){return _.resolve()}updateIndexEntries(e,t){return _.resolve()}},hl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Te(le.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Te(le.comparator)).toArray()}};var b0="IndexedDbIndexManager",zu=new Uint8Array(0),my=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new hl,this.targetToDnfSubTargets=new jn(r=>Gi(r),(r,i)=>Cl(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:_t(i)};return C0(e).put(s)}return _.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[nC(t),""],!1,!0);return C0(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(qn(o.parent))}return r})}addFieldIndex(e,t){let r=Ua(e),i=ZB(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=ao(e);return s.next(a=>{o.put(h0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Ua(e),i=ao(e),s=oo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ua(e),r=oo(e),i=ao(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return _.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new fd(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=oo(e),i=!0,s=new Map;return _.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Z(),a=[];return _.forEach(s,(l,c)=>{O(b0,`Using index ${NL(l)} to execute ${Gi(t)}`);let u=nF(c,l),d=rF(c,l),f=iF(c,l),v=sF(c,l),b=this.encodeBound(l,c,f),I=this.encodeBound(l,c,v),C=this.encodeValues(l,c,d),M=this.generateIndexRanges(l.indexId,u,b,f.inclusive,I,v.inclusive,C);return _.forEach(M,R=>r.loadFirst(R,t.limit).next(P=>{P.forEach(L=>{let z=q.fromSegments(L.documentKey);o.has(z)||(o=o.add(z),a.push(z))})}))}).next(()=>a)}else return _.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=Tq(ye.create(e.filters,"and")).map(i=>Yg(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let f=t?this.encodeSingleElement(t[d/c]):zu,v=this.generateLowerBound(e,f,r[d%c],i),b=this.generateUpperBound(e,f,s[d%c],o),I=a.map(C=>this.generateLowerBound(e,f,C,!0));u.push(...this.createRange(v,b,I))}return u}generateLowerBound(e,t,r,i){let s=new Oi(e,q.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new Oi(e,q.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new fd(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return _.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<oF(s)&&(r=1):r=0})).next(()=>aF(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new xi;for(let i of qi(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);nr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new xi;return nr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new xi;return nr.INSTANCE.writeIndexValue(Vi(this.databaseId,t),r.forKind(kL(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new xi);let s=0;for(let o of qi(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&rl(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);nr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new xi;l.seed(a.encodedBytes()),nr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof re&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Ua(e),i=ao(e);return(t?r.loadAll(Lg,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return _.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(eq(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:X(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Ua(e),s=ao(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(Lg,IDBKeyRange.bound(t,t)).next(a=>_.forEach(a,l=>s.put(h0(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return _.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?_.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),_.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?_.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return oo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return oo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=oo(e),s=new Te(Kr);return i.iterate({index:mC,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new Oi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new Te(Kr),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=_v(t);if(s!=null){let o=e.data.field(s.fieldPath);if(rl(o))for(let a of o.arrayValue.values||[])r=r.add(new Oi(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new Oi(t.indexId,e.key,zu,i));return r}updateEntries(e,t,r,i,s){O(b0,"Updating index entries for document '%s'",t.key);let o=[];return g2(i,s,Kr,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),_.waitFor(o)}getNextSequenceNumber(e){let t=1;return ao(e).iterate({index:pC,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Kr(o,a)).filter((o,a,l)=>!a||Kr(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Kr(o,e),l=Kr(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,zu,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,zu,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return Kr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(I0)}getMinOffset(e,t){return _.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||V())).next(I0)}};function C0(n){return tt(n,Xa)}function oo(n){return tt(n,Hd)}function Ua(n){return tt(n,Av)}function ao(n){return tt(n,$d)}function I0(n){j(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;bv(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new en(e.readTime,e.documentKey,t)}function EI(n,e,t){let r=n.store(hn),i=n.store(Bo),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,f)=>(a++,f.delete()));s.push(l.next(()=>{j(a===1)}));let c=[];for(let u of t.mutations){let d=dC(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return _.waitFor(s).next(()=>c)}function md(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw V();return JSON.stringify(e).length}var gd=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){j(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Wr(e).iterate({index:Mi,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=fo(e),o=Wr(e);return o.add({}).next(a=>{j(typeof a=="number");let l=new ol(a,t,r,i),c=jB(this.serializer,this.userId,l),u=[],d=new Te((f,v)=>X(f.canonicalString(),v.canonicalString()));for(let f of i){let v=dC(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),u.push(o.put(c)),u.push(s.put(v,qL))}return d.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),_.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return Wr(e).get(t).next(r=>r?(j(r.userId===this.userId),Ni(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?_.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Wr(e).iterate({index:Mi,range:i},(o,a,l)=>{a.userId===this.userId&&(j(a.batchId>=r),s=Ni(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Jr;return Wr(e).iterate({index:Mi,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Jr],[this.userId,Number.POSITIVE_INFINITY]);return Wr(e).loadAll(Mi,t).next(r=>r.map(i=>Ni(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Wu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return fo(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,f=qn(u);if(c!==this.userId||!t.path.isEqual(f)){l.done();return}return Wr(e).get(d).next(v=>{if(!v)throw V();j(v.userId===this.userId),s.push(Ni(this.serializer,v))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Te(X),i=[];return t.forEach(s=>{let o=Wu(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=fo(e).iterate({range:a},(c,u,d)=>{let[f,v,b]=c,I=qn(v);if(f!==this.userId||!s.path.isEqual(I)){d.done();return}r=r.add(b)});i.push(l)}),_.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Wu(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Te(X);return fo(e).iterate({range:o},(l,c,u)=>{let[d,f,v]=l,b=qn(f);if(d!==this.userId||!r.isPrefixOf(b)){u.done();return}b.length===i&&(a=a.add(v))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Wr(e).get(s).next(o=>{if(o===null)throw V();j(o.userId===this.userId),r.push(Ni(this.serializer,o))}))}),_.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return EI(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),_.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return _.resolve();let r=IDBKeyRange.lowerBound(BL(this.userId)),i=[];return fo(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=qn(s[1]);i.push(c)}}).next(()=>{j(i.length===0)})})}containsKey(e,t){return wI(e,this.userId,t)}getMutationQueueMetadata(e){return _I(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Jr,lastStreamToken:""})}};function wI(n,e,t){let r=Wu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return fo(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,f]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function bq(n,e){let t=!1;return _I(n).iterateSerial(r=>wI(n,r,e).next(i=>(i&&(t=!0),_.resolve(!i)))).next(()=>t)}function Wr(n){return tt(n,hn)}function fo(n){return tt(n,Bo)}function _I(n){return tt(n,wl)}var pg=2,Do=class n{constructor(e){this.lastId=e}next(){return this.lastId+=pg,this.lastId}static forTargetCache(){return new n(2-pg)}static forSyncEngine(){return new n(1-pg)}};var gy=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new Do(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>$.fromTimestamp(new Me(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>lo(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(j(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return lo(e).iterate((o,a)=>{let l=ja(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>_.waitFor(s)).next(()=>i)}forEachTarget(e,t){return lo(e).iterate((r,i)=>{let s=ja(i);t(s)})}retrieveMetadata(e){return A0(e).get(nd).next(t=>(j(t!==null),t))}saveMetadata(e,t){return A0(e).put(nd,t)}saveTargetData(e,t){return lo(e).put(yI(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Gi(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return lo(e).iterate({range:i,index:fC},(o,a,l)=>{let c=ja(a);Cl(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Hr(e);return t.forEach(o=>{let a=_t(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),_.waitFor(i)}removeMatchingKeys(e,t,r){let i=Hr(e);return _.forEach(t,s=>{let o=_t(s.path);return _.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Hr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Hr(e),s=Z();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=qn(o[1]),u=new q(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=_t(t.path),i=IDBKeyRange.bound([r],[nC(r)],!1,!0),s=0;return Hr(e).iterate({index:Iv,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return lo(e).get(t).next(r=>r?ja(r):null)}};function lo(n){return tt(n,qo)}function A0(n){return tt(n,Xi)}function Hr(n){return tt(n,Uo)}var R0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Rl=-1,bI=40*1024*1024,Zt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Zt.DEFAULT_COLLECTION_PERCENTILE=10;Zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Zt.DEFAULT=new Zt(bI,Zt.DEFAULT_COLLECTION_PERCENTILE,Zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Zt.DISABLED=new Zt(Rl,0,0);var D0="LruGarbageCollector",k0=1*1024*1024,Cq=1*60*1e3,Iq=5*60*1e3;function N0([n,e],[t,r]){let i=X(n,t);return i===0?X(e,r):i}var yy=class{constructor(e){this.maxElements=e,this.buffer=new Te(N0),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();N0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},vy=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Rl&&this.scheduleGC(Cq)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){O(D0,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>w(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ui(t)?O(D0,"Ignoring IndexedDB error during garbage collection: ",t):yield ci(t)}yield this.scheduleGC(Iq)}))}},Sy=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return _.resolve(Ut.INVALID);let r=new yy(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Rl?(O("LruGarbageCollector","Garbage collection skipped; disabled"),_.resolve(R0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),R0):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),co()<=En.DEBUG){let f=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;O("LruGarbageCollector",f)}return _.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function Aq(n,e){return new Sy(n,e)}var Ty=class{constructor(e,t){this.db=e,this.garbageCollector=Aq(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Gu(e,r)}removeReference(e,t,r){return Gu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Gu(e,t)}isPinned(e,t){return bq(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,$.min()),Hr(e).delete(Rq(l))))});s.push(u)}}).next(()=>_.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Gu(e,t)}forEachOrphanedDocument(e,t){let r=Hr(e),i=Ut.INVALID,s;return r.iterate({index:Iv},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Ut.INVALID&&t(new q(qn(s)),i),i=c,s=l):i=Ut.INVALID}).next(()=>{i!==Ut.INVALID&&t(new q(qn(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Rq(n){return[0,_t(n.path)]}function Dq(n,e){return{targetId:0,path:_t(n.path),sequenceNumber:e}}function Gu(n,e){return Hr(n).put(Dq(e,n.currentSequenceNumber))}var yd=class{constructor(){this.changes=new jn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?_.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ey=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ri(e).put(r)}removeEntry(e,t,r){return Ri(e).delete(kq(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=Xe.newInvalidDocument(t);return Ri(e).iterate({index:$u,range:IDBKeyRange.only(Va(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:Xe.newInvalidDocument(t)};return Ri(e).iterate({index:$u,range:IDBKeyRange.only(Va(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:md(s)}}).next(()=>r)}getEntries(e,t){let r=xt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=xt(),i=new Ae(q.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,md(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return _.resolve();let i=new Te(M0);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Va(i.first()),Va(i.last())),o=i.getIterator(),a=o.getNext();return Ri(e).iterate({index:$u,range:s},(l,c,u)=>{let d=q.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&M0(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(Va(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),eh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ri(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=xt();for(let d of c){let f=this.maybeDecodeDocument(q.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(Al(t,f)||i.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=xt(),o=O0(t,r),a=O0(t,en.max());return Ri(e).iterate({index:hC,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(q.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new wy(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return x0(e).get(Pg).next(t=>(j(!!t),t))}setMetadata(e,t){return x0(e).put(Pg,t)}maybeDecodeDocument(e,t){if(t){let r=zB(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual($.min())))return r}return Xe.newInvalidDocument(e)}};function CI(n){return new Ey(n)}var wy=class extends yd{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new jn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Te((s,o)=>X(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=d0(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=md(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=d0(this.documentCache.serializer,o.convertToNoDocument($.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),_.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function x0(n){return tt(n,_l)}function Ri(n){return tt(n,jd)}function Va(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function kq(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],eh(e),t[t.length-1]]}function O0(n,e){let t=e.documentKey.path.toArray();return[n,eh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function M0(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=X(t[s],r[s]),i)return i;return i=X(t.length,r.length),i||(i=X(t[t.length-2],r[r.length-2]),i)?i:X(t[t.length-1],r[r.length-1])}var Nq=17;var _y=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var vd=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ha(r.mutation,i,Vt.empty(),Me.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Z()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Z()){let i=Un();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ga();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Un();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Z()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=xt(),o=il(),a=wF();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof gn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Ha(u.mutation,c,u.mutation.getFieldMask(),Me.now())):o.set(c.key,Vt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new _y(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=il(),i=new Ae((o,a)=>o-a),s=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Vt.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||Z()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=WC();u.forEach(f=>{if(!s.has(f)){let v=ZC(t.get(f),r.get(f));v!==null&&d.set(f,v),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return _.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return dF(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Pv(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):_.resolve(Un()),a=So,l=s;return o.next(c=>_.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?_.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Z())).next(u=>({batchId:a,changes:KC(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let i=Ga();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ga();return this.indexManager.getCollectionParents(e,s).next(a=>_.forEach(a,l=>{let c=lF(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Xe.newInvalidDocument(u)))});let a=Ga();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Ha(u.mutation,c,Vt.empty(),Me.now()),Al(t,c)&&(a=a.insert(l,c))}),a})}};var by=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return _.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,JB(t)),_.resolve()}getNamedQuery(e,t){return _.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,YB(t)),_.resolve()}};var Cy=class{constructor(){this.overlays=new Ae(q.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return _.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Un();return _.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),_.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),_.resolve()}getOverlaysForCollection(e,t,r){let i=Un(),s=t.length+1,o=new q(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return _.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ae((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=Un(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let a=Un(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>a.set(d,f)),!(a.size()>=i)););return _.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new al(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Z(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Iy=class{constructor(){this.sessionToken=Ke.EMPTY_BYTE_STRING}getSessionToken(e){return _.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,_.resolve()}};var fl=class{constructor(){this.refsByKey=new Te(Ye.compareByKey),this.refsByTarget=new Te(Ye.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new Ye(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new Ye(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new q(new le([])),r=new Ye(t,e),i=new Ye(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new q(new le([])),r=new Ye(t,e),i=new Ye(t,e+1),s=Z();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ye(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ye=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return q.comparator(e.key,t.key)||X(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return X(e.targetOrBatchId,t.targetOrBatchId)||q.comparator(e.key,t.key)}};var Ay=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Te(Ye.compareByKey)}checkEmpty(e){return _.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ol(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Ye(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return _.resolve(o)}lookupMutationBatch(e,t){return _.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return _.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _.resolve(this.mutationQueue.length===0?Jr:this.nextBatchId-1)}getAllMutationBatches(e){return _.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ye(t,0),i=new Ye(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),_.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Te(X);return t.forEach(i=>{let s=new Ye(i,0),o=new Ye(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),_.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;q.isDocumentKey(s)||(s=s.child(""));let o=new Ye(new q(s),0),a=new Te(X);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),_.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");j(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return _.forEach(t.mutations,s=>{let o=new Ye(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new Ye(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return _.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,_.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function xq(){return new Ae(q.comparator)}var Ry=class{constructor(e){this.sizer=e,this.docs=xq(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return _.resolve(r?r.document.mutableCopy():Xe.newInvalidDocument(t))}getEntries(e,t){let r=xt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Xe.newInvalidDocument(i))}),_.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=xt(),o=t.path,a=new q(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||bv(iC(u),r)<=0||!i.has(u.key)&&!Al(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return _.resolve(s)}getAllFromCollectionGroup(e,t,r,i){V()}forEachDocumentKey(e,t){return _.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Dy(this)}getSize(e){return _.resolve(this.size)}};function Oq(n){return new Ry(n)}var Dy=class extends yd{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),_.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var ky=class{constructor(e){this.persistence=e,this.targets=new jn(t=>Gi(t),Cl),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new fl,this.targetCount=0,this.targetIdGenerator=Do.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),_.resolve()}getLastRemoteSnapshotVersion(e){return _.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),_.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Do(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,_.resolve()}updateTargetData(e,t){return this.saveTargetData(t),_.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,_.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),_.waitFor(s).next(()=>i)}getTargetCount(e){return _.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return _.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),_.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),_.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),_.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return _.resolve(r)}containsKey(e,t){return _.resolve(this.references.containsKey(t))}};var Mq="MemoryPersistence",Sd=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new Ut(0),this._started=!1,this._started=!0,this.globalsCache=new Iy,this.referenceDelegate=e(this),this.targetCache=new ky(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new py,this.remoteDocumentCache=Oq(r),this.serializer=new dd(t),this.bundleCache=new by(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Cy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Ay(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){O(Mq,"Starting transaction:",e);let i=new Ny(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return _.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Ny=class extends ed{constructor(e){super(),this.currentSequenceNumber=e}},Td=class n{constructor(e){this.persistence=e,this.localViewReferences=new fl,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw V()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),_.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),_.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),_.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _.forEach(this.orphanedDocuments,i=>{let s=q.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,$.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return _.or([()=>_.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var xy=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new td("createOrUpgrade",t);r<1&&i>=1&&(Lq(e),Fq(e),P0(e),qq(e));let o=_.resolve();return r<3&&i>=3&&(r!==0&&(zq(e),P0(e)),o=o.next(()=>jq(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>Bq(e,s))),o=o.next(()=>{Kq(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(Vq(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{Gq(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{Wq(e),$q(e)})),r<12&&i>=12&&(o=o.next(()=>{Qq(e)})),r<13&&i>=13&&(o=o.next(()=>Uq(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(ki))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>Hq(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore($d).clear()}).next(()=>{t.objectStore(Hd).clear()})),r<17&&i>=17&&(o=o.next(()=>{Yq(e)})),o}addDocumentGlobal(e){let t=0;return e.store(ki).iterate((r,i)=>{t+=md(i)}).next(()=>{let r={byteSize:t};return e.store(_l).put(Pg,r)})}removeAcknowledgedMutations(e){let t=e.store(wl),r=e.store(hn);return t.loadAll().next(i=>_.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Jr],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Mi,o).next(a=>_.forEach(a,l=>{j(l.userId===s.userId);let c=Ni(this.serializer,l);return EI(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(Uo),r=e.store(ki);return e.store(Xi).get(nd).next(s=>{let o=l=>t.put({targetId:0,path:_t(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new le(l),d=Pq(u);a.push(t.get(d).next(f=>f?_.resolve():o(u)))}).next(()=>_.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Xa,{keyPath:$L});let r=t.store(Xa),i=new hl,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:_t(l)})}};return t.store(ki).iterate({keysOnly:!0},(o,a)=>{let l=new le(o);return s(l.popLast())}).next(()=>t.store(Bo).iterate({keysOnly:!0},([o,a,l],c)=>{let u=qn(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(qo);return t.iterate((r,i)=>{let s=ja(i),o=yI(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(ki),i=[];return r.iterate((s,o)=>{let a=t.store(jd),l=Jq(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>_.waitFor(i))}runOverlayMigration(e,t){let r=t.store(hn),i=CI(this.serializer),s=new Sd(Td.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Z();Ni(this.serializer,l).keys().forEach(f=>u=u.add(f)),a.set(l.userId,u)}),_.forEach(a,(l,c)=>{let u=new Ze(c),d=hd.forUser(this.serializer,u),f=s.getIndexManager(u),v=gd.forUser(u,this.serializer,f,s.referenceDelegate);return new vd(i,v,d,f).recalculateAndSaveOverlaysForDocumentKeys(new Za(t,Ut.INVALID),l).next()})})}};function Pq(n){return[0,_t(n)]}function Lq(n){n.createObjectStore(El)}function Fq(n){n.createObjectStore(wl,{keyPath:FL}),n.createObjectStore(hn,{keyPath:cC,autoIncrement:!0}).createIndex(Mi,uC,{unique:!0}),n.createObjectStore(Bo)}function Bq(n,e){return e.store(hn).loadAll().next(r=>{n.deleteObjectStore(hn),n.createObjectStore(hn,{keyPath:cC,autoIncrement:!0}).createIndex(Mi,uC,{unique:!0});let s=e.store(hn),o=r.map(a=>s.put(a));return _.waitFor(o)})}function qq(n){n.createObjectStore(ki)}function Uq(n){let e=n.createObjectStore(jd,{keyPath:UL});e.createIndex($u,VL),e.createIndex(hC,zL)}function Vq(n){n.createObjectStore(_l)}function P0(n){n.createObjectStore(Uo,{keyPath:KL}).createIndex(Iv,WL,{unique:!0}),n.createObjectStore(qo,{keyPath:GL}).createIndex(fC,jL,{unique:!0}),n.createObjectStore(Xi)}function zq(n){n.deleteObjectStore(Uo),n.deleteObjectStore(qo),n.deleteObjectStore(Xi)}function Gq(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function jq(n){let e=n.store(Xi),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return e.put(nd,t)}function Kq(n){n.createObjectStore(To,{keyPath:HL})}function Wq(n){n.createObjectStore(Kd,{keyPath:QL})}function $q(n){n.createObjectStore(Wd,{keyPath:YL})}function Hq(n){n.createObjectStore(Av,{keyPath:JL,autoIncrement:!0}).createIndex(Lg,XL,{unique:!1}),n.createObjectStore($d,{keyPath:ZL}).createIndex(pC,e2,{unique:!1}),n.createObjectStore(Hd,{keyPath:t2}).createIndex(mC,n2,{unique:!1})}function Qq(n){let e=n.createObjectStore(Qd,{keyPath:r2});e.createIndex(Fg,i2,{unique:!1}),e.createIndex(gC,s2,{unique:!1})}function Yq(n){n.createObjectStore(Rv,{keyPath:o2})}function Jq(n){return n.document?new q(le.fromString(n.document.name).popFirst(5)):n.noDocument?q.fromSegments(n.noDocument.path):n.unknownDocument?q.fromSegments(n.unknownDocument.path):V()}var $r="IndexedDbPersistence",mg=30*60*1e3,gg=5e3,Xq=4e3,yg="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Zq="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",eU="firestore_zombie",II="main",Oy=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=Nq){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=f=>Promise.resolve(),!n.isAvailable())throw new k(A.UNIMPLEMENTED,Zq);this.referenceDelegate=new Ty(this,i),this.dbName=t+II,this.serializer=new dd(l),this.simpleDb=new Zr(this.dbName,this.schemaVersion,new xy(this.serializer)),this.globalsCache=new cy,this.targetCache=new gy(this.referenceDelegate,this.serializer),this.remoteDocumentCache=CI(this.serializer),this.bundleCache=new ly,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Oe($r,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(A.FAILED_PRECONDITION,yg);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new Ut(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>w(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>w(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>w(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ju(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(ui(e))return O($r,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O($r,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return za(e).get(no).next(r=>_.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return ju(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return w(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,mg)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=tt(t,To);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,mg),o=i.filter(a=>s.indexOf(a)===-1);return _.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",Xq,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?_.resolve(!0):za(e).get(no).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,gg)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new k(A.FAILED_PRECONDITION,yg);return!1}}return this.networkEnabled&&this.inForeground?!0:ju(e).loadAll().next(s=>this.filterActiveClients(s,gg).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&O($r,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return w(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[El,To],e=>{let t=new Za(e,Ut.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>ju(e).loadAll().next(t=>this.filterActiveClients(t,mg).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return gd.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new my(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return hd.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){O($r,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=m2(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Za(a,this.listenSequence?this.listenSequence.next():Ut.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Oe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new k(A.FAILED_PRECONDITION,sC);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return za(e).get(no).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,gg)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new k(A.FAILED_PRECONDITION,yg)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return za(e).put(no,t)}static isAvailable(){return Zr.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=za(e);return t.get(no).next(r=>this.isLocalClient(r)?(O($r,"Releasing primary lease."),t.delete(no)):_.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Oe(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Rh()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return O($r,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Oe($r,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Oe("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${eU}_${this.persistenceKey}_${e}`}};function za(n){return tt(n,El)}function ju(n){return tt(n,To)}function jv(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function tU(n){return w(this,null,function*(){if(!Zr.isAvailable())return Promise.resolve();let e=n+II;yield Zr.delete(e)})}function nU(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var Kv="LocalStore",rU=5*60*1e6,pl=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Ae(X),this.targetIdByTarget=new jn(s=>Gi(s),Cl),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new vd(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function AI(n,e,t,r){return new pl(n,e,t,r)}function RI(n,e){return w(this,null,function*(){let t=U(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Z();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function iU(n,e){let t=U(n),r=Me.now(),i=e.reduce((a,l)=>a.add(l.key),Z()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=xt(),c=Z();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,f)=>{f.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let f of e){let v=MF(f,s.get(f.key).overlayedDocument);v!=null&&d.push(new gn(f.key,v,NC(v.value.mapValue),Be.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:KC(s)}))}function sU(n,e){let t=U(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return mU(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,oU(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function oU(n){let e=Z();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function aU(n,e){let t=U(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(j(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function lU(n){let e=U(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function DI(n){let e=U(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function cU(n,e){let t=U(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?v=v.withResumeToken(Ke.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(d,v),uU(f,v,u)&&a.push(t.targetCache.updateTargetData(s,v))});let l=xt(),c=Z();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(kI(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual($.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return _.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function kI(n,e,t){let r=Z(),i=Z();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=xt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual($.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):O(Kv,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function uU(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=rU?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function dU(n,e){return w(this,null,function*(){let t=U(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>_.forEach(e,i=>_.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>_.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(ui(r))O(Kv,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function hU(n,e){let t=U(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Jr),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function fU(n,e){let t=U(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function ko(n,e){let t=U(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,_.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new Ro(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function pU(n,e,t){let r=U(n),i=r.targetIdByTarget.get(t);return i!==void 0?_.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function No(n,e,t){return w(this,null,function*(){let r=U(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(ui(o))O(Kv,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function th(n,e,t){let r=U(n),i=$.min(),s=Z();return r.persistence.runTransaction("Execute query","readwrite",o=>pU(r,o,bt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:$.min(),t?s:Z())).next(a=>(OI(r,zC(e),a),{documents:a,remoteKeys:s})))}function mU(n,e,t,r){let i=t.batch,s=i.keys(),o=_.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);j(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function gU(n,e){let t=U(n),r=U(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):_.resolve(null)))}function yU(n,e){U(U(n,pl).mutationQueue).removeCachedMutationKeys(e)}function vU(n){return U(U(n,pl).persistence).getActiveClients()}function NI(n,e){let t=U(n),r=U(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function xI(n,e){let t=U(n),r=t.collectionGroupReadTime.get(e)||$.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,rC(r,So),Number.MAX_SAFE_INTEGER)).then(i=>(OI(t,e,i),i))}function OI(n,e,t){let r=n.collectionGroupReadTime.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function SU(n){return bt(Vo(le.fromString(`__bundle__/docs/${n}`)))}function TU(n,e,t,r){return w(this,null,function*(){let i=U(n),s=Z(),o=xt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield ko(i,SU(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>kI(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function EU(n,e){let t=U(n),r=Ge(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function wU(n,e){let t=U(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function _U(n,e){let t=U(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function bU(r,i){return w(this,arguments,function*(n,e,t=Z()){let s=yield ko(n,bt(Uv(e.bundledQuery))),o=U(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Ge(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(Ke.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var My=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var CU=100;function IU(){return Rh()?8:oC(Xo())>0?6:4}var Ed=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=CU,this.relativeIndexReadCostPerDocument=IU()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new My;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(co()<=En.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",uo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),_.resolve()):(co()<=En.DEBUG&&O("QueryEngine","Query:",uo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(co()<=En.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",uo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bt(t))):_.resolve())}performQueryUsingIndex(e,t){if(r0(t))return _.resolve(null);let r=bt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ad(t,null,"F"),r=bt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Z(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,ad(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return r0(t)||i.isEqual($.min())?_.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?_.resolve(null):(co()<=En.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),uo(t)),this.appendRemainingResults(e,o,t,rC(i,So)).next(a=>a))})}applyQuery(e,t){let r=new Te(GC(e));return t.forEach((i,s)=>{Al(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return co()<=En.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",uo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,en.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var MI="firestore_clients";function L0(n,e){return`${MI}_${n}_${e}`}var PI="firestore_mutations";function F0(n,e,t){let r=`${PI}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var LI="firestore_targets";function vg(n,e){return`${LI}_${n}_${e}`}var AU="firestore_online_state";function RU(n){return`${AU}_${n}`}var DU="firestore_bundle_loaded_v2";function kU(n){return`${DU}_${n}`}var NU="firestore_sequence_number";function xU(n){return`${NU}_${n}`}var Bn="SharedClientState",wd=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new k(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Oe(Bn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Qa=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new k(r.error.code,r.error.message))),i?new n(e,r.state,s):(Oe(Bn,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},_d=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Fv();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=IC(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Oe(Bn,`Failed to parse client data for instance '${e}': ${t}`),null)}},Py=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Oe(Bn,`Failed to parse online state: ${e}`),null)}},ml=class{constructor(){this.activeTargetIds=Fv()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ya=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Ae(X),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=L0(this.persistenceKey,this.localClientId),this.sequenceNumberKey=xU(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new ml),this.clientStateKeyRe=new RegExp(`^${MI}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${PI}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${LI}_${o}_(\\d+)$`),this.onlineStateKey=RU(this.persistenceKey),this.bundleLoadedKey=kU(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return w(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(L0(this.persistenceKey,r));if(i){let s=_d.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(vg(this.persistenceKey,e));if(i){let s=Qa.fromWebStorageEntry(e,i);s&&(r=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vg(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return O(Bn,"READ",e,t),t}setItem(e,t){O(Bn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){O(Bn,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(O(Bn,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Oe("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>w(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=OU(t.newValue);r!==Ut.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new wd(this.currentUser,e,t,r),s=F0(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=F0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=vg(this.persistenceKey,e),s=new Qa(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return _d.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return wd.fromWebStorageEntry(new Ze(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Qa.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return Py.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return w(this,null,function*(){if(e.user.uid!==this.currentUser.uid){O(Bn,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=Fv();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function OU(n){let e=Ut.INVALID;if(n!=null)try{let t=JSON.parse(n);j(typeof t=="number"),e=t}catch(t){Oe(Bn,"Failed to read sequence number from WebStorage",t)}return e}var bd=class{constructor(){this.localState=new ml,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new ml,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Ly=class{addCallback(e){}shutdown(){}};var Fy=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Ku=null;function MU(){return 268435456+Math.round(2147483648*Math.random())}function Sg(){return Ku===null?Ku=MU():Ku++,"0x"+Ku.toString(16)}function PU(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var LU="1.9.1",wt="GrpcConnection",FU=`gl-node/${process.versions.node} fire/${Fo} grpc/${LU}`;function Tg(n,e,t,r){j(e===null||e.type==="OAuth");let i=new Fi.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",FU),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var By=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){O(wt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Fi.credentials.createSsl():Fi.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Sg(),a=this.ensureActiveStub(),l=Tg(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return PU(u=>(O(wt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,f)=>{d?(O(wt,`RPC '${e}' ${o} failed with error:`,d),u(new k(Yu(d.code),d.message))):(O(wt,`RPC '${e}' ${o} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Sg(),l=[],c=new Je;O(wt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=Tg(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),v=u[e](f,d),b=!1;return v.on("data",I=>{O(wt,`RPC ${e} ${a} received result:`,I),l.push(I),o!==void 0&&l.length===o&&(b=!0,c.resolve(l))}),v.on("end",()=>{O(wt,`RPC '${e}' ${a} completed.`),b||(b=!0,c.resolve(l))}),v.on("error",I=>{O(wt,`RPC '${e}' ${a} failed with error:`,I);let C=Yu(I.code);c.reject(new k(C,I.message))}),c.promise}openStream(e,t,r){let i=Sg(),s=this.ensureActiveStub(),o=Tg(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),a.end())},u=new Fy({sendFn:f=>{if(l)O(wt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{O(wt,`RPC '${e}' stream ${i} sending:`,f);try{a.write(f)}catch(v){throw Oe("Failure sending:",f),Oe("Error:",v),v}}},closeFn:()=>{O(wt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",f=>{l||(O(wt,`RPC '${e}' stream ${i} received:`,f),d||(u.callOnConnected(),d=!0),u.callOnMessage(f))}),a.on("end",()=>{O(wt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",f=>{if(!l){fn(wt,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let v=Yu(f.code);c(new k(v,f.message))}}),O(wt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},FI={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},BU={nested:FI},qU=Object.freeze({__proto__:null,nested:FI,default:BU});var UU={longs:String,enums:String,defaults:!0,oneofs:!1};function VU(){let n=Z0.fromJSON(qU,UU);return Fi.loadPackageDefinition(n)}function zU(n){let e=VU();return new By(e,n)}function GU(){return new Ly}function BI(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function jU(){return null}function Dl(n){return new ry(n,!1)}var KU="ExponentialBackoff",WU=1e3,$U=1.5,HU=60*1e3,gl=class{constructor(e,t,r=WU,i=$U,s=HU){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&O(KU,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var B0="PersistentStream",QU=60*1e3,YU=10*1e3,Cd=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new gl(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return w(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,QU,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return w(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return w(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===A.RESOURCE_EXHAUSTED?(Oe(t.toString()),Oe("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===A.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new k(A.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,YU,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>w(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return O(B0,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(O(B0,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},qy=class extends Cd{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=sB(this.serializer,e),r=aB(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=oy(this.serializer),t.addTarget=vB(this.serializer,e);let r=gB(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=oy(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Uy=class extends Cd{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return j(!!e.streamToken),this.lastStreamToken=e.streamToken,j(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){j(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=dB(e.writeResults,e.commitTime),r=Ge(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=oy(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>dl(this.serializer,r))};this.sendRequest(t)}};var Vy=class{},zy=class extends Vy{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new k(A.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,sy(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(A.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,sy(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(A.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function JU(n,e,t,r){return new zy(n,e,t,r)}function XU(n,e){return w(this,null,function*(){let t=U(n),r={writes:e.map(i=>dl(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,le.emptyPath(),r)})}function ZU(n,e){return w(this,null,function*(){let t=U(n),r={documents:e.map(a=>ul(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,le.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=iB(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());j(!!l),o.push(l)}),o})}function eV(n,e,t){let r=U(n);return r.verifyInitialized(),new Uy(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function tV(n,e,t){let r=U(n);return r.verifyInitialized(),new qy(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var nV="OnlineStateTracker",q0=1,U0=10*1e3,Gy=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",U0,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${U0/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=q0&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${q0} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Oe(t),this.shouldWarnClientIsOffline=!1):O(nV,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var $i="RemoteStore",rV=10,jy=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>w(this,null,function*(){di(this)&&(O($i,"Restarting streams for network reachability change."),yield EV(this))}))}),this.onlineStateTracker=new Gy(r,i)}};function iV(n,e,t,r,i){return new jy(n,e,t,r,i)}function sV(n){let e=U(n);return e.offlineCauses.delete(0),kl(e)}function kl(n){return w(this,null,function*(){if(di(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function oV(n){return w(this,null,function*(){let e=U(n);e.offlineCauses.add(0),yield zo(e),e.onlineStateTracker.set("Offline")})}function zo(n){return w(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function aV(n){return w(this,null,function*(){let e=U(n);O($i,"RemoteStore shutting down."),e.offlineCauses.add(5),yield zo(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function nh(n,e){let t=U(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Hv(t)?$v(t):Ko(t).isOpen()&&Wv(t,e))}function Go(n,e){let t=U(n),r=Ko(t);t.listenTargets.delete(e),r.isOpen()&&qI(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():di(t)&&t.onlineStateTracker.set("Unknown"))}function Wv(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ko(n).watch(e)}function qI(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Ko(n).unwatch(e)}function $v(n){n.watchChangeAggregator=new ny({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Ko(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Hv(n){return di(n)&&!Ko(n).isStarted()&&n.listenTargets.size>0}function di(n){return U(n).offlineCauses.size===0}function UI(n){n.watchChangeAggregator=void 0}function lV(n){return w(this,null,function*(){n.onlineStateTracker.set("Online")})}function cV(n){return w(this,null,function*(){n.listenTargets.forEach((e,t)=>{Wv(n,e)})})}function uV(n,e){return w(this,null,function*(){UI(n),Hv(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),$v(n)):n.onlineStateTracker.set("Unknown")})}function dV(n,e,t){return w(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof cd&&e.state===2&&e.cause){try{yield fV(n,e)}catch(r){O($i,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Id(n,r)}return}if(e instanceof vo?n.watchChangeAggregator.handleDocumentChange(e):e instanceof ld?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual($.min()))try{let r=yield DI(n.localStore);t.compareTo(r)>=0&&(yield hV(n,t))}catch(r){O($i,"Failed to raise snapshot:",r),yield Id(n,r)}})}function Id(n,e,t){return w(this,null,function*(){if(ui(e))n.offlineCauses.add(1),yield zo(n),n.onlineStateTracker.set("Offline"),t||(t=()=>DI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>w(this,null,function*(){O($i,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield kl(n)}));else throw e})}function VI(n,e){return e().catch(t=>Id(n,t,e))}function hV(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Ke.EMPTY_BYTE_STRING,s.snapshotVersion)),qI(n,r);let o=new Ro(s.target,r,i,s.sequenceNumber);Wv(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function fV(n,e){return w(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function jo(n){return w(this,null,function*(){let e=U(n),t=hi(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Jr;for(;pV(e);)try{let i=yield hU(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,mV(e,i)}catch(i){yield Id(e,i)}zI(e)&&GI(e)})}function pV(n){return di(n)&&n.writePipeline.length<rV}function mV(n,e){n.writePipeline.push(e);let t=hi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function zI(n){return di(n)&&!hi(n).isStarted()&&n.writePipeline.length>0}function GI(n){hi(n).start()}function gV(n){return w(this,null,function*(){hi(n).writeHandshake()})}function yV(n){return w(this,null,function*(){let e=hi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function vV(n,e,t){return w(this,null,function*(){let r=n.writePipeline.shift(),i=Xg.from(r,e,t);yield VI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield jo(n)})}function SV(n,e){return w(this,null,function*(){e&&hi(n).handshakeComplete&&(yield TV(n,e)),zI(n)&&GI(n)})}function TV(n,e){return w(this,null,function*(){if(VF(e.code)){let t=n.writePipeline.shift();hi(n).inhibitBackoff(),yield VI(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield jo(n)}})}function EV(n){return w(this,null,function*(){let e=U(n);e.offlineCauses.add(4),yield zo(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield kl(e)})}function V0(n,e){return w(this,null,function*(){let t=U(n);t.asyncQueue.verifyOperationInProgress(),O($i,"RemoteStore received new credentials");let r=di(t);t.offlineCauses.add(3),yield zo(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield kl(t)})}function Ky(n,e){return w(this,null,function*(){let t=U(n);e?(t.offlineCauses.delete(2),yield kl(t)):e||(t.offlineCauses.add(2),yield zo(t),t.onlineStateTracker.set("Unknown"))})}function Ko(n){return n.watchStream||(n.watchStream=tV(n.datastore,n.asyncQueue,{onConnected:lV.bind(null,n),onOpen:cV.bind(null,n),onClose:uV.bind(null,n),onWatchChange:dV.bind(null,n)}),n.onNetworkStatusChange.push(e=>w(this,null,function*(){e?(n.watchStream.inhibitBackoff(),Hv(n)?$v(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),UI(n))}))),n.watchStream}function hi(n){return n.writeStream||(n.writeStream=eV(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:gV.bind(null,n),onClose:SV.bind(null,n),onHandshakeComplete:yV.bind(null,n),onMutationResult:vV.bind(null,n)}),n.onNetworkStatusChange.push(e=>w(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield jo(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(O($i,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var wV="AsyncQueue",Wy=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(A.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Wo(n,e){if(Oe(wV,`${e}: ${n}`),ui(n))return new k(A.UNAVAILABLE,`${e}: ${n}`);throw n}var Ad=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||q.comparator(t.key,r.key):this.comparator=(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Ga(),this.sortedSet=new Ae(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Rd=class{constructor(){this.changeMap=new Ae(q.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):V()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},xo=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Ad.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Il(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var $y=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function _V(){return new Hy}var Hy=class{constructor(){this.queries=jI(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){DV(this,new k(A.ABORTED,"Firestore shutting down"))}};function jI(){return new jn(n=>VC(n),Il)}function Qv(n,e){return w(this,null,function*(){let t=U(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new $y,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=Wo(o,`Initialization of query '${uo(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&Jv(t)})}function Yv(n,e){return w(this,null,function*(){let t=U(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function bV(n,e){let t=U(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&Jv(t)}function CV(n,e,t){let r=U(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function IV(n,e){let t=U(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&Jv(t)}function AV(n,e){U(n).snapshotsInSyncListeners.add(e),e.next()}function RV(n,e){U(n).snapshotsInSyncListeners.delete(e)}function DV(n,e){let t=U(n),r=t.queries;t.queries=jI(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function Jv(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var KI=function(n){return n.Default="default",n.Cache="cache",n}(KI||{}),yl=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new xo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=xo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==KI.Cache}};var Qy=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Z(),i=Z();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Dd=class{constructor(e){this.serializer=e}toDocumentKey(e){return Vn(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?uI(this.serializer,e.document,!1):Xe.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Ge(e)}},Yy=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=WI(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=le.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Dd(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||Z()).add(s);t.set(o,a)}}return t}complete(){return w(this,null,function*(){let e=yield TU(this.localStore,new Dd(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield bU(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function WI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function kV(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var kd=class{constructor(e){this.key=e}},Nd=class{constructor(e){this.key=e}},xd=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Z(),this.mutatedKeys=Z(),this.docComparator=GC(e),this.documentSet=new Ad(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Rd,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),v=Al(this.query,d)?d:null,b=f?this.mutatedKeys.has(f.key):!1,I=v?v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations:!1,C=!1;f&&v?f.data.isEqual(v.data)?b!==I&&(r.track({type:3,doc:v}),C=!0):this.shouldWaitForSyncedDocument(f,v)||(r.track({type:2,doc:v}),C=!0,(l&&this.docComparator(v,l)>0||c&&this.docComparator(v,c)<0)&&(a=!0)):!f&&v?(r.track({type:0,doc:v}),C=!0):f&&!v&&(r.track({type:1,doc:f}),C=!0,(l||c)&&(a=!0)),C&&(v?(o=o.add(v),I?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,f)=>NV(d.type,f.type)||this.docComparator(d.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new xo(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Rd,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Z(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Nd(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new kd(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Z();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return xo.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function NV(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return V()}};return t(n)-t(e)}var fi="SyncEngine",Jy=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Xy=class{constructor(e){this.key=e,this.receivedDocument=!1}},Zy=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new jn(a=>VC(a),Il),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Ae(q.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new fl,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Do.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function xV(n,e,t,r,i,s,o){let a=new Zy(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function OV(n,e,t=!0){return w(this,null,function*(){let r=rh(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield $I(r,e,t,!0),i})}function MV(n,e){return w(this,null,function*(){let t=rh(n);yield $I(t,e,!0,!1)})}function $I(n,e,t,r){return w(this,null,function*(){let i=yield ko(n.localStore,bt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield Xv(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&nh(n.remoteStore,i),a})}function Xv(n,e,t,r,i){return w(this,null,function*(){n.applyDocChanges=(d,f,v)=>KV(n,d,f,v);let s=yield th(n.localStore,e,!0),o=new xd(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=cl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);tS(n,t,c.limboChanges);let u=new Jy(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function PV(n,e,t){return w(this,null,function*(){let r=U(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Il(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield No(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Go(r.remoteStore,i.targetId),Oo(r,i.targetId)}).catch(ci))):(Oo(r,i.targetId),yield No(r.localStore,i.targetId,!0))})}function LV(n,e){return w(this,null,function*(){let t=U(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Go(t.remoteStore,r.targetId))})}function FV(n,e,t){return w(this,null,function*(){let r=rS(n);try{let i=yield iU(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),GV(r,i.batchId,t),yield cr(r,i.changes),yield jo(r.remoteStore)}catch(i){let s=Wo(i,"Failed to persist write");t.reject(s)}})}function HI(n,e){return w(this,null,function*(){let t=U(n);try{let r=yield cU(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(j(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?j(o.receivedDocument):i.removedDocuments.size>0&&(j(o.receivedDocument),o.receivedDocument=!1))}),yield cr(t,r,e)}catch(r){yield ci(r)}})}function z0(n,e,t){let r=U(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),IV(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function BV(n,e,t){return w(this,null,function*(){let r=U(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Ae(q.comparator);o=o.insert(s,Xe.newNoDocument(s,$.min()));let a=Z().add(s),l=new ll($.min(),new Map,new Ae(X),o,a);yield HI(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),nS(r)}else yield No(r.localStore,e,!1).then(()=>Oo(r,e,t)).catch(ci)})}function qV(n,e){return w(this,null,function*(){let t=U(n),r=e.batch.batchId;try{let i=yield sU(t.localStore,e);eS(t,r,null),Zv(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield cr(t,i)}catch(i){yield ci(i)}})}function UV(n,e,t){return w(this,null,function*(){let r=U(n);try{let i=yield aU(r.localStore,e);eS(r,e,t),Zv(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield cr(r,i)}catch(i){yield ci(i)}})}function VV(n,e){return w(this,null,function*(){let t=U(n);di(t.remoteStore)||O(fi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield lU(t.localStore);if(r===Jr){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=Wo(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Zv(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function zV(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new k(A.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function GV(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Ae(X)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function eS(n,e,t){let r=U(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Oo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||QI(n,i)})}function QI(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Go(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),nS(n))}function tS(n,e,t){for(let r of t)r instanceof kd?(n.limboDocumentRefs.addReference(r.key,e),jV(n,r)):r instanceof Nd?(O(fi,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||QI(n,r.key)):V()}function jV(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(O(fi,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),nS(n))}function nS(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new q(le.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new Xy(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),nh(n.remoteStore,new Ro(bt(Vo(t.path)),r,"TargetPurposeLimboResolution",Ut.INVALID))}}function cr(n,e,t){return w(this,null,function*(){let r=U(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){i.push(c);let d=Qy.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield dU(r.localStore,s))})}function KV(n,e,t,r){return w(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield th(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return tS(n,e.targetId,a.limboChanges),a.snapshot})}function WV(n,e){return w(this,null,function*(){let t=U(n);if(!t.currentUser.isEqual(e)){O(fi,"User change. New user:",e.toKey());let i=yield RI(t.localStore,e);t.currentUser=e,zV(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield cr(t,i.affectedDocuments)}})}function $V(n,e){let t=U(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return Z().add(r.key);{let i=Z(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function HV(n,e){return w(this,null,function*(){let t=U(n),r=yield th(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&tS(t,e.targetId,i.limboChanges),i})}function QV(n,e){return w(this,null,function*(){let t=U(n);return xI(t.localStore,e).then(r=>cr(t,r))})}function YV(n,e,t,r){return w(this,null,function*(){let i=U(n),s=yield gU(i.localStore,e);if(s===null){O(fi,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield jo(i.remoteStore):t==="acknowledged"||t==="rejected"?(eS(i,e,r||null),Zv(i,e),yU(i.localStore,e)):V(),yield cr(i,s)})}function JV(n,e){return w(this,null,function*(){let t=U(n);if(rh(t),rS(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield G0(t,r.toArray());t._isPrimaryClient=!0,yield Ky(t.remoteStore,!0);for(let s of i)nh(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Oo(t,o),No(t.localStore,o,!0))),Go(t.remoteStore,o)}),yield i,yield G0(t,r),XV(t),t._isPrimaryClient=!1,yield Ky(t.remoteStore,!1)}})}function XV(n){let e=U(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{Go(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Ae(q.comparator)}function G0(n,e,t){return w(this,null,function*(){let r=U(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield ko(r.localStore,bt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield HV(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield NI(r.localStore,o);a=yield ko(r.localStore,c),yield Xv(r,YI(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function YI(n){return UC(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function ZV(n){let e=U(n);return vU(e.localStore)}function e4(n,e,t,r){return w(this,null,function*(){let i=U(n);if(i._isPrimaryClient){O(fi,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield xI(i.localStore,zC(s[0])),a=ll.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ke.EMPTY_BYTE_STRING);yield cr(i,o,a);break}case"rejected":{yield No(i.localStore,e,!0),Oo(i,e,r);break}default:V()}})}function t4(n,e,t){return w(this,null,function*(){let r=rh(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){O(fi,"Adding an already active target "+i);continue}let o=yield NI(r.localStore,i),a=yield ko(r.localStore,o);yield Xv(r,YI(o),a.targetId,!1,a.resumeToken),nh(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield No(r.localStore,i,!1).then(()=>{Go(r.remoteStore,i),Oo(r,i)}).catch(ci))}})}function rh(n){let e=U(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=HI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=$V.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=BV.bind(null,e),e.syncEngineListener.onWatchChange=bV.bind(null,e.eventManager),e.syncEngineListener.onWatchError=CV.bind(null,e.eventManager),e}function rS(n){let e=U(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qV.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=UV.bind(null,e),e}function n4(n,e,t){let r=U(n);r4(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function r4(n,e,t){return w(this,null,function*(){try{let r=yield e.getMetadata();if(yield EU(n.localStore,r))return yield e.close(),t._completeWith(kV(r)),Promise.resolve(new Set);t._updateProgress(WI(r));let s=new Yy(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield cr(n,a.changedDocs,void 0),yield wU(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return fn(fi,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var ev=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return w(this,null,function*(){this.serializer=Dl(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return AI(this.persistence,new Ed,t.initialUser,this.serializer)}createPersistence(t){return new Sd(Td.factory,this.serializer)}createSharedClientState(t){return new bd}terminate(){return w(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Od=class n extends ev{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return w(this,null,function*(){yield Eh(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield rS(this.onlineComponentProvider.syncEngine),yield jo(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return AI(this.persistence,new Ed,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new vy(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Og(t,this.persistence);return new xg(e.asyncQueue,r)}createPersistence(e){let t=jv(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Zt.withCacheSize(this.cacheSizeBytes):Zt.DEFAULT;return new Oy(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,BI(),jU(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new bd}},tv=class n extends Od{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return w(this,null,function*(){yield Eh(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Ya&&(this.sharedClientState.syncEngine={applyBatchState:YV.bind(null,t),applyTargetState:e4.bind(null,t),applyActiveTargetsChange:t4.bind(null,t),getActiveClients:ZV.bind(null,t),synchronizeWithChangedDocuments:QV.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>w(this,null,function*(){yield JV(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=BI();if(!Ya.isAvailable(t))throw new k(A.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=jv(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ya(t,e.asyncQueue,r,e.clientId,e.initialUser)}},iS=(()=>{class n{initialize(t,r){return w(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>z0(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=WV.bind(null,this.syncEngine),yield Ky(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return _V()}createDatastore(t){let r=Dl(t.databaseInfo.databaseId),i=zU(t.databaseInfo);return JU(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return iV(this.localStore,this.datastore,t.asyncQueue,r=>z0(this.syncEngine,r,0),GU())}createSyncEngine(t,r){return xV(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return w(this,null,function*(){var t,r;yield aV(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})(),i4=10240;function s4(n,e=i4){let t=0;return{read(){return w(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return w(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function sS(n,e,t){if(!t)throw new k(A.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function oS(n,e,t,r){if(e===!0&&r===!0)throw new k(A.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function j0(n){if(!q.isDocumentKey(n))throw new k(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function K0(n){if(q.isDocumentKey(n))throw new k(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function o4(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Nl(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=a4(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":V()}function a4(n){return n.constructor?n.constructor.name:null}function ue(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new k(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Nl(n);throw new k(A.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function JI(n,e){if(e<=0)throw new k(A.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function l4(n,e){if(!(n instanceof Uint8Array))throw new k(A.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${Nl(n)}`);return s4(n,e)}var Mo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):Oe("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var nv=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var rv=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new Je,this.buffer=new Uint8Array,this.textDecoder=zF(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return w(this,null,function*(){return this.metadata.promise})}nextElement(){return w(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return w(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new nv(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return w(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return w(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return w(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function c4(n,e){return new rv(n,e)}var iv=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return w(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new k(A.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield ZU(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new oi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return w(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=q.fromPath(r);this.mutations.push(new sl(i,this.precondition(i)))}),yield XU(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=$.min();else throw V();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new k(A.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($.min())?Be.exists(!1):Be.updateTime(t):Be.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($.min()))throw new k(A.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Be.updateTime(t)}else return Be.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var sv=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new gl(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>w(this,null,function*(){let e=new iv(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return bl(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!rI(t)}return!1}};var ai="FirestoreClient",u4=100,d4=11,h4=20,f4=22,ov=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ze.UNAUTHENTICATED,this.clientId=Xu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>w(this,null,function*(){O(ai,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(O(ai,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:u4}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>w(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Wo(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Eg(n,e){return w(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O(ai,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>w(this,null,function*(){r.isEqual(i)||(yield RI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function W0(n,e){return w(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield aS(n);O(ai,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>V0(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>V0(e.remoteStore,i)),n._onlineComponents=e})}function p4(n){return n.name==="FirebaseError"?n.code===A.FAILED_PRECONDITION||n.code===A.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===f4||n.code===h4||n.code===d4:!0}function aS(n){return w(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(ai,"Using user provided OfflineComponentProvider");try{yield Eg(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!p4(t))throw t;fn("Error using user provided cache. Falling back to memory cache: "+t),yield Eg(n,new ev)}}else O(ai,"Using default OfflineComponentProvider"),yield Eg(n,new ev);return n._offlineComponents})}function ih(n){return w(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(ai,"Using user provided OnlineComponentProvider"),yield W0(n,n._uninitializedComponentsProvider._online)):(O(ai,"Using default OnlineComponentProvider"),yield W0(n,new iS))),n._onlineComponents})}function XI(n){return aS(n).then(e=>e.persistence)}function lS(n){return aS(n).then(e=>e.localStore)}function ZI(n){return ih(n).then(e=>e.remoteStore)}function cS(n){return ih(n).then(e=>e.syncEngine)}function m4(n){return ih(n).then(e=>e.datastore)}function Po(n){return w(this,null,function*(){let e=yield ih(n),t=e.eventManager;return t.onListen=OV.bind(null,e.syncEngine),t.onUnlisten=PV.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=MV.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=LV.bind(null,e.syncEngine),t})}function g4(n){return n.asyncQueue.enqueue(()=>w(this,null,function*(){let e=yield XI(n),t=yield ZI(n);return e.setNetworkEnabled(!0),sV(t)}))}function y4(n){return n.asyncQueue.enqueue(()=>w(this,null,function*(){let e=yield XI(n),t=yield ZI(n);return e.setNetworkEnabled(!1),oV(t)}))}function v4(n){let e=new Je;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let t=yield cS(n);return VV(t,e)})),e.promise}function S4(n,e,t,r){let i=new Mo(r),s=new yl(e,i,t);return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let o=yield Po(n);return Qv(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let o=yield Po(n);return Yv(o,s)}))}}function T4(n,e){let t=new Je;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let r=yield lS(n);return C4(r,e,t)})),t.promise}function eA(n,e,t={}){let r=new Je;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let i=yield Po(n);return I4(i,n.asyncQueue,e,t,r)})),r.promise}function E4(n,e){let t=new Je;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let r=yield lS(n);return A4(r,e,t)})),t.promise}function tA(n,e,t={}){let r=new Je;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let i=yield Po(n);return R4(i,n.asyncQueue,e,t,r)})),r.promise}function w4(n,e){let t=new Je;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let r=yield cS(n);return FV(r,e,t)})),t.promise}function _4(n,e){let t=new Mo(e);return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let r=yield Po(n);return AV(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let r=yield Po(n);return RV(r,t)}))}}function b4(n,e,t){let r=new Je;return n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){let i=yield m4(n);new sv(n.asyncQueue,i,t,e,r).run()})),r.promise}function C4(n,e,t){return w(this,null,function*(){try{let r=yield fU(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new k(A.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=Wo(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function I4(n,e,t,r,i){let s=new Mo({next:a=>{s.mute(),e.enqueueAndForget(()=>Yv(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new k(A.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new k(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new yl(Vo(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Qv(n,o)}function A4(n,e,t){return w(this,null,function*(){try{let r=yield th(n,e,!0),i=new xd(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=Wo(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function R4(n,e,t,r,i){let s=new Mo({next:a=>{s.mute(),e.enqueueAndForget(()=>Yv(n,o)),a.fromCache&&r.source==="server"?i.reject(new k(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new yl(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Qv(n,o)}function D4(n,e,t,r){let i=N4(t,Dl(e));n.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){n4(yield cS(n),i,r)}))}function k4(n,e){return n.asyncQueue.enqueue(()=>w(this,null,function*(){return _U(yield lS(n),e)}))}function N4(n,e){let t;return typeof n=="string"?t=iI().encode(n):t=n,c4(l4(t),e)}function x4(n,e){return n.timeoutSeconds===e.timeoutSeconds}function nA(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var O4="ComponentProvider",$0=new Map;function M4(n){let e=$0.get(n);e&&(O(O4,"Removing Datastore"),$0.delete(n),e.terminate())}function P4(n,e,t,r){return new qg(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,nA(r.experimentalLongPollingOptions),r.useFetchStreams)}var rA="firestore.googleapis.com",H0=!0,Q0=5,Y0=30,L4=!0,Md=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new k(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rA,this.ssl=H0}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:H0;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=bI;else{if(e.cacheSizeBytes!==Rl&&e.cacheSizeBytes<k0)throw new k(A.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${k0}`);this.cacheSizeBytes=e.cacheSizeBytes}oS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=L4:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nA((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),F4(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&x4(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function F4(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new k(A.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<Q0)throw new k(A.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${Q0})`);if(n.timeoutSeconds>Y0)throw new k(A.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${Y0})`)}}var Hi=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Md({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new k(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Md(e),e.credentials!==void 0&&(this._authCredentials=IL(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return w(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return M4(this),Promise.resolve()}};function iA(n,e,t,r={}){var i;n=ue(n,Hi);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==rA&&s.host!==o&&fn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Ze.MOCK_USER;else{a=$S(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new k(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Ze(c)}n._authCredentials=new _g(new Ju(a,l))}}var lt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ce=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},zn=class n extends lt{constructor(e,t,r){super(e,t,Vo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ce(this.firestore,null,new q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function uS(n,e,...t){if(n=xe(n),sS("collection","path",e),n instanceof Hi){let r=le.fromString(e,...t);return K0(r),new zn(n,null,r)}else{if(!(n instanceof Ce)&&!(n instanceof zn))throw new k(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(le.fromString(e,...t));return K0(r),new zn(n.firestore,null,r)}}function sA(n,e){if(n=ue(n,Hi),sS("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(A.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new lt(n,null,uF(e))}function xl(n,e,...t){if(n=xe(n),arguments.length===1&&(e=Xu.newId()),sS("doc","path",e),n instanceof Hi){let r=le.fromString(e,...t);return j0(r),new Ce(n,null,new q(r))}else{if(!(n instanceof Ce)&&!(n instanceof zn))throw new k(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(le.fromString(e,...t));return j0(r),new Ce(n.firestore,n instanceof zn?n.converter:null,new q(r))}}function dS(n,e){return n=xe(n),e=xe(e),(n instanceof Ce||n instanceof zn)&&(e instanceof Ce||e instanceof zn)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function hS(n,e){return n=xe(n),e=xe(e),n instanceof lt&&e instanceof lt?n.firestore===e.firestore&&Il(n._query,e._query)&&n.converter===e.converter:!1}var B4="AsyncQueue",Pd=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new gl(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new Je;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return w(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(ui(e))O(B4,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=q4(r);throw Oe("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=Wy.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&V()}verifyOperationInProgress(){}drain(){return w(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function q4(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var av=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Je,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var oA=Rl,Pe=class extends Hi{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Pd,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return w(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Pd(e),this._firestoreClient=void 0,yield e}})}};function ct(n){if(n._terminated)throw new k(A.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||aA(n),n._firestoreClient}function aA(n){var e,t,r;let i=n._freezeSettings(),s=P4(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new ov(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&U4(n._componentsProvider))}function U4(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function lA(n,e){fn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return uA(n,iS.provider,{build:r=>new Od(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function cA(n){return w(this,null,function*(){fn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();uA(n,iS.provider,{build:t=>new tv(t,e.cacheSizeBytes)})})}function uA(n,e,t){if(n=ue(n,Pe),n._firestoreClient||n._terminated)throw new k(A.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new k(A.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},aA(n)}function dA(n){if(n._initialized&&!n._terminated)throw new k(A.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Je;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>w(this,null,function*(){try{yield tU(jv(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function hA(n){n=ue(n,Pe);let e=ct(n);return v4(e)}function fA(n){n=ue(n,Pe);let e=ct(n);return g4(e)}function pA(n){n=ue(n,Pe);let e=ct(n);return y4(e)}function mA(n,e){n=ue(n,Pe);let t=ct(n),r=new av;return D4(t,n._databaseId,e,r),r}function gA(n,e){n=ue(n,Pe);let t=ct(n);return k4(t,e).then(r=>r?new lt(n,null,r.query):null)}function V4(n,e=!0){bL(YS),Zo(new gi("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Pe(new bg(t.getProvider("auth-internal")),new Rg(t.getProvider("app-check-internal")),_2(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),mr(zb,Gb,n),mr(zb,Gb,"esm2017")}var Kn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ke.fromBase64String(e))}catch(t){throw new k(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var yn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new je(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var or=class{constructor(e){this._methodName=e}};var Qi=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}};var vl=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return nU(this._values,e._values)}};var z4=/^__.*__$/,lv=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new gn(e,this.data,this.fieldMask,t,this.fieldTransforms):new si(e,this.data,t,this.fieldTransforms)}},Ld=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new gn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function yA(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw V()}}var Fd=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Bd(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(yA(this.dataSource)&&z4.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},cv=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Dl(e)}createContext(e,t,r,i=!1){return new Fd({dataSource:e,methodName:t,targetDoc:r,path:je.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function es(n){let e=n._freezeSettings(),t=Dl(n._databaseId);return new cv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function sh(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);mS("Data must be an object, but it was:",o,r);let a=TA(r,o),l,c;if(s.merge)l=new Vt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=pv(e,d,t);if(!o.contains(f))throw new k(A.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);wA(u,f)||u.push(f)}l=new Vt(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new lv(new gt(a),l,c)}var Sl=class n extends or{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function vA(n,e,t){return new Fd({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var uv=class n extends or{_toFieldTransform(e){return new ji(e.path,new ri)}isEqual(e){return e instanceof n}},dv=class n extends or{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vA(this,e,!0),r=this._elements.map(s=>ts(s,t)),i=new ir(r);return new ji(e.path,i)}isEqual(e){return e instanceof n&&Dh(this._elements,e._elements)}},hv=class n extends or{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vA(this,e,!0),r=this._elements.map(s=>ts(s,t)),i=new sr(r);return new ji(e.path,i)}isEqual(e){return e instanceof n&&Dh(this._elements,e._elements)}},fv=class n extends or{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new ii(e.serializer,HC(e.serializer,this._operand));return new ji(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function fS(n,e,t,r){let i=n.createContext(1,e,t);mS("Data must be an object, but it was:",i,r);let s=[],o=gt.empty();Zi(r,(l,c)=>{let u=gS(e,l,t);c=xe(c);let d=i.childContextForFieldPath(u);if(c instanceof Sl)s.push(u);else{let f=ts(c,d);f!=null&&(s.push(u),o.set(u,f))}});let a=new Vt(s);return new Ld(o,a,i.fieldTransforms)}function pS(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[pv(e,r,t)],l=[i];if(s.length%2!==0)throw new k(A.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(pv(e,s[f])),l.push(s[f+1]);let c=[],u=gt.empty();for(let f=a.length-1;f>=0;--f)if(!wA(c,a[f])){let v=a[f],b=l[f];b=xe(b);let I=o.childContextForFieldPath(v);if(b instanceof Sl)c.push(v);else{let C=ts(b,I);C!=null&&(c.push(v),u.set(v,C))}}let d=new Vt(c);return new Ld(u,d,o.fieldTransforms)}function SA(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return ts(t,i)}function ts(n,e){if(n=xe(n),EA(n))return mS("Unsupported field value:",e,n),TA(n,e);if(n instanceof or)return j4(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return G4(n,e)}else return K4(n,e)}function TA(n,e){let t={};return TC(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zi(n,(r,i)=>{let s=ts(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function G4(n,e){let t=[],r=0;for(let i of n){let s=ts(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function j4(n,e){if(!yA(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function K4(n,e){if(n=xe(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return HC(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Me.fromDate(n);return{timestampValue:Ao(e.serializer,t)}}else if(n instanceof Me){let t=new Me(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Ao(e.serializer,t)}}else{if(n instanceof Qi)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Kn)return{bytesValue:sI(e.serializer,n._byteString)};if(n instanceof Ce){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:qv(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof vl)return W4(n,e);throw e.createError(`Unsupported field value: ${Nl(n)}`)}}}function W4(n,e){return{mapValue:{fields:{[Nv]:{stringValue:xv},[Eo]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return Bv(e.serializer,r)})}}}}}}function EA(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Me)&&!(n instanceof Qi)&&!(n instanceof Kn)&&!(n instanceof Ce)&&!(n instanceof or)&&!(n instanceof vl)}function mS(n,e,t){if(!EA(t)||!o4(t)){let r=Nl(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function pv(n,e,t){if(e=xe(e),e instanceof yn)return e._internalPath;if(typeof e=="string")return gS(n,e);throw Bd("Field path arguments must be of type string or ",n,!1,void 0,t)}var $4=new RegExp("[~\\*/\\[\\]]");function gS(n,e,t){if(e.search($4)>=0)throw Bd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new yn(...e.split("."))._internalPath}catch{throw Bd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Bd(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new k(A.INVALID_ARGUMENT,a+n+l)}function wA(n,e){return n.some(t=>t.isEqual(e))}var Yi=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ce(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new mv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(oh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},mv=class extends Yi{data(){return super.data()}};function oh(n,e){return typeof e=="string"?gS(n,e):e instanceof yn?e._internalPath:e._delegate._internalPath}function _A(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Tl=class{},Ji=class extends Tl{};function ur(n,e,...t){let r=[];e instanceof Tl&&r.push(e),r=r.concat(t),t3(r);for(let i of r)n=i._apply(n);return n}var qd=class n extends Ji{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return OA(e._query,t),new lt(e.firestore,e.converter,Lv(e._query,t))}_parse(e){let t=es(e.firestore);return H4(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function bA(n,e,t){let r=e,i=oh("where",n);return qd._create(i,r,t)}var gv=class n extends Tl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ye.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(Z4(e._query,t),new lt(e.firestore,e.converter,Lv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var yv=class n extends Ji{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=Q4(e._query,this._field,this._direction);return new lt(e.firestore,e.converter,fF(e._query,t))}};function CA(n,e="asc"){let t=e,r=oh("orderBy",n);return yv._create(r,t)}var Ud=class n extends Ji{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new lt(e.firestore,e.converter,ad(e._query,this._limit,this._limitType))}};function IA(n){return JI("limit",n),Ud._create("limit",n,"F")}function AA(n){return JI("limitToLast",n),Ud._create("limitToLast",n,"L")}var Vd=class n extends Ji{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=xA(e,this.type,this._docOrFields,this._inclusive);return new lt(e.firestore,e.converter,pF(e._query,t))}};function RA(...n){return Vd._create("startAt",n,!0)}function DA(...n){return Vd._create("startAfter",n,!1)}var zd=class n extends Ji{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=xA(e,this.type,this._docOrFields,this._inclusive);return new lt(e.firestore,e.converter,mF(e._query,t))}};function kA(...n){return zd._create("endBefore",n,!1)}function NA(...n){return zd._create("endAt",n,!0)}function xA(n,e,t,r){if(t[0]=xe(t[0]),t[0]instanceof Yi)return Y4(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=es(n.firestore);return J4(n._query,n.firestore._databaseId,i,e,t,r)}}function H4(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new k(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){X0(o,s);let c=[];for(let u of o)c.push(J0(r,n,u));a={arrayValue:{values:c}}}else a=J0(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&X0(o,s),a=SA(t,e,o,s==="in"||s==="not-in");return re.create(i,s,a)}function Q4(n,e,t){if(n.startAt!==null)throw new k(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new k(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zi(e,t)}function Y4(n,e,t,r,i){if(!r)throw new k(A.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of bo(n))if(o.field.isKeyField())s.push(Vi(e,r.key));else{let a=r.data.field(o.field);if(Yd(a))throw new k(A.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new k(A.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new Gn(s,i)}function J4(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new k(A.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new k(A.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Pv(n)&&c.indexOf("/")!==-1)throw new k(A.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(le.fromString(c));if(!q.isDocumentKey(d))throw new k(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let f=new q(d);a.push(Vi(e,f))}else{let d=SA(t,r,c);a.push(d)}}return new Gn(a,s)}function J0(n,e,t){if(t=xe(t),typeof t=="string"){if(t==="")throw new k(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pv(e)&&t.indexOf("/")!==-1)throw new k(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(le.fromString(t));if(!q.isDocumentKey(r))throw new k(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Vi(n,new q(r))}else{if(t instanceof Ce)return Vi(n,t._key);throw new k(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nl(t)}.`)}}function X0(n,e){if(!Array.isArray(n)||n.length===0)throw new k(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function X4(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function OA(n,e){let t=e3(n.filters,X4(e.op));if(t!==null)throw t===e.op?new k(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Z4(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)OA(t,i),t=Lv(t,i)}function e3(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function t3(n){let e=n.filter(r=>r instanceof gv).length,t=n.filter(r=>r instanceof qd).length;if(e>1||e>0&&t>0)throw new k(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Lo=class{convertValue(e,t="none"){switch(Ui(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ke(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw V()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Zi(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Eo].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ke(o.doubleValue));return new vl(s)}convertGeoPoint(e){return new Qi(ke(e.latitude),ke(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=kv(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(el(e));default:return null}}convertTimestamp(e){let t=rr(e);return new Me(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=le.fromString(e);j(gI(r));let i=new ti(r.get(1),r.get(3)),s=new q(r.popFirst(5));return i.isEqual(t)||Oe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function ah(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var vv=class extends Lo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ce(this.firestore,null,t)}};function Sv(n){return n3(n,["next","error","complete"])}function n3(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var ar=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},tn=class extends Yi{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new li(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(oh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},li=class extends tn{data(e={}){return super.data(e)}},vn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ar(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new li(this._firestore,this._userDataWriter,r.key,r,new ar(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=r3(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function r3(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new li(n._firestore,n._userDataWriter,r.doc.key,r.doc,new ar(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new li(n._firestore,n._userDataWriter,r.doc.key,r.doc,new ar(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:i3(r.type),doc:i,oldIndex:s,newIndex:o}})}}function i3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return V()}}function yS(n,e){return n instanceof tn&&e instanceof tn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof vn&&e instanceof vn?n._firestore===e._firestore&&hS(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function MA(n){n=ue(n,Ce);let e=ue(n.firestore,Pe),t=ct(e);return eA(t,n._key).then(r=>ES(e,n,r))}var lr=class extends Lo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ce(this.firestore,null,t)}};function PA(n){n=ue(n,Ce);let e=ue(n.firestore,Pe),t=ct(e),r=new lr(e);return T4(t,n._key).then(i=>new tn(e,r,n._key,i,new ar(i!==null&&i.hasLocalMutations,!0),n.converter))}function LA(n){n=ue(n,Ce);let e=ue(n.firestore,Pe),t=ct(e);return eA(t,n._key,{source:"server"}).then(r=>ES(e,n,r))}function FA(n){n=ue(n,lt);let e=ue(n.firestore,Pe),t=ct(e),r=new lr(e);return _A(n._query),tA(t,n._query).then(i=>new vn(e,r,n,i))}function BA(n){n=ue(n,lt);let e=ue(n.firestore,Pe),t=ct(e),r=new lr(e);return E4(t,n._query).then(i=>new vn(e,r,n,i))}function qA(n){n=ue(n,lt);let e=ue(n.firestore,Pe),t=ct(e),r=new lr(e);return tA(t,n._query,{source:"server"}).then(i=>new vn(e,r,n,i))}function vS(n,e,t){n=ue(n,Ce);let r=ue(n.firestore,Pe),i=ah(n.converter,e,t),s=es(r),a=sh(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Be.none());return $o(r,[a])}function SS(n,e,t,...r){n=ue(n,Ce);let i=ue(n.firestore,Pe),s=es(i);e=xe(e);let o;typeof e=="string"||e instanceof yn?o=pS(s,"updateDoc",n._key,e,t,r):o=fS(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Be.exists(!0));return $o(i,[a])}function UA(n){let e=ue(n.firestore,Pe),t=[new oi(n._key,Be.none())];return $o(e,t)}function VA(n,e){let t=ue(n.firestore,Pe),r=xl(n),i=ah(n.converter,e),s=es(n.firestore),a=sh(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Be.exists(!1));return $o(t,[a]).then(()=>r)}function TS(n,...e){var t,r,i;n=xe(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!Sv(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Sv(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof Ce)c=ue(n.firestore,Pe),u=Vo(n._key.path),l={next:f=>{e[o]&&e[o](ES(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=ue(n,lt);c=ue(f.firestore,Pe),u=f._query;let v=new lr(c);l={next:b=>{e[o]&&e[o](new vn(c,v,f,b))},error:e[o+1],complete:e[o+2]},_A(n._query)}let d=ct(c);return S4(d,u,a,l)}function zA(n,e){n=ue(n,Pe);let t=ct(n),r=Sv(e)?e:{next:e};return _4(t,r)}function $o(n,e){let t=ct(n);return w4(t,e)}function ES(n,e,t){let r=t.docs.get(e._key),i=new lr(n);return new tn(n,i,e._key,r,new ar(t.hasPendingWrites,t.fromCache),e.converter)}var s3={maxAttempts:5};function o3(n){if(n.maxAttempts<1)throw new k(A.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Gd=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=es(e)}set(e,t,r){this._verifyNotCommitted();let i=Yr(e,this._firestore),s=ah(i.converter,t,r),o=sh(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Be.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Yr(e,this._firestore);t=xe(t);let o;return typeof t=="string"||t instanceof yn?o=pS(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=fS(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Be.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Yr(e,this._firestore);return this._mutations=this._mutations.concat(new oi(t._key,Be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Yr(n,e){if(n=xe(n),n.firestore!==e)throw new k(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Tv=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=es(e)}get(e){let t=Yr(e,this._firestore),r=new vv(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return V();let s=i[0];if(s.isFoundDocument())return new Yi(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Yi(this._firestore,r,t._key,null,t.converter);throw V()})}set(e,t,r){let i=Yr(e,this._firestore),s=ah(i.converter,t,r),o=sh(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Yr(e,this._firestore);t=xe(t);let o;return typeof t=="string"||t instanceof yn?o=pS(this._dataReader,"Transaction.update",s._key,t,r,i):o=fS(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Yr(e,this._firestore);return this._transaction.delete(t._key),this}};var Ev=class extends Tv{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Yr(e,this._firestore),r=new lr(this._firestore);return super.get(e).then(i=>new tn(this._firestore,r,t._key,i._document,new ar(!1,!1),t.converter))}};function GA(n,e,t){n=ue(n,Pe);let r=Object.assign(Object.assign({},s3),t);o3(r);let i=ct(n);return b4(i,s=>e(new Ev(n,s)),r)}function jA(){return new Sl("deleteField")}function KA(){return new uv("serverTimestamp")}function WA(...n){return new dv("arrayUnion",n)}function $A(...n){return new hv("arrayRemove",n)}function HA(n){return new fv("increment",n)}V4("node");var a3="@firebase/firestore-compat",l3="0.3.38";function AS(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new k("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function QA(){if(typeof Uint8Array>"u")throw new k("unimplemented","Uint8Arrays are not available in this environment.")}function YA(){if(!EC())throw new k("unimplemented","Blobs are unavailable in Firestore in this environment.")}var lh=class n{constructor(e){this._delegate=e}static fromBase64String(e){return YA(),new n(Kn.fromBase64String(e))}static fromUint8Array(e){return QA(),new n(Kn.fromUint8Array(e))}toBase64(){return YA(),this._delegate.toBase64()}toUint8Array(){return QA(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function wS(n){return c3(n,["next","error","complete"])}function c3(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var _S=class{enableIndexedDbPersistence(e,t){return lA(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return cA(e._delegate)}clearIndexedDbPersistence(e){return dA(e._delegate)}},ch=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof ti||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&fn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){iA(this._delegate,e,t,r)}enableNetwork(){return fA(this._delegate)}disableNetwork(){return pA(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,oS("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return hA(this._delegate)}onSnapshotsInSync(e){return zA(this._delegate,e)}get app(){if(!this._appCompat)throw new k("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Yo(this,uS(this._delegate,e))}catch(t){throw Ct(t,"collection()","Firestore.collection()")}}doc(e){try{return new Wn(this,xl(this._delegate,e))}catch(t){throw Ct(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ss(this,sA(this._delegate,e))}catch(t){throw Ct(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return GA(this._delegate,t=>e(new uh(this,t)))}batch(){return ct(this._delegate),new dh(new Gd(this._delegate,e=>$o(this._delegate,e)))}loadBundle(e){return mA(this._delegate,e)}namedQuery(e){return gA(this._delegate,e).then(t=>t?new ss(this,t):null)}},Ho=class extends Lo{constructor(e){super(),this.firestore=e}convertBytes(e){return new lh(new Kn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Wn.forKey(t,this.firestore,null)}};function u3(n){eC(n)}var uh=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ho(e)}get(e){let t=ns(e);return this._delegate.get(t).then(r=>new rs(this._firestore,new tn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=ns(e);return r?(AS("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ns(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ns(e);return this._delegate.delete(t),this}},dh=class{constructor(e){this._delegate=e}set(e,t,r){let i=ns(e);return r?(AS("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ns(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ns(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Qo=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new li(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new is(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Ho(e),t),i.set(t,s)),s}};Qo.INSTANCES=new WeakMap;var Wn=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ho(e)}static forPath(e,t,r){if(e.length%2!==0)throw new k("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Ce(t._delegate,r,new q(e)))}static forKey(e,t,r){return new n(t,new Ce(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Yo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Yo(this.firestore,uS(this._delegate,e))}catch(t){throw Ct(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=xe(e),e instanceof Ce?dS(this._delegate,e):!1}set(e,t){t=AS("DocumentReference.set",t);try{return t?vS(this._delegate,e,t):vS(this._delegate,e)}catch(r){throw Ct(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?SS(this._delegate,e):SS(this._delegate,e,t,...r)}catch(i){throw Ct(i,"updateDoc()","DocumentReference.update()")}}delete(){return UA(this._delegate)}onSnapshot(...e){let t=JA(e),r=XA(e,i=>new rs(this.firestore,new tn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return TS(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=PA(this._delegate):e?.source==="server"?t=LA(this._delegate):t=MA(this._delegate),t.then(r=>new rs(this.firestore,new tn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Qo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ct(n,e,t){return n.message=n.message.replace(e,t),n}function JA(n){for(let e of n)if(typeof e=="object"&&!wS(e))return e;return{}}function XA(n,e){var t,r;let i;return wS(n[0])?i=n[0]:wS(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var rs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Wn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return yS(this._delegate,e._delegate)}},is=class extends rs{data(e){let t=this._delegate.data(e);return this._delegate._converter||tC(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ss=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ho(e)}where(e,t,r){try{return new n(this.firestore,ur(this._delegate,bA(e,t,r)))}catch(i){throw Ct(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,ur(this._delegate,CA(e,t)))}catch(r){throw Ct(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,ur(this._delegate,IA(e)))}catch(t){throw Ct(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,ur(this._delegate,AA(e)))}catch(t){throw Ct(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,ur(this._delegate,RA(...e)))}catch(t){throw Ct(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,ur(this._delegate,DA(...e)))}catch(t){throw Ct(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,ur(this._delegate,kA(...e)))}catch(t){throw Ct(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,ur(this._delegate,NA(...e)))}catch(t){throw Ct(t,"endAt()","Query.endAt()")}}isEqual(e){return hS(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=BA(this._delegate):e?.source==="server"?t=qA(this._delegate):t=FA(this._delegate),t.then(r=>new Ol(this.firestore,new vn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=JA(e),r=XA(e,i=>new Ol(this.firestore,new vn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return TS(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Qo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},bS=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new is(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Ol=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ss(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new is(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new bS(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new is(this._firestore,r))})}isEqual(e){return yS(this._delegate,e._delegate)}},Yo=class n extends ss{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Wn(this.firestore,e):null}doc(e){try{return e===void 0?new Wn(this.firestore,xl(this._delegate)):new Wn(this.firestore,xl(this._delegate,e))}catch(t){throw Ct(t,"doc()","CollectionReference.doc()")}}add(e){return VA(this._delegate,e).then(t=>new Wn(this.firestore,t))}isEqual(e){return dS(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Qo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ns(n){return ue(n,Ce)}var CS=class n{constructor(...e){this._delegate=new yn(...e)}static documentId(){return new n(je.keyField().canonicalString())}isEqual(e){return e=xe(e),e instanceof yn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var IS=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=KA();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=jA();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=WA(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=$A(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=HA(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var d3={Firestore:ch,GeoPoint:Qi,Timestamp:Me,Blob:lh,Transaction:uh,WriteBatch:dh,DocumentReference:Wn,DocumentSnapshot:rs,Query:ss,QueryDocumentSnapshot:is,QuerySnapshot:Ol,CollectionReference:Yo,FieldPath:CS,FieldValue:IS,setLogLevel:u3,CACHE_SIZE_UNLIMITED:oA};function h3(n,e){n.INTERNAL.registerComponent(new gi("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},d3)))}function f3(n){h3(n,(e,t)=>new ch(e,t,new _S)),n.registerVersion(a3,l3,"node")}f3(Pt);function p3(n,e=Pl){return new ls(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function ZA(n,e){return p3(n,e)}function m3(n,e){return ZA(n,e).pipe(Bl(void 0),Ll(),me(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function kS(n,e){return ZA(n,e).pipe(me(t=>({payload:t,type:"query"})))}var hh=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=nR(r,t);return new ph(i,s,this.afs)}snapshotChanges(){return m3(this.ref,this.afs.schedulers.outsideAngular).pipe(At)}valueChanges(e={}){return this.snapshotChanges().pipe(me(({payload:t})=>e.idField?Th(nt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return hr(this.ref.get(e)).pipe(At)}};function fh(n,e){return kS(n,e).pipe(Bl(void 0),Ll(),me(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function eR(n,e,t){return fh(n,t).pipe(Fl((r,i)=>g3(r,i.map(s=>s.payload),e),[]),PS(),me(r=>r.map(i=>({type:i.type,payload:i}))))}function g3(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=y3(n,r))}),n}function RS(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function y3(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return RS(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return RS(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return RS(n,e.oldIndex,1);break}return n}function tR(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var ph=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=fh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(me(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Bl(void 0),Ll(),Jo(([r,i])=>i.length>0||!r),me(([,r])=>r),At)}auditTrail(e){return this.stateChanges(e).pipe(Fl((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=tR(e);return eR(this.query,t,this.afs.schedulers.outsideAngular).pipe(At)}valueChanges(e={}){return kS(this.query,this.afs.schedulers.outsideAngular).pipe(me(t=>t.payload.docs.map(r=>e.idField?Th(nt({},r.data()),{[e.idField]:r.id}):r.data())),At)}get(e){return hr(this.query.get(e)).pipe(At)}add(e){return this.ref.add(e)}doc(e){return new hh(this.ref.doc(e),this.afs)}},DS=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?fh(this.query,this.afs.schedulers.outsideAngular).pipe(At):fh(this.query,this.afs.schedulers.outsideAngular).pipe(me(t=>t.filter(r=>e.indexOf(r.type)>-1)),Jo(t=>t.length>0),At)}auditTrail(e){return this.stateChanges(e).pipe(Fl((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=tR(e);return eR(this.query,t,this.afs.schedulers.outsideAngular).pipe(At)}valueChanges(e={}){return kS(this.query,this.afs.schedulers.outsideAngular).pipe(me(r=>r.payload.docs.map(i=>e.idField?nt({[e.idField]:i.id},i.data()):i.data())),At)}get(e){return hr(this.query.get(e)).pipe(At)}},v3=new St("angularfire2.enableFirestorePersistence"),S3=new St("angularfire2.firestore.persistenceSettings"),T3=new St("angularfire2.firestore.settings"),E3=new St("angularfire2.firestore.use-emulator");function nR(n,e=t=>t){return{query:e(n),ref:n}}var Ot=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,f,v,b,I,C,M,R){this.schedulers=l;let P=na(t,a,r),L=u;d&&jh(P,a,f,b,I,C,v,M),[this.firestore,this.persistenceEnabled$]=$l(`${P.name}.firestore`,"AngularFirestore",P.name,()=>{let z=a.runOutsideAngular(()=>P.firestore());if(s&&z.settings(s),L&&z.useEmulator(...L),i&&!ql(o)){let Q=()=>{try{return hr(z.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),fr(!1)}};return[z,a.runOutsideAngular(Q)]}else return[z,fr(!1)]},[s,L,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=nR(i,r),a=this.schedulers.ngZone.run(()=>s);return new ph(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new DS(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new hh(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(Y(ps),Y(ms,8),Y(v3,8),Y(T3,8),Y(us),Y(pr),Y(jl),Y(S3,8),Y(E3,8),Y(mT,8),Y(Bh,8),Y(qh,8),Y(Uh,8),Y(Vh,8),Y(zh,8),Y(Gh,8),Y(yi,8))};static \u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var rR=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Header",this.headerRef=t.collection(this.dbPath)}getHeader(){return this.headerRef}static{this.\u0275fac=function(r){return new(r||n)(Y(Ot))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var iR=(()=>{class n{constructor(t){this.headerService=t,this.header=new zl,this.headerService.getHeader().snapshotChanges().pipe(me(r=>r.map(i=>nt({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.header=r[0],console.log(this.header)})}static{this.\u0275fac=function(r){return new(r||n)(It(rR))}}static{this.\u0275cmp=dt({type:n,selectors:[["app-header"]],decls:16,vars:7,consts:[[2,"border-collapse","collapse","width","100%","border","0.5px solid grey"],[2,"max-width","150px","max-height","150px",3,"src"],[2,"max-width","200px"]],template:function(r,i){r&1&&(oe(0,"table",0)(1,"tr")(2,"td"),se(3),Se(4,"br"),se(5),ne(),oe(6,"td"),Se(7,"img",1),ne(),oe(8,"td",2),se(9),Se(10,"br"),se(11),Se(12,"br"),se(13),Se(14,"br"),se(15),ne()()()),r&2&&(he(3),Re(" ",i.header.name," "),he(2),Re(" ",i.header.goalLife," "),he(2),US("src",i.header.photoUrl,qS),he(2),Re(" ",i.header.email,""),he(2),Re(" ",i.header.phoneNumber,""),he(2),Re(" ",i.header.location,""),he(2),Re(" ",i.header.socialNetwork," "))},styles:["table[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:.5px solid black;border-collapse:collapse}"]})}}return n})();var sR=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Education",this.eduRef=t.collection(this.dbPath)}getEducation(){return this.eduRef}static{this.\u0275fac=function(r){return new(r||n)(Y(Ot))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function C3(n,e){if(n&1&&(oe(0,"ul")(1,"li"),se(2),Se(3,"br"),se(4),Se(5,"br"),se(6),Se(7,"br"),ne()()),n&2){let t=e.$implicit;he(2),Re(" ",t.grade," "),he(2),Re(" ",t.educativeInstitute," "),he(2),Re(" ",t.date," ")}}var aR=(()=>{class n{constructor(t){this.educationService=t,this.education=[],this.educationService.getEducation().snapshotChanges().pipe(me(r=>r.map(i=>nt({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.education=r,console.log(this.education)})}static{this.\u0275fac=function(r){return new(r||n)(It(sR))}}static{this.\u0275cmp=dt({type:n,selectors:[["app-education"]],decls:4,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(r,i){r&1&&(oe(0,"table")(1,"h3"),se(2,"Education"),ne(),ds(3,C3,8,3,"ul",0),ne()),r&2&&(he(3),hs("ngForOf",i.education))},dependencies:[fs]})}}return n})();var mh=class{constructor(){this.languagues="value1, value2, value3 ...",this.Areas="value1, value2, value3 ..."}};var lR=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Skills",this.skillsRef=t.collection(this.dbPath)}getSkills(){return this.skillsRef}static{this.\u0275fac=function(r){return new(r||n)(Y(Ot))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var cR=(()=>{class n{constructor(t){this.skillsService=t,this.skills=new mh,this.skillsService.getSkills().snapshotChanges().pipe(me(r=>r.map(i=>nt({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.skills=r[0],console.log(this.skills)})}static{this.\u0275fac=function(r){return new(r||n)(It(lR))}}static{this.\u0275cmp=dt({type:n,selectors:[["app-skills"]],decls:9,vars:2,template:function(r,i){r&1&&(oe(0,"table")(1,"h3"),se(2,"Lenguages "),ne(),se(3),Se(4,"br"),oe(5,"h3"),se(6,"Technologies "),ne(),se(7),Se(8,"br"),ne()),r&2&&(he(3),Re(" ",i.skills.languagues," "),he(4),Re(" ",i.skills.Areas," "))}})}}return n})();var gh=class{constructor(){this.Institute="institute example",this.title="title",this.date="date"}};var uR=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Certificates",this.certificatesRef=t.collection(this.dbPath)}getCertificates(){return this.certificatesRef}static{this.\u0275fac=function(r){return new(r||n)(Y(Ot))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var dR=(()=>{class n{constructor(t){this.certificatesService=t,this.certificates=new gh,console.log(this.certificatesService),this.certificatesService.getCertificates().snapshotChanges().pipe(me(r=>r.map(i=>nt({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.certificates=r[0],console.log(this.certificates)})}static{this.\u0275fac=function(r){return new(r||n)(It(uR))}}static{this.\u0275cmp=dt({type:n,selectors:[["app-certificates"]],decls:10,vars:3,consts:[[2,"border-collapse","collapse","width","100%"]],template:function(r,i){r&1&&(oe(0,"table",0)(1,"h3"),se(2,"Certifications "),ne(),oe(3,"p"),se(4),ne(),Se(5,"br"),oe(6,"p"),se(7),ne(),oe(8,"p"),se(9),ne()()),r&2&&(he(4),Re("",i.certificates.title," "),he(3),Re(" ",i.certificates.Institute," "),he(2),Re(" ",i.certificates.date," "))}})}}return n})();var hR=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Languages",this.languageRef=t.collection(this.dbPath)}getLanguage(){return this.languageRef}static{this.\u0275fac=function(r){return new(r||n)(Y(Ot))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function x3(n,e){if(n&1&&(oe(0,"ul")(1,"p"),se(2),ne(),oe(3,"p"),se(4),ne()()),n&2){let t=e.$implicit;he(2),bh(t.language),he(2),bh(t.percentage)}}var fR=(()=>{class n{constructor(t){this.languaguesService=t,this.language=[],this.languaguesService.getLanguage().snapshotChanges().pipe(me(r=>r.map(i=>nt({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.language=r,console.log(this.language)})}static{this.\u0275fac=function(r){return new(r||n)(It(hR))}}static{this.\u0275cmp=dt({type:n,selectors:[["app-languages"]],decls:4,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(r,i){r&1&&(oe(0,"table")(1,"h3"),se(2,"Languages"),ne(),ds(3,x3,5,2,"ul",0),ne()),r&2&&(he(3),hs("ngForOf",i.language))},dependencies:[fs]})}}return n})();var yh=class{constructor(){this.interest="history"}};var pR=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Interests",this.interestsRef=t.collection(this.dbPath)}getInterests(){return this.interestsRef}static{this.\u0275fac=function(r){return new(r||n)(Y(Ot))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var mR=(()=>{class n{constructor(t){this.interestsService=t,this.interests=new yh,this.interestsService.getInterests().snapshotChanges().pipe(me(r=>r.map(i=>nt({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.interests=r[0],console.log(this.interests)})}static{this.\u0275fac=function(r){return new(r||n)(It(pR))}}static{this.\u0275cmp=dt({type:n,selectors:[["app-insterests"]],decls:5,vars:1,template:function(r,i){r&1&&(oe(0,"table")(1,"h3"),se(2,"Interests"),ne(),oe(3,"p"),se(4),ne()()),r&2&&(he(4),Re(" ",i.interests.interest," "))}})}}return n})();var gR=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Work-experience",this.workRef=t.collection(this.dbPath)}getWorkExperience(){return this.workRef}static{this.\u0275fac=function(r){return new(r||n)(Y(Ot))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function F3(n,e){if(n&1&&(oe(0,"ul")(1,"li"),se(2),oe(3,"i"),se(4),ne(),Se(5,"br"),oe(6,"b"),se(7),ne(),Se(8,"br"),se(9," Logros: "),Se(10,"br"),se(11),Se(12,"br"),ne()()),n&2){let t=e.$implicit;he(2),VS(" ",t.startDate," - ",t.endDate," "),he(2),Re(" ",t.location," "),he(3),Re("",t.position," "),he(4),Re(" ",t.accomplishment," ")}}var yR=(()=>{class n{constructor(t){this.workService=t,this.workExperience=[],console.log(this.workService),this.workService.getWorkExperience().snapshotChanges().pipe(me(r=>r.map(i=>nt({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.workExperience=r,console.log(this.workExperience)})}static{this.\u0275fac=function(r){return new(r||n)(It(gR))}}static{this.\u0275cmp=dt({type:n,selectors:[["app-work-experience"]],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(r,i){r&1&&ds(0,F3,13,5,"ul",0),r&2&&hs("ngForOf",i.workExperience)},dependencies:[fs]})}}return n})();var vh=(()=>{class n{constructor(){this.title="mycv"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=dt({type:n,selectors:[["app-root"]],decls:19,vars:0,consts:[["border","1"],["colspan","2"]],template:function(r,i){r&1&&(oe(0,"table",0)(1,"tr")(2,"td",1),Se(3,"app-header"),ne()(),oe(4,"tr")(5,"td"),Se(6,"app-work-experience"),ne(),oe(7,"td"),Se(8,"app-skills"),ne()(),oe(9,"tr")(10,"td"),Se(11,"app-education"),ne(),oe(12,"td"),Se(13,"app-certificates"),ne()(),oe(14,"tr")(15,"td"),Se(16,"app-languages"),ne(),oe(17,"td"),Se(18,"app-insterests"),ne()()())},dependencies:[iR,aR,cR,dR,fR,mR,yR]})}}return n})();var vR={production:!1,firebase:{apiKey:"AIzaSyAiicR9-3ZEOhGAVL5jxkaxthn4nOkT3aY",authDomain:"mycv-matador1081.firebaseapp.com",projectId:"mycv-matador1081",storageBucket:"mycv-matador1081.firebasestorage.app",messagingSenderId:"113584989289",appId:"1:113584989289:web:93642746b2962f55156ef8"}};var SR=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Tn({type:n,bootstrap:[vh]})}static{this.\u0275inj=Sn({imports:[jS,XS,pT.initializeApp(vR.firebase)]})}}return n})();var q3=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Tn({type:n,bootstrap:[vh]})}static{this.\u0275inj=Sn({imports:[SR,KS]})}}return n})();export{q3 as a};
